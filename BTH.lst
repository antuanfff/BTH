Sjasm Z80 Assembler v0.42c - www.xl2s.tk             [2024.04.27 - 20:05:43]

.\BTH.asm
Errors: 0

       1   00:0000                      	output "BTH.rom" 
       2   00:7062                      
       3   00:7062                      ;ROM ASCII16
       4   00:7062                      		defpage	0,0x4000, 0x4000
       5   00:7062                      		defpage	1,0x8000, 0x4000        
       6   00:7062                      		defpage	2..14 ;Here it is determined rom size        
       7   00:7062                              defpage	15,0xC000, 0x4000
       8   00:7062                      
       9   00:7062  (00:4000)           PageSize:	    equ	0x4000	        ; 16kB
      10   00:7062  (00:6000)           _bank1	equ	6000h
      11   00:7062  (00:7000)           _bank2	equ	7000h
      12   00:7062  32 00 70 32 FF 77   		DB 32h,0,70h,32h,0FFh,77h		; Para evitar seleccionar el tipo de ROM ASCII16 en OpenMSX
      13   00:7068  (00)                		page 0			
      14   00:4000                              org 4000h		
      15   00:4000                              dw  4241h,START,0,0,0,0,0,0
      15   00:4000  41 42 83 4B 00 00 00 00 00 00 00 00 00 00 00 00 
      16   00:4010                      
      17   00:4010                      ;Llamadas a rutinas bios
      18   00:4010                          include "include\System_BIOSCalls.asm"
       1.  00:4010  (00:009F)           CHGET                   equ #009F    ; Se queda esperando que se pulse una tecla
       2.  00:4010  (00:00A2)           CHPUT                   equ #00A2    ; escribe el caracter ascii almacenado en a                         
       3.  00:4010  (00:005F)           CHGMOD                  equ #005F   ; Cambia el modo de screen pero previamente necesita que se le asigne el modo en el registro a
       4.  00:4010  (00:005C)           LDIRVM                  equ #005C   ;Tansfiere bloques de la RAM a la VRAM, es la más importante, necesita previamente asignar valor al registro bc con la longitud, dc con la dirección de inicio de la VRAM y hl con la dirección de inicio de la RAM:
       5.  00:4010  (00:013E)           RDVDP                   equ #013E    ; Lee el registro de estado del VDP
       6.  00:4010  (00:0047)           WRTVDP                  equ #0047   ; Escribe en los registros del VDP 
       7.  00:4010  (00:F3DB)           CLIKSW                  equ $F3DB ; Keyboard click sound
       8.  00:4010  (00:0141)           SNSMAT					equ #0141
       9.  00:4010  (00:FC9E)           JIFFY 					equ #FC9E
      10.  00:4010  (00:0041)           DISSCR                  equ #0041   ; Disable screen
      11.  00:4010  (00:0044)           ENASCR                  equ #0044   ; Enable screen
      12.  00:4010  (00:0072)           INIGRP                  equ #0072   ; Enable Screen 2
      13.  00:4010  (00:0138)           RSLREG                  equ #0138   ; Leemos el contenido del registro de seleccion de slots
      14.  00:4010  (00:0024)           ENASLT                  equ #0024   ; Switches indicated slot at indicated page on perpetually Input    : A - Slot ID, see RDSLT            H - Bit 6 and 7 must contain the page number (00-11)
      19   00:4010                      
      20   00:4010                      ;Constantes
      21   00:4010                          include "include\BTH_const.asm"
       1.  00:4010                      ; VDP Const
       2.  00:4010  (00:5C28)           FIRST_LINE_DLG_BOX   equ 5C28H
       3.  00:4010  (00:6028)           SEC_LINE_DLG_BOX   equ 6028H
       4.  00:4010  (00:6428)           THIRD_LINE_DLG_BOX   equ 6428H
       5.  00:4010                      
       6.  00:4010  (00:0001)           ROMMODE                 equ 1 ; 0 Dos Mode 1 Rom Mode
       7.  00:4010  (00:0007)           KB_RIGHT 				equ 7
       8.  00:4010  (00:0006)           KB_DOWN 				equ 6
       9.  00:4010  (00:0005)           KB_UP 					equ	5        
      10.  00:4010  (00:0004)           KB_LEFT 				equ	4
      11.  00:4010  (00:0003)           KB_DEL 					equ	3
      12.  00:4010  (00:0000)           KB_SPACE				equ	0
      13.  00:4010                      
      14.  00:4010  (00:0001)           MOV_SPEED				equ 1
      15.  00:4010  (00:0001)           MOV_SPEED_GHOST			equ 1
      16.  00:4010  (00:0003)           MOV_SPEED_SHOOT         equ 3
      17.  00:4010  (00:0030)           MAX_DISTANCE_SHOOT      equ 48
      18.  00:4010  (00:0005)           MAX_CHAR_STEPS          equ 5       ; #steps pattern change MAIN CHAR
      19.  00:4010  (00:0006)           MAX_CHAR_STEPS_STG2          equ 6
      20.  00:4010  (00:FFE8)           REG9SAV                 equ #FFE8
      21.  00:4010  (00:0098)           PORT_0                  equ 0x98
      22.  00:4010  (00:0099)           PORT_1                  equ 0x99
      23.  00:4010  (00:009A)           PORT_2                  equ 0x9a
      24.  00:4010  (00:009B)           PORT_3                  equ 0x9b
      25.  00:4010                      
      26.  00:4010  (00:F3E0)           RG15AV equ #F3E0 ; alamcena el valor del registro 1 de escritura del VDP, hay unas rutinas de la bios que guardan estas direcciones valores globals del sistema
      27.  00:4010  (00:F3E9)           FORCLR equ $F3E9 ; Foreground colour
      28.  00:4010                      
      29.  00:4010  (00:00C8)           MIKE_TOMB_STG1_X            equ 200
      30.  00:4010  (00:0029)           JOHN_TOMB_STG1_X            equ 41
      31.  00:4010  (00:0049)           GUS_TOMB_STG1_X             equ 73
      32.  00:4010                      
      33.  00:4010  (00:000C)           SPR_SHOOT_P1                equ 12  ; Offset de IX (SPRATT)
      34.  00:4010  (00:0018)           SPR_SHOOT_P1_PTRN           equ 18h
      35.  00:4010  (00:0010)           SPR_GHOST_STG1              equ 16  ; Offset de IX (SPRATT)
      36.  00:4010  (00:001C)           SPR_GHOST_STG1_PTRN_L1      equ 1Ch  ; Offset del Sprite Pattern Table
      37.  00:4010  (00:0024)           SPR_GHOST_STG1_PTRN_L2      equ 24h  ; Offset del Sprite Pattern Table
      38.  00:4010  (00:002C)           SPR_GHOST_STG1_PTRN_R1      equ 2Ch  ; Offset del Sprite Pattern Table
      39.  00:4010  (00:0034)           SPR_GHOST_STG1_PTRN_R2      equ 34h  ; Offset del Sprite Pattern Table
      40.  00:4010                      
      41.  00:4010  (00:0018)           SPR_GHOST_STG2              equ 24  ; Offset de IX (SPRATT)
      42.  00:4010  (00:003C)           SPR_GHOST_STG2_PTRN_L1      equ 3Ch  ; Offset del Sprite Pattern Table
      43.  00:4010  (00:0044)           SPR_GHOST_STG2_PTRN_L2      equ 44h  ; Offset del Sprite Pattern Table
      44.  00:4010  (00:004C)           SPR_GHOST_STG2_PTRN_R1      equ 4Ch  ; Offset del Sprite Pattern Table
      45.  00:4010  (00:0054)           SPR_GHOST_STG2_PTRN_R2      equ 54h  ; Offset del Sprite Pattern Table
      46.  00:4010                      
      22   00:4010                          include "include\BTH_strings.asm"
       1.  00:4010  16 40 1C 40 30 40   mike_tomb_strings: dw string01M, string02M, string03M
       2.  00:4016                      ; Caben 23 caracteres en cada línea
       3.  00:4016  4D 49 4B 45 3A 00   string01M: db 'MIKE:',0
       4.  00:401C                      string02M: db 'JOHN FUE EL PRIMERO',0
       4.  00:401C  4A 4F 48 4E 20 46 55 45 20 45 4C 20 50 52 49 4D 
       4.  00:402C  45 52 4F 00 
       5.  00:4030                      string03M: db 'EN MORIR',0
       5.  00:4030  45 4E 20 4D 4F 52 49 52 00 
       6.  00:4039                      
       7.  00:4039  3F 40 45 40 59 40   john_tomb_strings: dw string01J, string02J, string03J
       8.  00:403F                      ; Caben 23 caracteres en cada línea
       9.  00:403F  4A 4F 48 4E 3A 00   string01J: db 'JOHN:',0
      10.  00:4045                      string02J: db 'MIKE FUE EL TERCERO',0
      10.  00:4045  4D 49 4B 45 20 46 55 45 20 45 4C 20 54 45 52 43 
      10.  00:4055  45 52 4F 00 
      11.  00:4059                      string03J: db 'EN MORIR',0
      11.  00:4059  45 4E 20 4D 4F 52 49 52 00 
      12.  00:4062                      
      13.  00:4062  68 40 6D 40 7F 40   gus_tomb_strings: dw string01G, string02G, string03G
      14.  00:4068                      ; Caben 23 caracteres en cada línea
      15.  00:4068  47 55 53 3A 00      string01G: db 'GUS:',0
      16.  00:406D                      string02G: db 'YO FUI EL SEGUNDO',0
      16.  00:406D  59 4F 20 46 55 49 20 45 4C 20 53 45 47 55 4E 44 
      16.  00:407D  4F 00 
      17.  00:407F                      string03G: db 'EN MORIR',0
      17.  00:407F  45 4E 20 4D 4F 52 49 52 00 
      18.  00:4088                      
      23   00:4088                      
      24   00:4088                      ; Funciones auxiliares
      25   00:4088                      	include "include\BTH_func.asm"
       1.  00:4088                      ; Dadas las coordenadas X,Y en pixels de dos sprites, devuelve 1 si hay colision
       2.  00:4088                      ;Entrada:
       3.  00:4088                      ;   b - Y SPR1
       4.  00:4088                      ;   C - X SPR1
       5.  00:4088                      
       6.  00:4088                      ;   d - Y SPR2
       7.  00:4088                      ;   e - X SPR2
       8.  00:4088                      ;Salida:
       9.  00:4088                      ;   a - bloque
      10.  00:4088                      ;Modifica:
      11.  00:4088                      ;   a, hl, de
      12.  00:4088                      check_spr_collision:        
      13.  00:4088  78                          LD A,B          ; a = Y SPR1
      14.  00:4089  BA                          CP D
      15.  00:408A  C2 95 40                    JP NZ,.no_collision
      16.  00:408D                      
      17.  00:408D  79                          LD A,C          ; a = X SPR1
      18.  00:408E  BB                          CP E
      19.  00:408F  C2 95 40                    JP NZ,.no_collision
      20.  00:4092                      
      21.  00:4092  3E 01                       LD A,1
      22.  00:4094  C9                          RET
      23.  00:4095                      .no_collision
      24.  00:4095  3E 00                   LD A,0
      25.  00:4097  C9                      RET
      26.  00:4098                      
      27.  00:4098                      ; Dadas las coordenadas X,Y en pixels, devuelve el bloque de 8x8 al que corresponde esas coordenadas
      28.  00:4098                      ; La tabla de colisiones es la tabla de nombres con 32x24 = 756 bytes
      29.  00:4098                      ;Entrada:
      30.  00:4098                      ;   d - X
      31.  00:4098                      ;   e - y
      32.  00:4098                      ;Salida:
      33.  00:4098                      ;   a - bloque
      34.  00:4098                      ;Modifica:
      35.  00:4098                      ;   a, hl, de
      36.  00:4098                      get_bloque_en_X_Y:
      37.  00:4098                              ;(y/8)*32+(x/8)
      38.  00:4098  7B                          ld a,e      ;a=y
      39.  00:4099  CB 3F CB 3F CB 3F   [3]     srl a       ;a=y/8
      40.  00:409F  26 00                       ld h,0
      41.  00:40A1  6F                          ld l,a      ;hl=y/8
      42.  00:40A2  29 29 29 29 29      [5]     add hl,hl   ;x32    ;a=(y/8)*32
      43.  00:40A7                      
      44.  00:40A7  7A                          ld a,d      ;a=x
      45.  00:40A8  CB 3F CB 3F CB 3F   [3]     srl a       ;a=x/8
      46.  00:40AE  16 00                       ld d,0
      47.  00:40B0  5F                          ld e,a      ;de=x/8
      48.  00:40B1  19                          add hl,de   ;hl=(y/8)*32+(x/8)
      49.  00:40B2                      
      50.  00:40B2  ED 5B A2 C0                 ld de,(MAPA)
      51.  00:40B6  19                          add hl,de   ;hl=mapa + hl=(y/8)*32+(x/8)
      52.  00:40B7                      
      53.  00:40B7  7E                          ld a,[hl]
      54.  00:40B8  C9                          ret
      55.  00:40B9                      
      56.  00:40B9                      ; SCREEN 8
      57.  00:40B9                      SetVdp_Write:
      58.  00:40B9                      
      59.  00:40B9                      	; transform address from 
      60.  00:40B9                      	;
      61.  00:40B9                      	; |           Register A            |           Register H            |           Register L            |
      62.  00:40B9                      	; | --- --- --- --- --- --- --- A16 | A15 A14 A13 A12 A11 A10  A9  A8 |  A7  A6  A5  A4  A3  A2  A1  A0 |
      63.  00:40B9                      	;
      64.  00:40B9                      	; to
      65.  00:40B9                      	;
      66.  00:40B9                      	; |           Register A            |           Register H            |           Register L            |
      67.  00:40B9                      	; | --- --- --- --- --- A16 A15 A14 | --- --- A13 A12 A11 A10  A9  A8 |  A7  A6  A5  A4  A3  A2  A1  A0 |
      68.  00:40B9  CB 04                   rlc     h
      69.  00:40BB  17                      rla
      70.  00:40BC  CB 04                   rlc     h
      71.  00:40BE  17                      rla
      72.  00:40BF  CB 3C                   srl     h
      73.  00:40C1  CB 3C                   srl     h
      74.  00:40C3                      
      75.  00:40C3  F3                      di
      76.  00:40C4                      	    ; write bits a14-16 of address to R#14
      77.  00:40C4  D3 99               	    out     (PORT_1), a
      78.  00:40C6  3E 8E               	    ld      a, 14 + 128
      79.  00:40C8  D3 99               	    out     (PORT_1), a
      80.  00:40CA                      
      81.  00:40CA                      	    ; write the other address bits to VDP PORT_1
      82.  00:40CA  7D                  	    ld      a, l
      83.  00:40CB  00                  	    nop
      84.  00:40CC  D3 99               	    out     (PORT_1), a
      85.  00:40CE  7C                  	    ld      a, h
      86.  00:40CF  F6 40               	    or      64
      87.  00:40D1  FB                      ei
      88.  00:40D2  D3 99                   out     (PORT_1),a
      89.  00:40D4  C9                      ret
      90.  00:40D5                      
      91.  00:40D5                      Set212Lines:
      92.  00:40D5                              ; set LN (bit 7) of R#9 to 1
      93.  00:40D5  3A E8 FF                    ld      a, (REG9SAV)
      94.  00:40D8  F6 80                       or      10000000b
      95.  00:40DA  47                          ld      b, a
      96.  00:40DB  0E 09                       ld      c, 9            ; register #
      97.  00:40DD  CD 47 00                    call    WRTVDP
      98.  00:40E0  C9                          ret
      99.  00:40E1                      
     100.  00:40E1                      ClearVram_MSX2:
     101.  00:40E1  AF                          xor     a           ; set vram write base address
     102.  00:40E2  21 00 00                    ld      hl, 0     	; to 1st byte of page 0
     103.  00:40E5  CD B9 40                    call    SetVdp_Write
     104.  00:40E8  AF                          xor		a
     105.  00:40E9                      
     106.  00:40E9                          ; TODO: 
     107.  00:40E9                          ;   use VDP command (currently is taking almost 1 second)
     108.  00:40E9                          ;   disable screen/sprites (should I ??)
     109.  00:40E9                      
     110.  00:40E9                          ; clear all 128kb of VRAM
     111.  00:40E9  16 02               	ld		d, 2		; 2 repetitions
     112.  00:40EB                      .loop_2:
     113.  00:40EB  0E 00               	ld		c, 0		; 256 repetitions
     114.  00:40ED                      .loop_1:
     115.  00:40ED  06 00               	ld		b, 0		; 256 repetitions
     116.  00:40EF                      .loop:
     117.  00:40EF  D3 98               	out		(PORT_0), a
     118.  00:40F1  10 FC               	djnz	.loop
     119.  00:40F3  0D                  	dec		c
     120.  00:40F4  C2 ED 40            	jp		nz, .loop_1
     121.  00:40F7  15                  	dec		d
     122.  00:40F8  C2 EB 40            	jp		nz, .loop_2
     123.  00:40FB                      
     124.  00:40FB  C9                  	ret
     125.  00:40FC                      
     126.  00:40FC                      ; MEGAROM
     127.  00:40FC                      
     128.  00:40FC                      opening_screen		
     129.  00:40FC  0E 00               		ld		c,0
     130.  00:40FE  11 00 00            		ld		de,0
     131.  00:4101  CD 41 41            		call	_vdpsetvramwr
     132.  00:4104  1E 04               		ld	e,4
     133.  00:4106  3E 09               		ld	a, :GRAPHIC
     134.  00:4108  57                  		ld	d,a
     135.  00:4109  32 00 70            2:		ld	(_bank2),a
     136.  00:410C  21 00 80            		ld	hl,GRAPHIC
     137.  00:410F  01 98 00            		ld	bc,0x98
     138.  00:4112  3E 40               		ld	a,32*2
     139.  00:4114  ED B3               1:		otir
     140.  00:4116  3D                  		dec	a
     141.  00:4117  20 FB               		jr	nz,1b
     142.  00:4119  14                  		inc	d
     143.  00:411A  7A                  		ld	a,d
     144.  00:411B  1D                  		dec	e
     145.  00:411C  20 EB               		jr	nz,2b
     146.  00:411E  C9                  		ret 
     147.  00:411F                      
     148.  00:411F                      load_screen
     149.  00:411F  0E 00               		ld		c,0
     150.  00:4121  11 00 00            		ld		de,0
     151.  00:4124  CD 41 41            		call	_vdpsetvramwr
     152.  00:4127  1E 02               		ld	e,2					; #pages
     153.  00:4129  78                  		ld	a, b			; 1st page bitmap
     154.  00:412A  57                  		ld	d,a
     155.  00:412B  32 00 70            2:		ld	(_bank2),a
     156.  00:412E  2A A4 C0            		ld	hl,(BITMAP)		; Bitmap address
     157.  00:4131  01 98 00            		ld	bc,0x98
     158.  00:4134  3E 40               		ld	a,64
     159.  00:4136  ED B3               1:		otir
     160.  00:4138  3D                  		dec	a
     161.  00:4139  20 FB               		jr	nz,1b
     162.  00:413B  14                  		inc	d
     163.  00:413C  7A                  		ld	a,d
     164.  00:413D  1D                  		dec	e
     165.  00:413E  20 EB               		jr	nz,2b
     166.  00:4140  C9                  		ret 
     167.  00:4141                      
     168.  00:4141                      ;Set VDP for writing at address CDE (17-bit) 
     169.  00:4141                      
     170.  00:4141                      _vdpsetvramwr:
     171.  00:4141  79                  	ld a,c
     172.  00:4142  CB 02               	rlc d
     173.  00:4144  17                  	rla
     174.  00:4145  CB 02               	rlc d
     175.  00:4147  17                  	rla
     176.  00:4148  CB 3A               	srl d ; primo shift, il secondo dopo la out
     177.  00:414A                      
     178.  00:414A  D3 99               	out (0x99),a ;set bits 14-16
     179.  00:414C  3E 8E               	ld a,14+128
     180.  00:414E  D3 99               	out (0x99),a
     181.  00:4150  CB 3A               	srl d ; secondo shift.     
     182.  00:4152                      _vdpsetvramwr14
     183.  00:4152  7B                  	ld a,e ;set bits 0-7
     184.  00:4153  D3 99               	out (0x99),a
     185.  00:4155  7A                  	ld a,d ;set bits 8-13
     186.  00:4156  F6 40               	or 0x40 ; + write access
     187.  00:4158  D3 99               	out (0x99),a
     188.  00:415A  C9                  	ret
     189.  00:415B                      
     190.  00:415B                      
     191.  00:415B                      
     192.  00:415B                      		; --- RUTINAS PARA COLOCAR LAS PAGINAS DEL CARTUCHO ---
     193.  00:415B                      		; -----------------------------------------------------
     194.  00:415B                      		; --- SIEMPRE DEBEN IR EN LA PAGINA 1 DEL CARTUCHO! ---
     195.  00:415B                      		; -----------------------------------------------------
     196.  00:415B                      
     197.  00:415B                      		; --- RUTINAS PRINCIPALES DEL MODULO ---
     198.  00:415B                      		; GETSLOT:	OBTIENE EL VALOR DEL SLOT QUE LE INDIQUEMOS
     199.  00:415B                      		; SETPAGES32K:	BIOS-ROM-YY-ZZ	 -> BIOS-ROM-ROM-ZZ (SITUA PAGINA 2)
     200.  00:415B                      
     201.  00:415B                      		; --- VARIABLES EN RAM NECESARIAS ---
     202.  00:415B                      		; NINGUNA
     203.  00:415B                      
     204.  00:415B                      GETSLOT:	; --- Rutina que construye el valor del SLOT para llamar a ENASLT ---
     205.  00:415B                      		; --- Entrada: a = SLOT                                           ---
     206.  00:415B                      		; --- Salida: a = valor para ENASLT                               ---
     207.  00:415B                      		; --- AUTOR: Konamiman                                            ---
     208.  00:415B  E6 03               		and	$03				; Proteccion, nos aseguramos de que el valor esta en 0-3
     209.  00:415D  4F                  		ld	c,a				; c = slot de la pagina
     210.  00:415E  06 00               		ld	b,0				; bc = slot de la pagina
     211.  00:4160  21 C1 FC            		ld	hl,$FCC1			; Tabla de slots expandidos
     212.  00:4163  09                  		add	hl,bc				; hl -> variable que indica si este slot esta expandido
     213.  00:4164  7E                  		ld	a,(hl)				; Tomamos el valor
     214.  00:4165  E6 80               		and	$80				; Si el bit mas alto es cero...
     215.  00:4167  28 09               		jr	z,EXIT			; ...nos vamos a @@EXIT
     216.  00:4169                      		; --- El slot esta expandido ---
     217.  00:4169  B1                  		or	c				; Slot basico en el lugar adecuado
     218.  00:416A  4F                  		ld	c,a				; Guardamos el valor en c
     219.  00:416B  23                  		inc	hl				; Incrementamos hl una...
     220.  00:416C  23                  		inc	hl				; ...dos...
     221.  00:416D  23                  		inc	hl				; ...tres...
     222.  00:416E  23                  		inc	hl				; ...cuatro veces
     223.  00:416F  7E                  		ld	a,(hl)				; a = valor del registro de subslot del slot donde estamos
     224.  00:4170  E6 0C               		and	$0C				; Nos quedamos con el valor donde esta nuestro cartucho
     225.  00:4172  B1                  EXIT:		or	c				; Slot extendido/basico en su lugar
     226.  00:4173  C9                  		ret					; Volvemos
     227.  00:4174                      
     228.  00:4174                      SETPAGES32K:	; --- Posiciona las paginas de un megarom o un 32K ---
     229.  00:4174  3E C9               		ld	a,$C9				; Codigo de RET
     230.  00:4176  32 79 41            		ld	(NOPRET),a			; Modificamos la siguiente instruccion si estamos en RAM
     231.  00:4179  00                  NOPRET:	nop					; No hacemos nada si no estamos en RAM
     232.  00:417A                      		; --- Si llegamos aqui no estamos en RAM, hay que posicionar la pagina ---
     233.  00:417A  CD 38 01            		call	RSLREG  			; Leemos el contenido del registro de seleccion de slots
     234.  00:417D  0F                  		rrca					; Rotamos a la derecha...
     235.  00:417E  0F                  		rrca					; ...dos veces
     236.  00:417F  CD 5B 41            		call	GETSLOT				; Obtenemos el slot de la pagina 1 ($4000-$BFFF)
     237.  00:4182  26 80               		ld	h,$80				; Seleccionamos pagina 2 ($8000-$BFFF)
     238.  00:4184  C3 24 00            		jp	ENASLT ;ENASLT
     239.  00:4187                      
     240.  00:4187                      SET_SCREEN5_MODE:
     241.  00:4187                           ;Cambiamos el modo de pantalla
     242.  00:4187                          ; BASIC: COLOR 15,1,1
     243.  00:4187                          ; Establecer los colores
     244.  00:4187  21 E9 F3            	ld hl,FORCLR ; Variable del Sistema
     245.  00:418A  36 0F               	ld [hl],15 ; Color del primer plano 15=blanco
     246.  00:418C  23                  	inc hl ; FORCLR+1
     247.  00:418D  36 0F               	ld [hl],15 ; Color de fondo 1=negro
     248.  00:418F  23                  	inc hl ; FORCLR+2
     249.  00:4190  36 0F               	ld [hl],15 ; Color del borde 1=negro
     250.  00:4192                      
     251.  00:4192  3E 05                   ld  a,5     ; La rutina CHGMOD nos obliga a poner en el registro A el modo de pantalla que queremos
     252.  00:4194  CD 5F 00                call CHGMOD ; Mira arriba, pone la explicación
     253.  00:4197                      ;
     254.  00:4197  3A E0 F3                ld a,(RG15AV) ; esta dirección de memoria almacena el valor del registro de lectura del VDP, mira arriba
     255.  00:419A                          ;En or 0+0=0, 0+1=1, 1+1=1
     256.  00:419A                          ;En and 0+0=0, 0+1=0, 1+1=1
     257.  00:419A                          ;Con eso queremos cambiar los bits 7 y 8 del registro de escritura 1 del z80, queremos poner el 7 a 1 y también el 8 a 1
     258.  00:419A                          ;el bit 7 del registro 1 pone los sprites en modo 16x16 (los que nostros queremos dibujar)
     259.  00:419A                          ;el bit 8 queremos desactivarlo para no utilizar los sprites agrandados
     260.  00:419A  F6 02                   or 00000010b ; con or poniendo un 0 siempre respetamos los bits que hay y poniendo 1 1 obligamos a que sea 1
     261.  00:419C                          ;and 11111110b ; con and obligamos a que el ultimo bit valga 0
     262.  00:419C  E6 FE                   and 11111110b ; con and obligamos a que el ultimo bit valga 0
     263.  00:419E                      
     264.  00:419E  47                      ld b,a ;carga en b el valor de a
     265.  00:419F  0E 01                   ld c,1 ; La rutina WRTVDP necesta que le carguemos previamente el entero en C del z80 del registro que queroms modificar
     266.  00:41A1  CD 47 00                call WRTVDP ;Escribe en los registros del VDP 
     267.  00:41A4  AF                      xor a ; ld a,0
     268.  00:41A5  32 DB F3            	ld [CLIKSW],a ; Variable BIOS desactivar sonido teclas
     269.  00:41A8  C9                      ret
     270.  00:41A9                      
     271.  00:41A9                      DUMP_SPR_ALL:
     272.  00:41A9                      
     273.  00:41A9                      ;-----------------------------Definición del sprite en #7800  y volcado a la VRAM-------------------------------------------
     274.  00:41A9                      
     275.  00:41A9  21 2E 61                ld hl, SPRITE_PATTERN ; la rutina LDIRVM necesita haber cargado previamente la dirección de inicio de la RAM, para saber porqué he puesto 03800 fíjate este dibujo https://sites.google.com/site/multivac7/files-images/TMS9918_VRAMmap_G2_300dpi.png ,así es como está formado el VDP en screen 2
     276.  00:41AC  11 00 78                ld de, #7800; la rutina necesita haber cargado previamente con de la dirección de inicio de la VRAM          
     277.  00:41AF  01 E0 02                ld bc, 8*4*23; 8 byte de cada tile * 4 que son los sprites de 16x16 y * #sprites
     278.  00:41B2  CD 5C 00                call  LDIRVM ; Mira arriba, pone la explicación
     279.  00:41B5                      
     280.  00:41B5                      ;-----------------------------Definición de los atributos en #7600 y volcado a la VRAM------------------------------------
     281.  00:41B5                      
     282.  00:41B5  21 19 C0                ld hl, SPRITE_ATTRS ; la rutina LDIRVM necesita haber cargado previamente la dirección de inicio de la RAM, para saber porqué he puesto 0000 fíjate este dibujo https://sites.google.com/site/multivac7/files-images/TMS9918_VRAMmap_G2_300dpi.png ,así es como está formado el VDP en screen 2
     283.  00:41B8  11 00 76                ld de, #7600; la rutina necesita haber cargado previamente con de la dirección de inicio de la VRAM          
     284.  00:41BB  01 80 00                ld bc,128; 4 x #Sprites
     285.  00:41BE  CD 5C 00                call  LDIRVM ; Mira arriba, pone la explicación
     286.  00:41C1                      
     287.  00:41C1                      ;-----------------------------Definición de los colores en #7400 y volcado a la VRAM------------------------------------
     288.  00:41C1                      
     289.  00:41C1  21 0E 64                ld hl, SPRITE_COLOR_TABLE ; la rutina LDIRVM necesita haber cargado previamente la dirección de inicio de la RAM, para saber porqué he puesto 0000 fíjate este dibujo https://sites.google.com/site/multivac7/files-images/TMS9918_VRAMmap_G2_300dpi.png ,así es como está formado el VDP en screen 2
     290.  00:41C4  11 00 74                ld de, #7400; la rutina necesita haber cargado previamente con de la dirección de inicio de la VRAM          
     291.  00:41C7  01 70 01                ld bc,16*23; 16 x #Sprites
     292.  00:41CA  CD 5C 00                call  LDIRVM ; Mira arriba, pone la explicación
     293.  00:41CD  C9                      ret
     294.  00:41CE                      	
     295.  00:41CE                      DUMP_SPR_ATTS:
     296.  00:41CE                      
     297.  00:41CE                      ;-----------------------------Definición de los atributos en #1E00 y volcado a la VRAM------------------------------------
     298.  00:41CE                      
     299.  00:41CE  21 19 C0                ld hl, SPRITE_ATTRS ; la rutina LDIRVM necesita haber cargado previamente la dirección de inicio de la RAM, para saber porqué he puesto 0000 fíjate este dibujo https://sites.google.com/site/multivac7/files-images/TMS9918_VRAMmap_G2_300dpi.png ,así es como está formado el VDP en screen 2
     300.  00:41D1  11 00 76                ld de, #7600	; la rutina necesita haber cargado previamente con de la dirección de inicio de la VRAM          
     301.  00:41D4  01 20 00                ld bc,32		; 4 x #Sprites mostrados
     302.  00:41D7  CD 5C 00                call  LDIRVM 	; Mira arriba, pone la explicación
     303.  00:41DA                      
     304.  00:41DA                      ;	ld a, (SPRITE_COLOR_REPLACE2)
     305.  00:41DA                      ;	JP Z,.DUMP_SPR_ATTS_END
     306.  00:41DA  2A A0 C0            	ld hl, (SPRITE_COLOR_REPLACE2) ; la rutina LDIRVM necesita haber cargado previamente la dirección de inicio de la RAM, para saber porqué he puesto 0000 fíjate este dibujo https://sites.google.com/site/multivac7/files-images/TMS9918_VRAMmap_G2_300dpi.png ,así es como está formado el VDP en screen 2
     307.  00:41DD  11 00 74                ld de, #7400; la rutina necesita haber cargado previamente con de la dirección de inicio de la VRAM          
     308.  00:41E0  C5                      PUSH BC
     309.  00:41E1  01 30 00            	ld bc,16*3; 16 x #Sprites
     310.  00:41E4  CD 5C 00                call  LDIRVM 
     311.  00:41E7  C1                  	POP BC
     312.  00:41E8                      
     313.  00:41E8                      .DUMP_SPR_ATTS_END:
     314.  00:41E8  C9                      ret
     315.  00:41E9                      
     316.  00:41E9                      DUMP_SPR_P1:    
     317.  00:41E9                      ;-----------------------------Definición del sprite en #7800  y volcado a la VRAM-------------------------------------------
     318.  00:41E9                      
     319.  00:41E9  2A 9C C0                ld hl, (SPRITE_PTR_REPLACE) ; la rutina LDIRVM necesita haber cargado previamente la dirección de inicio de la RAM, para saber porqué he puesto 03800 fíjate este dibujo https://sites.google.com/site/multivac7/files-images/TMS9918_VRAMmap_G2_300dpi.png ,así es como está formado el VDP en screen 2
     320.  00:41EC  11 00 78                ld de, #7800; la rutina necesita haber cargado previamente con de la dirección de inicio de la VRAM          
     321.  00:41EF  C5                      PUSH BC
     322.  00:41F0  01 C0 00            	ld bc, 192; 32 bytes por sprite * 3 planos * 2 frames
     323.  00:41F3  CD 5C 00                call  LDIRVM 
     324.  00:41F6  C1                  	POP BC
     325.  00:41F7                      
     326.  00:41F7                      ;-----------------------------Definición de los colores en #7400 y volcado a la VRAM------------------------------------
     327.  00:41F7                      
     328.  00:41F7  2A 9E C0                ld hl, (SPRITE_COLOR_REPLACE) ; la rutina LDIRVM necesita haber cargado previamente la dirección de inicio de la RAM, para saber porqué he puesto 0000 fíjate este dibujo https://sites.google.com/site/multivac7/files-images/TMS9918_VRAMmap_G2_300dpi.png ,así es como está formado el VDP en screen 2
     329.  00:41FA  11 00 74                ld de, #7400; la rutina necesita haber cargado previamente con de la dirección de inicio de la VRAM          
     330.  00:41FD  C5                      PUSH BC
     331.  00:41FE  01 30 00            	ld bc,16*3; 16 x #Sprites
     332.  00:4201  CD 5C 00                call  LDIRVM 
     333.  00:4204  C1                  	POP BC
     334.  00:4205                      	
     335.  00:4205                      
     336.  00:4205                      ; Replace 4 sprites(P1) in Sprite Pattern Table
     337.  00:4205                      ;    xor a
     338.  00:4205                      ;	di			; set VRAM address to 1800h
     339.  00:4205                      ;	out (99h),a		; lower byte 00
     340.  00:4205                      ;	ld a,78h + 040h		; upper byte 7800h with flag to set the bus in write mode (3800 VRAM: Sprite Pattern Table)
     341.  00:4205                      ;	ei
     342.  00:4205                      ;	out (99h),a		; note that this is protected by the ei instruction
     343.  00:4205                      ;   push BC
     344.  00:4205                      ;	ld bc,8098h     ; 80h = 128 bytes y port 98h 
     345.  00:4205                      ;	ld hl,(SPRITE_PTR_REPLACE)
     346.  00:4205                      
     347.  00:4205                      ;.loop1:
     348.  00:4205                      ;	outi			; send the data (HL) to port 98h 
     349.  00:4205                      ;	jp nz,.loop1		; the inner loop is exactly 29 cycles. 
     350.  00:4205                      ;   POP BC
     351.  00:4205                      
     352.  00:4205                          ; Replace 2 entries in sprite color table
     353.  00:4205                      ;    xor a
     354.  00:4205                      ;	di			; set VRAM address to 1800h
     355.  00:4205                      ;	out (99h),a		; lower byte 00
     356.  00:4205                      ;	ld a,74h + 040h		; upper byte 7400h with flag to set the bus in write mode (1C00 VRAM: Sprite Color Table)
     357.  00:4205                      ;	ei
     358.  00:4205                      ;	out (99h),a		; note that this is protected by the ei instruction
     359.  00:4205                       ;   push BC
     360.  00:4205                      ;	ld bc,2098h     ; 20h = 32 bytes y port 98h 
     361.  00:4205                      ;	ld hl,(SPRITE_COLOR_REPLACE)
     362.  00:4205                      	
     363.  00:4205                      ;.loop2:
     364.  00:4205                      ;	outi			; send the data (HL) to port 98h 
     365.  00:4205                      ;	jp nz,.loop2		; the inner loop is exactly 29 cycles. 
     366.  00:4205                       ;   POP BC
     367.  00:4205                      
     368.  00:4205  C9                      ret
     369.  00:4206                      
     370.  00:4206                      SetPalette:
     371.  00:4206  AF                  	xor a
     372.  00:4207  F3                  	di
     373.  00:4208  D3 99               	out ($99),a
     374.  00:420A  3E 90               	ld a,16+128
     375.  00:420C  D3 99               	out ($99),a
     376.  00:420E  01 9A 20            	ld bc,$209A
     377.  00:4211  ED B3               	otir
     378.  00:4213  FB                  	ei
     379.  00:4214  C9                  	ret
      26   00:4215                          include "include\BTH_animate.asm"
       1.  00:4215                      ; Movimiento P1
       2.  00:4215                      move_up:
       3.  00:4215  A9                      XOR C               ; Reseteamos la entrada del teclado
       4.  00:4216                          ; Actualizamos la última tecla de dirección pulsada
       5.  00:4216  AF                      XOR A
       6.  00:4217  32 14 C0                LD (CHAR_NEW_DIR_MAIN),A
       7.  00:421A  CD 48 43                CALL CHECK_DIRECTION_MAIN
       8.  00:421D                      
       9.  00:421D  DD 7E 00                ld a,(ix); obtenemos el valor actual de la posicion y
      10.  00:4220  D6 01                   sub 1 ; decrementamos en 1 el valor, aunque realmente será dos por el desplazamiento de la Y que hace el VDP
      11.  00:4222  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
      12.  00:4223  DD 7E 01                ld a,(ix+1)
      13.  00:4226  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
      14.  00:4227  CD 98 40                call get_bloque_en_X_Y
      15.  00:422A  FE 01                   cp 1
      16.  00:422C  CA 41 44                jp z,NO_MOVEMENT
      17.  00:422F                      
      18.  00:422F  DD 7E 00                ld a,(ix); obtenemos el valor actual de la posicion y
      19.  00:4232  D6 01                   sub 1 ; decrementamos en 1 el valor, aunque realmente será dos por el desplazamiento de la Y que hace el VGP
      20.  00:4234  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
      21.  00:4235  DD 7E 01                ld a,(ix+1)
      22.  00:4238  C6 0A                   add 10 ; miramos la segunda tile 8+2
      23.  00:423A  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
      24.  00:423B  CD 98 40                call get_bloque_en_X_Y
      25.  00:423E  FE 01                   cp 1
      26.  00:4240  CA 41 44                jp z,NO_MOVEMENT
      27.  00:4243                            
      28.  00:4243  3E FF               	LD A, -MOV_SPEED
      29.  00:4245  32 0B C0            	LD (CHAR_SPEED_Y), A
      30.  00:4248  CD D5 43                call UPDATE_MOVEMENT   
      31.  00:424B  CD FD 43                call ANIMATE_P1
      32.  00:424E                          ;JP no_arrows
      33.  00:424E  C9                      ret
      34.  00:424F                      
      35.  00:424F                      move_down:
      36.  00:424F  A9                      XOR C               ; Reseteamos la entrada del teclado
      37.  00:4250                          ; Actualizamos la última tecla de dirección pulsada
      38.  00:4250  3E 01                   LD A,$01
      39.  00:4252  32 14 C0                LD (CHAR_NEW_DIR_MAIN),A
      40.  00:4255  CD 48 43                CALL CHECK_DIRECTION_MAIN
      41.  00:4258                      
      42.  00:4258  DD 7E 00                ld a,(ix); obtenemos el valor actual de la posicion y
      43.  00:425B  C6 11                   add 17 ; incrementamos en 15+2 el valor
      44.  00:425D  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
      45.  00:425E  DD 7E 01                ld a,(ix+1)
      46.  00:4261  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
      47.  00:4262  CD 98 40                call get_bloque_en_X_Y
      48.  00:4265  FE 01                   cp 1
      49.  00:4267  CA 41 44                jp z,NO_MOVEMENT
      50.  00:426A                      
      51.  00:426A  DD 7E 00                ld a,(ix); obtenemos el valor actual de la posicion y
      52.  00:426D  C6 11                   add 17 ; incrementamos en 15 el valor
      53.  00:426F  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
      54.  00:4270  DD 7E 01                ld a,(ix+1)
      55.  00:4273  C6 0A                   add 10 ; miramos la segunda tile 8+2
      56.  00:4275  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision    
      57.  00:4276  CD 98 40                call get_bloque_en_X_Y
      58.  00:4279  FE 01                   cp 1
      59.  00:427B  CA 41 44                jp z,NO_MOVEMENT
      60.  00:427E                          
      61.  00:427E  3E 01                   LD A, MOV_SPEED
      62.  00:4280  32 0B C0            	LD (CHAR_SPEED_Y), A
      63.  00:4283  CD D5 43                call UPDATE_MOVEMENT    
      64.  00:4286  CD FD 43                call ANIMATE_P1
      65.  00:4289                          ;JP no_arrows
      66.  00:4289  C9                      ret
      67.  00:428A                      
      68.  00:428A                      move_right:
      69.  00:428A  A9                      XOR C               ; Reseteamos la entrada del teclado
      70.  00:428B                          ; Actualizamos la última tecla de dirección pulsada
      71.  00:428B  CB 69                   BIT KB_UP, C
      72.  00:428D  28 0C                   JR z, .KB_UPDOWN_PRESSED
      73.  00:428F  CB 71                   BIT KB_DOWN, C
      74.  00:4291  28 08                   JR z, .KB_UPDOWN_PRESSED
      75.  00:4293  3E 03                   LD A,$03
      76.  00:4295  32 14 C0                LD (CHAR_NEW_DIR_MAIN),A
      77.  00:4298  CD 48 43                CALL CHECK_DIRECTION_MAIN
      78.  00:429B                      
      79.  00:429B                      .KB_UPDOWN_PRESSED:
      80.  00:429B  DD 7E 01                ld a,(ix+1); obtenemos el valor actual de la posicion x   
      81.  00:429E  C6 10                   add 16; incrementamos en 3 el valor
      82.  00:42A0  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
      83.  00:42A1  DD 7E 00                ld a,(ix)   ;obtenemos el valor actual de la posicion Y
      84.  00:42A4  C6 01                   add 1   ; incrementamos en 1 por el desplazamiento del VGP
      85.  00:42A6  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
      86.  00:42A7  CD 98 40                call get_bloque_en_X_Y
      87.  00:42AA  FE 01                   cp 1
      88.  00:42AC  CA 41 44                jp z,NO_MOVEMENT
      89.  00:42AF                      
      90.  00:42AF                          ;Miramos el tile del byte inferior del sprite - centro personaje
      91.  00:42AF  DD 7E 01                ld a,(ix+1); obetenemos el valor actual de la posicion x   
      92.  00:42B2  C6 10                   add 16; incrementamos en 2 tiles el valor
      93.  00:42B4  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
      94.  00:42B5  DD 7E 00                ld a,(ix) ;obtenemos el valor actual de la posicion y
      95.  00:42B8  C6 08                   add 8 ; Añadimos 8 para mirar el tile inferior - centro
      96.  00:42BA  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
      97.  00:42BB  CD 98 40                call get_bloque_en_X_Y
      98.  00:42BE  FE 01                   cp 1
      99.  00:42C0  CA 41 44                jp z,NO_MOVEMENT
     100.  00:42C3                      
     101.  00:42C3                          ;Miramos el tile del byte inferior del sprite - esquina inferior derecha
     102.  00:42C3  DD 7E 01                ld a,(ix+1); obetenemos el valor actual de la posicion x   
     103.  00:42C6  C6 10                   add 16; incrementamos en 2 tiles el valor
     104.  00:42C8  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
     105.  00:42C9  DD 7E 00                ld a,(ix) ;obtenemos el valor actual de la posicion y
     106.  00:42CC  C6 0F                   add 15 ; Añadimos 8+1 para mirar la esquina inferior derecha del tile inferior
     107.  00:42CE  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
     108.  00:42CF  CD 98 40                call get_bloque_en_X_Y
     109.  00:42D2  FE 01                   cp 1
     110.  00:42D4  CA 41 44                jp z,NO_MOVEMENT    
     111.  00:42D7                          
     112.  00:42D7  3E 01                   LD A, MOV_SPEED
     113.  00:42D9  32 0A C0            	LD (CHAR_SPEED_X), A
     114.  00:42DC  CD D5 43                call UPDATE_MOVEMENT
     115.  00:42DF  CB 69                   BIT KB_UP, C
     116.  00:42E1  C8                      ret z
     117.  00:42E2  CB 71                   BIT KB_DOWN, C
     118.  00:42E4  C8                      ret z
     119.  00:42E5  CD FD 43                call ANIMATE_P1    
     120.  00:42E8  C9                      ret
     121.  00:42E9                      
     122.  00:42E9                      move_left:
     123.  00:42E9  A9                      XOR C               ; Reseteamos la entrada del teclado
     124.  00:42EA                          ; Actualizamos la última tecla de dirección pulsada
     125.  00:42EA  CB 69                   BIT KB_UP, C
     126.  00:42EC  28 0C                   JR z, .KB_UPDOWN_PRESSED
     127.  00:42EE  CB 71                   BIT KB_DOWN, C
     128.  00:42F0  28 08                   JR z, .KB_UPDOWN_PRESSED
     129.  00:42F2  3E 02                   LD A,$02
     130.  00:42F4  32 14 C0                LD (CHAR_NEW_DIR_MAIN),A
     131.  00:42F7  CD 48 43                CALL CHECK_DIRECTION_MAIN
     132.  00:42FA                      .KB_UPDOWN_PRESSED:
     133.  00:42FA  DD 7E 01                ld a,(ix+1); obetenemos el valor actual de la posicion x
     134.  00:42FD  D6 02                   sub 2 ; decrementamos en 2 el valor
     135.  00:42FF  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
     136.  00:4300  DD 7E 00                ld a,(ix)   ;obtenemos el valor actual de la posicion Y
     137.  00:4303  C6 01                   add 1   ; incrementamos en 1 por el desplazamiento del VGP
     138.  00:4305  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
     139.  00:4306  CD 98 40                call get_bloque_en_X_Y
     140.  00:4309  FE 01                   cp 1
     141.  00:430B  CA 41 44                jp z,NO_MOVEMENT
     142.  00:430E                      
     143.  00:430E                          ;Miramos el tile inferior parte central del personaje
     144.  00:430E  DD 7E 01                ld a,(ix+1); obetenemos el valor actual de la posicion x
     145.  00:4311  D6 02                   sub 2 ; decrementamos en 2 el valor
     146.  00:4313  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
     147.  00:4314  DD 7E 00                ld a,(ix)   ;obtenemos el valor actual de la posicion Y
     148.  00:4317  C6 08                   add 8   ; incrementamos en 8 para mirar la parte central del personaje
     149.  00:4319  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
     150.  00:431A  CD 98 40                call get_bloque_en_X_Y
     151.  00:431D  FE 01                   cp 1
     152.  00:431F  CA 41 44                jp z,NO_MOVEMENT
     153.  00:4322                      
     154.  00:4322                          ;Miramos el tile inferior esquina inferior izquierda
     155.  00:4322  DD 7E 01                ld a,(ix+1); obetenemos el valor actual de la posicion x
     156.  00:4325  D6 02                   sub 2 ; decrementamos en 2 el valor
     157.  00:4327  57                      ld d,a  ; Metemos el parametro X para verificar si hay colision
     158.  00:4328  DD 7E 00                ld a,(ix)   ;obtenemos el valor actual de la posicion Y
     159.  00:432B  C6 0F                   add 15   ; incrementamos en 8 para mirar la parte central del personaje (-1 por el offset del VGP)
     160.  00:432D  5F                      ld e,a  ; Metemos el parametro Y para verificar si hay colision
     161.  00:432E  CD 98 40                call get_bloque_en_X_Y
     162.  00:4331  FE 01                   cp 1
     163.  00:4333  CA 41 44                jp z,NO_MOVEMENT
     164.  00:4336                      
     165.  00:4336  3E FF                   LD A, -MOV_SPEED
     166.  00:4338  32 0A C0            	LD (CHAR_SPEED_X), A
     167.  00:433B  CD D5 43                call UPDATE_MOVEMENT     
     168.  00:433E  CB 69                   BIT KB_UP, C
     169.  00:4340  C8                      ret z
     170.  00:4341  CB 71                   BIT KB_DOWN, C
     171.  00:4343  C8                      ret z
     172.  00:4344  CD FD 43                call ANIMATE_P1    
     173.  00:4347  C9                      ret
     174.  00:4348                      
     175.  00:4348                      CHECK_DIRECTION_MAIN:
     176.  00:4348  3A 13 C0                LD A, (CHAR_DIR_MAIN)		                ;Cargamos el valor anterior de direccion
     177.  00:434B  2A 14 C0            	LD HL, (CHAR_NEW_DIR_MAIN)		            ;Cargamos el valor actual de direccion
     178.  00:434E  BD                  	CP L		            	                ;Son iguales?
     179.  00:434F  C8                  	RET Z                           			;Si son iguales, vuelvo
     180.  00:4350  3A 14 C0                LD A,(CHAR_NEW_DIR_MAIN)
     181.  00:4353  FE 01                   CP $01
     182.  00:4355  CA 6A 43                JP Z,.SET_DIR_DOWN
     183.  00:4358  FE 00                   CP $00
     184.  00:435A  CA 7F 43                JP Z,.SET_DIR_UP
     185.  00:435D  FE 03                   CP $03
     186.  00:435F  CA A9 43                JP Z,.SET_DIR_RIGHT
     187.  00:4362  FE 02                   CP $02
     188.  00:4364  CA 94 43                JP Z,.SET_DIR_LEFT
     189.  00:4367  C3 BE 43                JP .FINISH
     190.  00:436A                          
     191.  00:436A                      .SET_DIR_DOWN:    
     192.  00:436A  21 EE 5E                ld hl, SPRITE_P1_DOWN
     193.  00:436D  22 9C C0                ld (SPRITE_PTR_REPLACE), HL
     194.  00:4370                          
     195.  00:4370  21 EE 64                ld hl, SPRITE_COLOR_P1_DOWN
     196.  00:4373  22 9E C0                ld (SPRITE_COLOR_REPLACE), HL    
     197.  00:4376  22 A0 C0                ld (SPRITE_COLOR_REPLACE2), HL
     198.  00:4379  CD E9 41                CALL DUMP_SPR_P1    
     199.  00:437C                      
     200.  00:437C  C3 BE 43                JP .FINISH
     201.  00:437F                      
     202.  00:437F                      .SET_DIR_UP:
     203.  00:437F  21 2E 5E                ld hl, SPRITE_P1_UP
     204.  00:4382  22 9C C0                ld (SPRITE_PTR_REPLACE), HL
     205.  00:4385                          
     206.  00:4385  21 8E 64                ld hl, SPRITE_COLOR_P1_UP
     207.  00:4388  22 9E C0                ld (SPRITE_COLOR_REPLACE), HL
     208.  00:438B  22 A0 C0                ld (SPRITE_COLOR_REPLACE2), HL
     209.  00:438E  CD E9 41                CALL DUMP_SPR_P1
     210.  00:4391  C3 BE 43                JP .FINISH
     211.  00:4394                      
     212.  00:4394                      .SET_DIR_LEFT:    
     213.  00:4394  21 AE 5F                ld hl, SPRITE_P1_LEFT
     214.  00:4397  22 9C C0                ld (SPRITE_PTR_REPLACE), HL
     215.  00:439A                          
     216.  00:439A  21 8E 6F                ld hl, SPRITE_COLOR_P1_LEFT
     217.  00:439D  22 9E C0                ld (SPRITE_COLOR_REPLACE), HL
     218.  00:43A0  22 A0 C0                ld (SPRITE_COLOR_REPLACE2), HL
     219.  00:43A3  CD E9 41                CALL DUMP_SPR_P1   
     220.  00:43A6  C3 BE 43                JP .FINISH
     221.  00:43A9                      
     222.  00:43A9                      .SET_DIR_RIGHT:
     223.  00:43A9  21 6E 60                ld hl, SPRITE_P1_RIGHT
     224.  00:43AC  22 9C C0                ld (SPRITE_PTR_REPLACE), HL
     225.  00:43AF                          
     226.  00:43AF  21 4E 65                ld hl, SPRITE_COLOR_P1_RIGHT
     227.  00:43B2  22 9E C0                ld (SPRITE_COLOR_REPLACE), HL
     228.  00:43B5  22 A0 C0                ld (SPRITE_COLOR_REPLACE2), HL
     229.  00:43B8                          ;    ld (ix+13), $10      ; Sprite 1 - Ghost
     230.  00:43B8  CD E9 41                CALL DUMP_SPR_P1
     231.  00:43BB  C3 BE 43                JP .FINISH
     232.  00:43BE                      
     233.  00:43BE                      .FINISH:
     234.  00:43BE  AF                      XOR A   ; reseteamos el contador de pasos
     235.  00:43BF  32 16 C0                LD (CHAR_MIN_STEP), A   
     236.  00:43C2  3A 14 C0                LD A, (CHAR_NEW_DIR_MAIN)   ; Actualizamos la nueva dirección del personaje
     237.  00:43C5  32 13 C0                LD (CHAR_DIR_MAIN),A    
     238.  00:43C8                      
     239.  00:43C8                          ; ponemos el primer frame del sprite
     240.  00:43C8  DD 36 02 00             LD (ix+2), $00
     241.  00:43CC  DD 36 06 04             LD (ix+6), $04
     242.  00:43D0  DD 36 0A 08             LD (ix+10), $08
     243.  00:43D4                          ;CALL DUMP_SPR_ATTS
     244.  00:43D4  C9                      RET
     245.  00:43D5                      
     246.  00:43D5                      UPDATE_MOVEMENT:
     247.  00:43D5  DD 7E 00            	LD A, (ix)          ;cargamos la Y			
     248.  00:43D8  2A 0B C0            	LD HL, (CHAR_SPEED_Y)
     249.  00:43DB  85                  	ADD L					; Actualizamos la posicion en base a la velocidad
     250.  00:43DC                          
     251.  00:43DC  DD 77 00            	LD (ix), A
     252.  00:43DF  DD 77 04                LD (ix+4), A
     253.  00:43E2  DD 77 08                LD (ix+8), A
     254.  00:43E5                      	
     255.  00:43E5  DD 7E 01            	LD A, (ix+1)			;cargamos la X
     256.  00:43E8  2A 0A C0            	LD HL, (CHAR_SPEED_X)
     257.  00:43EB  85                  	ADD L   					; Actualizamos la posicion en base a la velocidad
     258.  00:43EC                          
     259.  00:43EC  DD 77 01            	LD (ix+1), A
     260.  00:43EF  DD 77 05                LD (ix+5), A
     261.  00:43F2  DD 77 09                LD (ix+9), A	
     262.  00:43F5                      
     263.  00:43F5  AF                      XOR A            ; reseteamos las variables de movimiento para el siguiente ciclo
     264.  00:43F6  32 0A C0                LD (CHAR_SPEED_X),A
     265.  00:43F9  32 0B C0                LD (CHAR_SPEED_Y),A	
     266.  00:43FC  C9                      RET
     267.  00:43FD                      
     268.  00:43FD                      ANIMATE_P1:
     269.  00:43FD                          ; Animación/pasos de personaje	
     270.  00:43FD  3A 16 C0                LD A, (CHAR_MIN_STEP)
     271.  00:4400  FE 05                   CP MAX_CHAR_STEPS
     272.  00:4402  C2 3B 44                JP NZ,.NO_CHAR_PATTERN_CHANGE
     273.  00:4405                          
     274.  00:4405  AF                      XOR A
     275.  00:4406  32 16 C0                LD (CHAR_MIN_STEP), A   ; reseteamos el contador de pasos
     276.  00:4409  DD 7E 02                LD A, (ix+2)    ; Cargamos el patrón
     277.  00:440C  FE 00                   CP $00
     278.  00:440E  CA 24 44                JP Z,.SET_SPR_1P_2
     279.  00:4411  DD 36 02 00             LD (ix+2), $00
     280.  00:4415  DD 36 06 04             LD (ix+6), $04
     281.  00:4419  DD 36 0A 08             LD (ix+10), $08
     282.  00:441D  2A 9E C0                ld hl, (SPRITE_COLOR_REPLACE)
     283.  00:4420  22 A0 C0                ld (SPRITE_COLOR_REPLACE2), HL
     284.  00:4423  C9                      ret
     285.  00:4424                      
     286.  00:4424                      .SET_SPR_1P_2:
     287.  00:4424  DD 36 02 0C             LD (ix+2), $0C
     288.  00:4428  DD 36 06 10             LD (ix+6), $10
     289.  00:442C  DD 36 0A 14             LD (ix+10), $14
     290.  00:4430                              
     291.  00:4430  2A 9E C0                ld HL, (SPRITE_COLOR_REPLACE)
     292.  00:4433  11 30 00                ld DE,48
     293.  00:4436  19                      ADD HL, DE
     294.  00:4437  22 A0 C0                ld (SPRITE_COLOR_REPLACE2), HL
     295.  00:443A                          ;ld a, 0
     296.  00:443A  C9                  	ret
     297.  00:443B                      
     298.  00:443B                      .NO_CHAR_PATTERN_CHANGE    
     299.  00:443B  C6 01                   ADD 1
     300.  00:443D  32 16 C0                LD (CHAR_MIN_STEP), A    
     301.  00:4440  C9                      ret
     302.  00:4441                      
     303.  00:4441                      NO_MOVEMENT:    
     304.  00:4441  C9                      ret
     305.  00:4442                      
     306.  00:4442                      MOVE_SHOOT:
     307.  00:4442  3A 15 C0                LD A,(CHAR_MAIN_SHOOT)    
     308.  00:4445  FE 01                   CP $01
     309.  00:4447  CA 72 44                JP Z,.MOVE_SHOOT_LEFT
     310.  00:444A  FE 02                   CP $02
     311.  00:444C  CA 5A 44                JP Z,.MOVE_SHOOT_RIGHT
     312.  00:444F  FE 03                   CP $03
     313.  00:4451  CA 62 44                JP Z,.MOVE_SHOOT_UP    
     314.  00:4454  FE 04                   CP $04
     315.  00:4456  CA 6A 44                JP Z,.MOVE_SHOOT_DOWN
     316.  00:4459  C9                      RET
     317.  00:445A                      
     318.  00:445A                      .MOVE_SHOOT_RIGHT:        
     319.  00:445A  3E 03                   LD A, MOV_SPEED_SHOOT
     320.  00:445C  32 18 C0            	LD (CHAR_SPEED_SHOOT), A    
     321.  00:445F  C3 77 44                JP .CHECK_SHOOT_DISTANCE
     322.  00:4462                      
     323.  00:4462                      .MOVE_SHOOT_UP:        
     324.  00:4462  3E FD                   LD A, -MOV_SPEED_SHOOT
     325.  00:4464  32 18 C0            	LD (CHAR_SPEED_SHOOT), A    
     326.  00:4467  C3 77 44                JP .CHECK_SHOOT_DISTANCE
     327.  00:446A                      
     328.  00:446A                      .MOVE_SHOOT_DOWN:
     329.  00:446A  3E 03                   LD A, MOV_SPEED_SHOOT
     330.  00:446C  32 18 C0            	LD (CHAR_SPEED_SHOOT), A    
     331.  00:446F  C3 77 44                JP .CHECK_SHOOT_DISTANCE
     332.  00:4472                      
     333.  00:4472                      .MOVE_SHOOT_LEFT:    
     334.  00:4472  3E FD                   LD A, -MOV_SPEED_SHOOT
     335.  00:4474  32 18 C0            	LD (CHAR_SPEED_SHOOT), A    
     336.  00:4477                      
     337.  00:4477                      .CHECK_SHOOT_DISTANCE:
     338.  00:4477                          ; Miramos si va a izq o der
     339.  00:4477  3A 15 C0                LD A,(CHAR_MAIN_SHOOT)    
     340.  00:447A  D6 03                   SUB 3   ; Restar 3 a 1 o 2 provoca salto de carro, si es 3 o 4 no provoca el salto de carro
     341.  00:447C  D2 8C 44                JP NC,.ADD_SHOOT_Y
     342.  00:447F                          ; Movemos el disparo
     343.  00:447F  DD 7E 0D                LD A, (ix+SPR_SHOOT_P1+1)          ;cargamos la X del disparo
     344.  00:4482  2A 18 C0            	LD HL, (CHAR_SPEED_SHOOT)
     345.  00:4485  85                  	ADD L					; Actualizamos la posicion en base a la velocidad
     346.  00:4486  DD 77 0D                LD (ix+SPR_SHOOT_P1+1), A
     347.  00:4489  C3 96 44                JP .ADD_DISTANCE
     348.  00:448C                      .ADD_SHOOT_Y
     349.  00:448C                          ; Movemos el disparo
     350.  00:448C  DD 7E 0C                LD A, (ix+SPR_SHOOT_P1)          ;cargamos la X del disparo
     351.  00:448F  2A 18 C0            	LD HL, (CHAR_SPEED_SHOOT)
     352.  00:4492  85                  	ADD L					; Actualizamos la posicion en base a la velocidad
     353.  00:4493  DD 77 0C                LD (ix+SPR_SHOOT_P1), A
     354.  00:4496                      
     355.  00:4496                      .ADD_DISTANCE:
     356.  00:4496  3A 17 C0                LD A,(CHAR_DISTANCE_SHOOT)
     357.  00:4499  C6 03                   ADD MOV_SPEED_SHOOT
     358.  00:449B  32 17 C0                LD (CHAR_DISTANCE_SHOOT),A    
     359.  00:449E  FE 30                   CP MAX_DISTANCE_SHOOT
     360.  00:44A0  C0                      RET NZ
     361.  00:44A1                      
     362.  00:44A1                      .HIDE_SHOOT:
     363.  00:44A1  DD 36 0C D9             LD (ix+SPR_SHOOT_P1),217          ; Y = 217 para ocultar el Sprite
     364.  00:44A5  AF                      XOR A
     365.  00:44A6  32 15 C0                LD (CHAR_MAIN_SHOOT),A   ; Desactivo el estado disparando 
     366.  00:44A9  32 17 C0                LD (CHAR_DISTANCE_SHOOT),A
     367.  00:44AC  C9                      RET
     368.  00:44AD                      
      27   00:44AD                      	include "include\VDP.asm"
       1.  00:44AD                      print_strings_dialog_box:
       2.  00:44AD                      
       3.  00:44AD  FD 66 01            	LD H, (IY+1)
       4.  00:44B0  FD 6E 00            	LD L, (IY)
       5.  00:44B3  11 28 5C            	LD DE, FIRST_LINE_DLG_BOX	; Aquí irá el offset de la memoria del VDP en base a X, Y
       6.  00:44B6  FD E5               	PUSH IY
       7.  00:44B8  CD DA 44                call print_string 
       8.  00:44BB  FD E1                   POP IY
       9.  00:44BD                      
      10.  00:44BD  FD 66 03            	LD H, (IY+3)
      11.  00:44C0  FD 6E 02            	LD L, (IY+2)
      12.  00:44C3  11 28 60                LD DE, SEC_LINE_DLG_BOX	; Aquí irá el offset de la memoria del VDP en base a X, Y    
      13.  00:44C6  FD E5               	PUSH IY
      14.  00:44C8  CD DA 44                call print_string 
      15.  00:44CB  FD E1               	POP IY
      16.  00:44CD                      
      17.  00:44CD  FD 66 05                LD H, (IY+5)
      18.  00:44D0  FD 6E 04            	LD L, (IY+4)
      19.  00:44D3  11 28 64            	LD DE, THIRD_LINE_DLG_BOX	; Aquí irá el offset de la memoria del VDP en base a X, Y
      20.  00:44D6  CD DA 44                call print_string 
      21.  00:44D9  C9                  	RET
      22.  00:44DA                      
      23.  00:44DA                      print_string:       
      24.  00:44DA                      	
      25.  00:44DA                      	;LD HL, string01
      26.  00:44DA                      	;LD DE, 5CA8H	; Aquí irá el offset de la memoria del VDP en base a X, Y
      27.  00:44DA                      .loop_str:
      28.  00:44DA  7E                  	LD A, (HL)
      29.  00:44DB  A7                  	AND A
      30.  00:44DC  C8                  	RET Z
      31.  00:44DD                      
      32.  00:44DD  D6 20               	SUB 32
      33.  00:44DF  CB 07               	RLC A
      34.  00:44E1  CB 07               	RLC A	
      35.  00:44E3                          
      36.  00:44E3  06 00               	LD B, 0
      37.  00:44E5  4F                  	LD C, A	; 4 * 32 = 124, ultimo caractec primera linea. 1024 - primer caracter segunda linea
      38.  00:44E6                      				; 16 * 4 = 64 -> numero 0 - ASCII 48 - 32 = 16 * 4 = 64 offset número 0
      39.  00:44E6                      				; Si #ASCII > 63 -> 2ª línea
      40.  00:44E6                      				; segunda línea - ((#ASCII -32)*4)+1024
      41.  00:44E6                      	
      42.  00:44E6  7E                  	LD A, (HL)	; vuelvo a cargar el caracter para ver si está en la segunda línea (ascii > 63)
      43.  00:44E7  E5                  	PUSH HL
      44.  00:44E8  21 00 80            	LD HL, FONT
      45.  00:44EB  09                  	ADD HL, BC
      46.  00:44EC  FE 40               	CP 64
      47.  00:44EE  DA F5 44            	JP C, .first_line_font
      48.  00:44F1  01 00 04            	LD BC, 1024	; le sumamos 1024 para saltar a la segunda línea de la fuente
      49.  00:44F4  09                  	ADD HL, BC
      50.  00:44F5                      
      51.  00:44F5                      .first_line_font:
      52.  00:44F5  22 A4 C0                LD (BITMAP), HL
      53.  00:44F8                          
      54.  00:44F8  06 06               	LD B, :FONT
      55.  00:44FA  D5                  	PUSH DE
      56.  00:44FB  CD 0E 45                call print_char
      57.  00:44FE  D1                      POP DE
      58.  00:44FF                      	
      59.  00:44FF  FD 21 04 00         	LD IY, 4
      60.  00:4503  FD 19               	ADD IY, DE	; Le sumo 4 a DE para que empiece a escribir el next char 8 pixels a la derecha 
      61.  00:4505  FD 54               	LD D, IYH
      62.  00:4507  FD 5D               	LD E, IYL
      63.  00:4509                      	
      64.  00:4509                      
      65.  00:4509  E1                  	POP HL
      66.  00:450A  23                  	INC HL
      67.  00:450B  18 CD               	JR .loop_str
      68.  00:450D                          
      69.  00:450D  C9                      RET
      70.  00:450E                      
      71.  00:450E                      print_char
      72.  00:450E  AF                  		XOR A		
      73.  00:450F  0E 00               		ld		c,0
      74.  00:4511                      		;ld		de,0
      75.  00:4511  ED 53 03 C0         		LD (CHR_ACR), DE
      76.  00:4515  CD 41 41                	call	_vdpsetvramwr		
      77.  00:4518  78                  		ld	a, b			; 1st page bitmap
      78.  00:4519                      		;ld	d,a
      79.  00:4519  32 00 70            		ld	(_bank2),a
      80.  00:451C  2A A4 C0            		ld	hl,(BITMAP)		; Bitmap address
      81.  00:451F  3E 08               		ld	a, 8			; #lineas del caracter
      82.  00:4521  01 98 04            1:      ld	bc,0x498		; escribimos 4 bytes en el puerto 98h	
      83.  00:4524  ED B3                       otir
      84.  00:4526  01 7C 00                    LD BC, 124
      85.  00:4529  09                          ADD HL, BC
      86.  00:452A  F5                  		PUSH AF
      87.  00:452B                      
      88.  00:452B  FD 2A 03 C0         		LD IY, (CHR_ACR)
      89.  00:452F  01 80 00            		LD BC, 128
      90.  00:4532  FD 09               		ADD IY, BC
      91.  00:4534  FD 54               		LD D, IYH
      92.  00:4536  FD 5D               		LD E, IYL
      93.  00:4538  A9                  		XOR C
      94.  00:4539  ED 53 03 C0         		LD (CHR_ACR), DE
      95.  00:453D  CD 41 41            		call	_vdpsetvramwr		
      96.  00:4540  F1                  		POP AF		
      97.  00:4541                      
      98.  00:4541  3D                  		dec	a
      99.  00:4542  20 DD               		jr	nz,1b		
     100.  00:4544  C9                  		ret 
     101.  00:4545                      
     102.  00:4545                      CLEAR_DIALOG_BOX:		
     103.  00:4545  0E 00               		LD C,0
     104.  00:4547  11 28 5C            		LD DE, 5C28H
     105.  00:454A  ED 53 03 C0         		LD (CHR_ACR), DE
     106.  00:454E  CD 41 41            		call _vdpsetvramwr
     107.  00:4551  3E 18               		LD A, 24		; Borraremos 24 líneas de la pantalla
     108.  00:4553  21 EE 6F            1:		LD HL, BLANK_DATA
     109.  00:4556  01 98 54            		LD BC,0x5498	; Escribimos 84 bytes
     110.  00:4559  ED B3               		OTIR
     111.  00:455B                      
     112.  00:455B  F5                  		PUSH AF
     113.  00:455C  FD 2A 03 C0         		LD IY, (CHR_ACR)
     114.  00:4560  01 80 00            		LD BC, 128
     115.  00:4563  FD 09               		ADD IY, BC
     116.  00:4565  FD 54               		LD D, IYH
     117.  00:4567  FD 5D               		LD E, IYL
     118.  00:4569  0E 00               		LD C,0
     119.  00:456B  ED 53 03 C0         		LD (CHR_ACR), DE
     120.  00:456F  CD 41 41            		call	_vdpsetvramwr		
     121.  00:4572  F1                  		POP AF		
     122.  00:4573                      
     123.  00:4573  3D                  		DEC a
     124.  00:4574  20 DD               		JR NZ,1b
     125.  00:4576  C9                  		RET
      28   00:4577                      ; SFX
      29   00:4577                          include	"include\PT3_player.s"
       1.  00:4577                      		; --- PT3 REPLAYER WORKING ON ROM ---
       2.  00:4577                      		; --- Can be assembled with asMSX ---
       3.  00:4577                      		; --- ROM version: MSX-KUN        ---
       4.  00:4577                      		; --- asMSX version 2: SapphiRe   ---
       5.  00:4577                      
       6.  00:4577                      ; Based on MSX full version of PT3 by Dioniso
       7.  00:4577                      ;
       8.  00:4577                      ; This version of the replayer can be used with any note table
       9.  00:4577                      ; This version also allows the use of PT3 commands
      10.  00:4577                      ; First 99 bytes of each PT3 module should be stripped off
      11.  00:4577                      ;
      12.  00:4577                      ; PLAY and PSG WRITE routines seperated to allow independent calls
      13.  00:4577                      ;
      14.  00:4577                      ; ROM LENGTH: 1549 bytes
      15.  00:4577                      ; RAM LENGTH:  576 bytes
      16.  00:4577                      
      17.  00:4577                      
      18.  00:4577                      
      19.  00:4577                      ;SJASM version by BTV 2016
      20.  00:4577                      
      21.  00:4577                      
      22.  00:4577                      		; --- CONSTANT VALUES DEFINITION ---
      23.  00:4577                      
      24.  00:4577                      ;ChannelsVars
      25.  00:4577                      ;struc	CHNPRM
      26.  00:4577                      ;reset group
      27.  00:4577  (00:0000)           CHNPRM_PsInOr	equ 0	;RESB 1
      28.  00:4577  (00:0001)           CHNPRM_PsInSm	equ 1	;RESB 1
      29.  00:4577  (00:0002)           CHNPRM_CrAmSl	equ 2	;RESB 1
      30.  00:4577  (00:0003)           CHNPRM_CrNsSl	equ 3	;RESB 1
      31.  00:4577  (00:0004)           CHNPRM_CrEnSl	equ 4	;RESB 1
      32.  00:4577  (00:0005)           CHNPRM_TSlCnt	equ 5	;RESB 1
      33.  00:4577  (00:0006)           CHNPRM_CrTnSl	equ 6	;RESW 1
      34.  00:4577  (00:0008)           CHNPRM_TnAcc	equ 8	;RESW 1
      35.  00:4577  (00:000A)           CHNPRM_COnOff	equ 10	;RESB 1
      36.  00:4577                      ;reset group
      37.  00:4577                      
      38.  00:4577  (00:000B)           CHNPRM_OnOffD	equ 11	;RESB 1
      39.  00:4577                      
      40.  00:4577                      ;IX for PTDECOD here [+12]
      41.  00:4577  (00:000C)           CHNPRM_OffOnD	equ 12	;RESB 1
      42.  00:4577  (00:000D)           CHNPRM_OrnPtr	equ 13	;RESW 1
      43.  00:4577  (00:000F)           CHNPRM_SamPtr	equ 15	;RESW 1
      44.  00:4577  (00:0011)           CHNPRM_NNtSkp	equ 17	;RESB 1
      45.  00:4577  (00:0012)           CHNPRM_Note	equ 18	;RESB 1
      46.  00:4577  (00:0013)           CHNPRM_SlToNt	equ 19	;RESB 1
      47.  00:4577  (00:0014)           CHNPRM_Env_En	equ 20	;RESB 1
      48.  00:4577  (00:0015)           CHNPRM_Flags	equ 21	;RESB 1
      49.  00:4577                       ;Enabled - 0,SimpleGliss - 2
      50.  00:4577  (00:0016)           CHNPRM_TnSlDl	equ 22	;RESB 1
      51.  00:4577  (00:0017)           CHNPRM_TSlStp	equ 23	;RESW 1
      52.  00:4577  (00:0019)           CHNPRM_TnDelt	equ 25	;RESW 1
      53.  00:4577  (00:001B)           CHNPRM_NtSkCn	equ 27	;RESB 1
      54.  00:4577  (00:001C)           CHNPRM_Volume	equ 28	;RESB 1
      55.  00:4577  (00:001D)           CHNPRM_Size	equ 29	;RESB 1
      56.  00:4577                      ;endstruc
      57.  00:4577                      
      58.  00:4577                      ;struc	AR
      59.  00:4577  (00:0000)           AR_TonA		equ 0	;RESW 1
      60.  00:4577  (00:0002)           AR_TonB		equ 2	;RESW 1
      61.  00:4577  (00:0004)           AR_TonC		equ 4	;RESW 1
      62.  00:4577  (00:0006)           AR_Noise	equ 6	;RESB 1
      63.  00:4577  (00:0007)           AR_Mixer	equ 7	;RESB 1
      64.  00:4577  (00:0008)           AR_AmplA	equ 8	;RESB 1
      65.  00:4577  (00:0009)           AR_AmplB	equ 9	;RESB 1
      66.  00:4577  (00:000A)           AR_AmplC	equ 10	;RESB 1
      67.  00:4577  (00:000B)           AR_Env		equ 11	;RESW 1
      68.  00:4577  (00:000D)           AR_EnvTp	equ 13	;RESB 1
      69.  00:4577                      ;endstruc
      70.  00:4577                      
      71.  00:4577                      		; --- CODE STARTS HERE ---
      72.  00:4577                      
      73.  00:4577  21 00 F0            CHECKLP:	LD	HL,PT3_SETUP
      74.  00:457A  CB FE               		SET	7,[HL]
      75.  00:457C  CB 46               		BIT	0,[HL]
      76.  00:457E  C8                  		RET	Z
      77.  00:457F  E1                  		POP	HL
      78.  00:4580  21 7A F0            		LD	HL,DelyCnt
      79.  00:4583  34                  		INC	[HL]
      80.  00:4584  21 3E F0            		LD	HL,ChanA+CHNPRM_NtSkCn
      81.  00:4587  34                  		INC	[HL]
      82.  00:4588  AF                  PT3_MUTE:	XOR	A
      83.  00:4589  67                  		LD	H,A
      84.  00:458A  6F                  		LD	L,A
      85.  00:458B  32 48 F1            		LD	[AYREGS+AR_AmplA],A
      86.  00:458E  22 49 F1            		LD	[AYREGS+AR_AmplB],HL
      87.  00:4591  C3 DA 4A            		JP	ROUT_A0
      88.  00:4594                      
      89.  00:4594                      PT3_INIT:	;HL - AddressOfModule - 100
      90.  00:4594  22 01 F0            		LD [PT3_MODADDR],HL
      91.  00:4597  E5                  		PUSH HL
      92.  00:4598  11 64 00            		LD DE,100
      93.  00:459B  19                  		ADD HL,DE
      94.  00:459C  7E                  		LD A,[HL]
      95.  00:459D  32 1C F0            		LD [PT3_Delay],A
      96.  00:45A0  E5                  		PUSH HL
      97.  00:45A1  DD E1               		POP IX
      98.  00:45A3  19                  		ADD HL,DE
      99.  00:45A4  22 03 F0            		LD [PT3_CrPsPtr],HL
     100.  00:45A7  DD 5E 02            		LD E,[IX+102-100]
     101.  00:45AA  19                  		ADD HL,DE
     102.  00:45AB  23                  		INC HL
     103.  00:45AC  22 18 F0            		LD [PT3_LPosPtr],HL
     104.  00:45AF  D1                  		POP DE
     105.  00:45B0  DD 6E 03            		LD L,[IX+103-100]
     106.  00:45B3  DD 66 04            		LD H,[IX+104-100]
     107.  00:45B6  19                  		ADD HL,DE
     108.  00:45B7  22 1A F0            		LD [PT3_PatsPtr],HL
     109.  00:45BA  21 A9 00            		LD HL,169
     110.  00:45BD  19                  		ADD HL,DE
     111.  00:45BE  22 07 F0            		LD [PT3_OrnPtrs],HL
     112.  00:45C1  21 69 00            		LD HL,105
     113.  00:45C4  19                  		ADD HL,DE
     114.  00:45C5  22 05 F0            		LD [PT3_SAMPTRS],HL
     115.  00:45C8  21 00 F0            		LD HL,PT3_SETUP
     116.  00:45CB  CB BE               		RES 7,[HL]
     117.  00:45CD                      
     118.  00:45CD                      		; --- note table data depacker ---
     119.  00:45CD                      		; Depacks first 12 tones of each tone table
     120.  00:45CD                      
     121.  00:45CD  11 4E 4B            		LD DE,T_PACK
     122.  00:45D0  01 B1 F1            		LD BC,T1_+(2*49)-1
     123.  00:45D3  1A                  .TP_0:		LD A,[DE]
     124.  00:45D4  13                  		INC DE
     125.  00:45D5  FE 1E               		CP 15*2
     126.  00:45D7  30 06               		JR NC,.TP_1
     127.  00:45D9  67                  		LD H,A
     128.  00:45DA  1A                  		LD A,[DE]
     129.  00:45DB  6F                  		LD L,A
     130.  00:45DC  13                  		INC DE
     131.  00:45DD  18 07               		JR .TP_2
     132.  00:45DF  D5                  .TP_1:		PUSH DE
     133.  00:45E0  16 00               		LD D,0
     134.  00:45E2  5F                  		LD E,A
     135.  00:45E3  19                  		ADD HL,DE
     136.  00:45E4  19                  		ADD HL,DE
     137.  00:45E5  D1                  		POP DE
     138.  00:45E6  7C                  .TP_2:		LD A,H
     139.  00:45E7  02                  		LD [BC],A
     140.  00:45E8  0B                  		DEC BC
     141.  00:45E9  7D                  		LD A,L
     142.  00:45EA  02                  		LD [BC],A
     143.  00:45EB  0B                  		DEC BC
     144.  00:45EC  D6 F0               		SUB $F0
     145.  00:45EE  20 E3               		JR NZ,.TP_0
     146.  00:45F0                      
     147.  00:45F0                      		; --- INITIALIZE PT3 VARIABLES ---
     148.  00:45F0  21 23 F0            		LD HL,VARS
     149.  00:45F3  77                  		LD [HL],A
     150.  00:45F4  11 24 F0            		LD DE,VARS+1
     151.  00:45F7  01 2C 01            		LD BC,VAR0END-VARS-1
     152.  00:45FA  ED B0               		LDIR
     153.  00:45FC                      
     154.  00:45FC  3C                  		INC A
     155.  00:45FD  32 7A F0            		LD [DelyCnt],A
     156.  00:4600  21 01 F0            		LD HL,$F001 ;H - CHNPRM_Volume, L - CHNPRM_NtSkCn
     157.  00:4603  22 3E F0            		LD [ChanA+CHNPRM_NtSkCn],HL
     158.  00:4606  22 5B F0            		LD [ChanB+CHNPRM_NtSkCn],HL
     159.  00:4609  22 78 F0            		LD [ChanC+CHNPRM_NtSkCn],HL
     160.  00:460C                      
     161.  00:460C  21 4A 4B            		LD HL,EMPTYSAMORN
     162.  00:460F  22 12 F0            		LD [PT3_AdInPtA],HL ;ptr to zero
     163.  00:4612  22 30 F0            		LD [ChanA+CHNPRM_OrnPtr],HL ;ornament 0 is "0,1,0"
     164.  00:4615  22 4D F0            		LD [ChanB+CHNPRM_OrnPtr],HL ;in all versions from
     165.  00:4618  22 6A F0            		LD [ChanC+CHNPRM_OrnPtr],HL ;3.xx to 3.6x and VTII
     166.  00:461B                      
     167.  00:461B  22 32 F0            		LD [ChanA+CHNPRM_SamPtr],HL ;S1 There is no default
     168.  00:461E  22 4F F0            		LD [ChanB+CHNPRM_SamPtr],HL ;S2 sample in PT3, so, you
     169.  00:4621  22 6C F0            		LD [ChanC+CHNPRM_SamPtr],HL ;S3 can comment S1,2,3; see
     170.  00:4624                      					    ;also EMPTYSAMORN comment
     171.  00:4624                      
     172.  00:4624                      		; --- NOTE TABLE CREATOR (c) Ivan Roshin, adapted by SapphiRe ---
     173.  00:4624  DD 7E FF            		LD A,[IX+99-100] ;TONE TABLE NUMBER
     174.  00:4627  17                  		RLA
     175.  00:4628  E6 07               		AND 7
     176.  00:462A  21 FA 4A            		LD HL,NT_DATA
     177.  00:462D  D5                  		PUSH DE
     178.  00:462E  50                  		LD D,B		; ld d,0 (bc is 0000 after LDIR)
     179.  00:462F  87                  		ADD A,A
     180.  00:4630  5F                  		LD E,A
     181.  00:4631  19                  		ADD HL,DE	; hl -> init of correct note table data
     182.  00:4632  5E                  		LD E,[HL]
     183.  00:4633  23                  		INC HL
     184.  00:4634  CB 3B               		SRL E
     185.  00:4636  9F                  		SBC A,A
     186.  00:4637  E6 A7               		AND $A7			;$00 (NOP) or $A7 (AND A)
     187.  00:4639  32 21 F0            		LD [PT3_NTL3],A		; CORRECT INSTRUCTION, DEPENDS OF SELECTED TABLE
     188.  00:463C  3E C9               		LD A,$C9		; RET CODE
     189.  00:463E  32 22 F0            		LD [PT3_NTL3+1],A	; RET PLACED
     190.  00:4641  EB                  		EX DE,HL
     191.  00:4642  C1                  		POP BC ;BC=T1_
     192.  00:4643  09                  		ADD HL,BC
     193.  00:4644                      
     194.  00:4644  1A                  		LD A,[DE]                           
     195.  00:4645                      
     196.  00:4645  01 0A 4B            		LD BC,T_
     197.  00:4648  81                  		ADD A,C
     198.  00:4649  4F                  		LD C,A
     199.  00:464A  88                  		ADC A,B
     200.  00:464B                      
     201.  00:464B  91                  		SUB C
     202.  00:464C  47                  		LD B,A
     203.  00:464D  C5                  		PUSH BC
     204.  00:464E  11 80 F0            		LD DE,NT_
     205.  00:4651  D5                  		PUSH DE
     206.  00:4652                      
     207.  00:4652  06 0C               		LD B,12
     208.  00:4654  C5                  .L1:		PUSH BC
     209.  00:4655  4E                  		LD C,[HL]
     210.  00:4656  23                  		INC HL
     211.  00:4657  E5                  		PUSH HL
     212.  00:4658  46                  		LD B,[HL]
     213.  00:4659                      
     214.  00:4659  D5                  		PUSH DE
     215.  00:465A  EB                  		EX DE,HL
     216.  00:465B  11 17 00            		LD DE,23
     217.  00:465E  DD 26 08            		db $DD,$26,$08	;LD XH,8
     218.  00:4661                      
     219.  00:4661  CB 38               .L2:		SRL B
     220.  00:4663  CB 19               		RR C
     221.  00:4665  CD 21 F0            .L3:		CALL PT3_NTL3	;AND A or NOP
     222.  00:4668  79                  		LD A,C
     223.  00:4669  8A                  		ADC A,D	;=ADC 0
     224.  00:466A  77                  		LD [HL],A
     225.  00:466B  23                  		INC HL
     226.  00:466C  78                  		LD A,B
     227.  00:466D  8A                  		ADC A,D
     228.  00:466E  77                  		LD [HL],A
     229.  00:466F  19                  		ADD HL,DE
     230.  00:4670  DD 25               		db $DD,$25	;DEC XH
     231.  00:4672  20 ED               		JR NZ,.L2
     232.  00:4674                      
     233.  00:4674  D1                  		POP DE
     234.  00:4675  13                  		INC DE
     235.  00:4676  13                  		INC DE
     236.  00:4677  E1                  		POP HL
     237.  00:4678  23                  		INC HL
     238.  00:4679  C1                  		POP BC
     239.  00:467A  10 D8               		DJNZ .L1
     240.  00:467C                      
     241.  00:467C  E1                  		POP HL
     242.  00:467D  D1                  		POP DE
     243.  00:467E                      
     244.  00:467E  7B                  		LD A,E
     245.  00:467F  D5                  		PUSH DE
     246.  00:4680  11 16 4B            		LD DE,TCOLD_1
     247.  00:4683  BB                  		CP E
     248.  00:4684  D1                  		POP DE
     249.  00:4685  20 05               		JR NZ,.CORR_1
     250.  00:4687  3E FD               		LD A,$FD
     251.  00:4689  32 AE F0            		LD [NT_+$2E],A
     252.  00:468C                      
     253.  00:468C  1A                  .CORR_1:	LD A,[DE]
     254.  00:468D  A7                  		AND A
     255.  00:468E  28 11               		JR Z,.TC_EXIT
     256.  00:4690  1F                  		RRA
     257.  00:4691  F5                  		PUSH AF
     258.  00:4692  87                  		ADD A,A
     259.  00:4693  4F                  		LD C,A
     260.  00:4694  09                  		ADD HL,BC
     261.  00:4695  F1                  		POP AF
     262.  00:4696  30 02               		JR NC,.CORR_2
     263.  00:4698  35                  		DEC [HL]
     264.  00:4699  35                  		DEC [HL]
     265.  00:469A  34                  .CORR_2:	INC [HL]
     266.  00:469B  A7                  		AND A
     267.  00:469C  ED 42               		SBC HL,BC
     268.  00:469E  13                  		INC DE
     269.  00:469F  18 EB               		JR .CORR_1
     270.  00:46A1                      
     271.  00:46A1                      .TC_EXIT:	;POP AF
     272.  00:46A1                      
     273.  00:46A1                      		; --- CREATE PT3 VOLUME TABLE (c) Ivan Roshin, adapted by SapphiRe ---
     274.  00:46A1  21 11 00            		ld	hl,$11
     275.  00:46A4  54                  		ld	d,h
     276.  00:46A5  5C                  		ld	e,h
     277.  00:46A6  DD 21 50 F1         		ld	IX,VT_+16
     278.  00:46AA  06 0F               		ld	b,15
     279.  00:46AC  E5                  .INITV1:	push	hl
     280.  00:46AD  19                  		add	hl,de
     281.  00:46AE  EB                  		ex	de,hl
     282.  00:46AF  ED 62               		sbc	hl,hl
     283.  00:46B1  48                  		ld	c,b
     284.  00:46B2  06 10               		ld	b,16
     285.  00:46B4  7D                  .INITV2:	ld	a,l
     286.  00:46B5  17                  		rla
     287.  00:46B6  7C                  		ld	a,h
     288.  00:46B7  CE 00               		adc	a,0
     289.  00:46B9  DD 77 00            		ld	[ix],a
     290.  00:46BC  DD 23               		inc	ix
     291.  00:46BE  19                  		add	hl,de
     292.  00:46BF  10 F3               		djnz	.INITV2
     293.  00:46C1  E1                  		pop	hl
     294.  00:46C2  7B                  		ld	a,e
     295.  00:46C3  FE 77               		cp	$77
     296.  00:46C5  20 01               		jr	nz,.INITV3
     297.  00:46C7  1C                  		inc	e
     298.  00:46C8  41                  .INITV3:	ld	b,c
     299.  00:46C9  10 E1               		djnz	.INITV1
     300.  00:46CB                      
     301.  00:46CB  C9                  		RET
     302.  00:46CC                      
     303.  00:46CC                      		;pattern decoder
     304.  00:46CC  DD 36 08 00         PD_OrSm:	LD [IX+(CHNPRM_Env_En-12)],0
     305.  00:46D0  CD 56 48            		CALL SETORN
     306.  00:46D3  0A                  		LD A,[BC]
     307.  00:46D4  03                  		INC BC
     308.  00:46D5  0F                  		RRCA
     309.  00:46D6                      
     310.  00:46D6  87                  PD_SAM:		ADD A,A
     311.  00:46D7  5F                  PD_SAM_:	LD E,A
     312.  00:46D8  16 00               		LD D,0
     313.  00:46DA  2A 05 F0            		LD HL,[PT3_SAMPTRS]
     314.  00:46DD  19                  		ADD HL,DE
     315.  00:46DE  5E                  		LD E,[HL]
     316.  00:46DF  23                  		INC HL
     317.  00:46E0  56                  		LD D,[HL]
     318.  00:46E1  2A 01 F0            		LD HL,[PT3_MODADDR]
     319.  00:46E4  19                  		ADD HL,DE
     320.  00:46E5  DD 75 03            		LD [IX+(CHNPRM_SamPtr-12)],L
     321.  00:46E8  DD 74 04            		LD [IX+(CHNPRM_SamPtr+1-12)],H
     322.  00:46EB  18 41               		JR PD_LOOP
     323.  00:46ED                      
     324.  00:46ED  07                  PD_VOL:		RLCA
     325.  00:46EE  07                  		RLCA
     326.  00:46EF  07                  		RLCA
     327.  00:46F0  07                  		RLCA
     328.  00:46F1  DD 77 10            		LD [IX+(CHNPRM_Volume-12)],A
     329.  00:46F4  18 3B               		JR PD_LP2
     330.  00:46F6                      	
     331.  00:46F6  DD 77 08            PD_EOff:	LD [IX+(CHNPRM_Env_En-12)],A
     332.  00:46F9  DD 77 F4            		LD [IX+(CHNPRM_PsInOr-12)],A
     333.  00:46FC  18 33               		JR PD_LP2
     334.  00:46FE                      
     335.  00:46FE  3D                  PD_SorE:	DEC A
     336.  00:46FF  20 07               		JR NZ,PD_ENV
     337.  00:4701  0A                  		LD A,[BC]
     338.  00:4702  03                  		INC BC
     339.  00:4703  DD 77 05            		LD [IX+(CHNPRM_NNtSkp-12)],A
     340.  00:4706  18 29               		JR PD_LP2
     341.  00:4708                      
     342.  00:4708  CD 3A 48            PD_ENV:		CALL SETENV
     343.  00:470B  18 24               		JR PD_LP2
     344.  00:470D                      
     345.  00:470D  CD 56 48            PD_ORN:		CALL SETORN
     346.  00:4710  18 1C               		JR PD_LOOP
     347.  00:4712                             
     348.  00:4712  DD 77 08            PD_ESAM:	LD [IX+(CHNPRM_Env_En-12)],A
     349.  00:4715  DD 77 F4            		LD [IX+(CHNPRM_PsInOr-12)],A
     350.  00:4718  C4 3A 48            		CALL NZ,SETENV
     351.  00:471B  0A                  		LD A,[BC]
     352.  00:471C  03                  		INC BC
     353.  00:471D  18 B8               		JR PD_SAM_
     354.  00:471F                      
     355.  00:471F  DD 7E 06            PTDECOD:	LD A,[IX+(CHNPRM_Note-12)]
     356.  00:4722  32 0F F0            		LD [PT3_PrNote],A
     357.  00:4725  DD 6E FA            		LD L,[IX+(CHNPRM_CrTnSl-12)]
     358.  00:4728  DD 66 FB            		LD H,[IX+(CHNPRM_CrTnSl+1-12)]
     359.  00:472B  22 10 F0            		LD [PT3_PrSlide],HL
     360.  00:472E                      
     361.  00:472E  11 10 20            PD_LOOP:	LD DE,$2010
     362.  00:4731  0A                  PD_LP2:		LD A,[BC]
     363.  00:4732  03                  		INC BC
     364.  00:4733  83                  		ADD A,E
     365.  00:4734  38 96               		JR C,PD_OrSm
     366.  00:4736  82                  		ADD A,D
     367.  00:4737  28 4A               		JR Z,PD_FIN
     368.  00:4739  38 9B               		JR C,PD_SAM
     369.  00:473B  83                  		ADD A,E
     370.  00:473C  28 25               		JR Z,PD_REL
     371.  00:473E  38 AD               		JR C,PD_VOL
     372.  00:4740  83                  		ADD A,E
     373.  00:4741  28 B3               		JR Z,PD_EOff
     374.  00:4743  38 B9               		JR C,PD_SorE
     375.  00:4745  C6 60               		ADD A,96
     376.  00:4747  38 20               		JR C,PD_NOTE
     377.  00:4749  83                  		ADD A,E
     378.  00:474A  38 C1               		JR C,PD_ORN
     379.  00:474C  82                  		ADD A,D
     380.  00:474D  38 0F               		JR C,PD_NOIS
     381.  00:474F  83                  		ADD A,E
     382.  00:4750  38 C0               		JR C,PD_ESAM
     383.  00:4752  87                  		ADD A,A
     384.  00:4753  5F                  		LD E,A
     385.  00:4754  21 8F 27            		LD HL,(SPCCOMS+$DF20) % 65536	; Adapted from original Speccy version (saves 6 bytes)
     386.  00:4757  19                  		ADD HL,DE
     387.  00:4758  5E                  		LD E,[HL]
     388.  00:4759  23                  		INC HL
     389.  00:475A  56                  		LD D,[HL]
     390.  00:475B  D5                  		PUSH DE
     391.  00:475C  18 D0               		JR PD_LOOP
     392.  00:475E                      
     393.  00:475E  32 7E F0            PD_NOIS:	LD [Ns_Base],A
     394.  00:4761  18 CE               		JR PD_LP2
     395.  00:4763                      
     396.  00:4763  DD CB 09 86         PD_REL:		RES 0,[IX+(CHNPRM_Flags-12)]
     397.  00:4767  18 08               		JR PD_RES
     398.  00:4769                      	
     399.  00:4769  DD 77 06            PD_NOTE:	LD [IX+(CHNPRM_Note-12)],A
     400.  00:476C  DD CB 09 C6         		SET 0,[IX+(CHNPRM_Flags-12)]
     401.  00:4770  AF                  		XOR A
     402.  00:4771                      
     403.  00:4771  ED 73 09 F0         PD_RES:		LD [PT3_PDSP],SP
     404.  00:4775  DD F9               		LD SP,IX
     405.  00:4777  67                  		LD H,A
     406.  00:4778  6F                  		LD L,A
     407.  00:4779  E5                  		PUSH HL
     408.  00:477A  E5                  		PUSH HL
     409.  00:477B  E5                  		PUSH HL
     410.  00:477C  E5                  		PUSH HL
     411.  00:477D  E5                  		PUSH HL
     412.  00:477E  E5                  		PUSH HL
     413.  00:477F  ED 7B 09 F0         		LD SP,[PT3_PDSP]
     414.  00:4783                      
     415.  00:4783  DD 7E 05            PD_FIN:		LD A,[IX+(CHNPRM_NNtSkp-12)]
     416.  00:4786  DD 77 0F            		LD [IX+(CHNPRM_NtSkCn-12)],A
     417.  00:4789  C9                  		RET
     418.  00:478A                      
     419.  00:478A  DD CB 09 96         C_PORTM:	RES 2,[IX+(CHNPRM_Flags-12)]
     420.  00:478E  0A                  		LD A,[BC]
     421.  00:478F  03                  		INC BC
     422.  00:4790                      		;SKIP PRECALCULATED TONE DELTA [BECAUSE
     423.  00:4790                      		;CANNOT BE RIGHT AFTER PT3 COMPILATION]
     424.  00:4790  03                  		INC BC
     425.  00:4791  03                  		INC BC
     426.  00:4792  DD 77 0A            		LD [IX+(CHNPRM_TnSlDl-12)],A
     427.  00:4795  DD 77 F9            		LD [IX+(CHNPRM_TSlCnt-12)],A
     428.  00:4798  11 80 F0            		LD DE,NT_
     429.  00:479B  DD 7E 06            		LD A,[IX+(CHNPRM_Note-12)]
     430.  00:479E  DD 77 07            		LD [IX+(CHNPRM_SlToNt-12)],A
     431.  00:47A1  87                  		ADD A,A
     432.  00:47A2  6F                  		LD L,A
     433.  00:47A3  26 00               		LD H,0
     434.  00:47A5  19                  		ADD HL,DE
     435.  00:47A6  7E                  		LD A,[HL]
     436.  00:47A7  23                  		INC HL
     437.  00:47A8  66                  		LD H,[HL]
     438.  00:47A9  6F                  		LD L,A
     439.  00:47AA  E5                  		PUSH HL
     440.  00:47AB  3A 0F F0            		LD A,[PT3_PrNote]
     441.  00:47AE  DD 77 06            		LD [IX+(CHNPRM_Note-12)],A
     442.  00:47B1  87                  		ADD A,A
     443.  00:47B2  6F                  		LD L,A
     444.  00:47B3  26 00               		LD H,0
     445.  00:47B5  19                  		ADD HL,DE
     446.  00:47B6  5E                  		LD E,[HL]
     447.  00:47B7  23                  		INC HL
     448.  00:47B8  56                  		LD D,[HL]
     449.  00:47B9  E1                  		POP HL
     450.  00:47BA  ED 52               		SBC HL,DE
     451.  00:47BC  DD 75 0D            		LD [IX+(CHNPRM_TnDelt-12)],L
     452.  00:47BF  DD 74 0E            		LD [IX+(CHNPRM_TnDelt+1-12)],H
     453.  00:47C2  ED 5B 10 F0         		LD DE,[PT3_PrSlide]
     454.  00:47C6  DD 73 FA            		LD [IX+(CHNPRM_CrTnSl-12)],E
     455.  00:47C9  DD 72 FB            		LD [IX+(CHNPRM_CrTnSl+1-12)],D
     456.  00:47CC  0A                  		LD A,[BC] ;SIGNED TONE STEP
     457.  00:47CD  03                  		INC BC
     458.  00:47CE  08                  		EX AF,AF'
     459.  00:47CF  0A                  		LD A,[BC]
     460.  00:47D0  03                  		INC BC
     461.  00:47D1  A7                  		AND A
     462.  00:47D2  28 01               		JR Z,.NOSIG
     463.  00:47D4  EB                  		EX DE,HL
     464.  00:47D5  ED 52               .NOSIG:	SBC HL,DE
     465.  00:47D7  F2 DF 47            		JP P,SET_STP
     466.  00:47DA  2F                  		CPL
     467.  00:47DB  08                  		EX AF,AF'
     468.  00:47DC  ED 44               		NEG
     469.  00:47DE  08                  		EX AF,AF'
     470.  00:47DF  DD 77 0C            SET_STP:	LD [IX+(CHNPRM_TSlStp+1-12)],A
     471.  00:47E2  08                  		EX AF,AF'
     472.  00:47E3  DD 77 0B            		LD [IX+(CHNPRM_TSlStp-12)],A
     473.  00:47E6  DD 36 FE 00         		LD [IX+(CHNPRM_COnOff-12)],0
     474.  00:47EA  C9                  		RET
     475.  00:47EB                      
     476.  00:47EB  DD CB 09 D6         C_GLISS:	SET 2,[IX+(CHNPRM_Flags-12)]
     477.  00:47EF  0A                  		LD A,[BC]
     478.  00:47F0  03                  		INC BC
     479.  00:47F1  DD 77 0A            		LD [IX+(CHNPRM_TnSlDl-12)],A
     480.  00:47F4  DD 77 F9            		LD [IX+(CHNPRM_TSlCnt-12)],A
     481.  00:47F7  0A                  		LD A,[BC]
     482.  00:47F8  03                  		INC BC
     483.  00:47F9  08                  		EX AF,AF'
     484.  00:47FA  0A                  		LD A,[BC]
     485.  00:47FB  03                  		INC BC
     486.  00:47FC  18 E1               		JR SET_STP
     487.  00:47FE                      
     488.  00:47FE  0A                  C_SMPOS:	LD A,[BC]
     489.  00:47FF  03                  		INC BC
     490.  00:4800  DD 77 F5            		LD [IX+(CHNPRM_PsInSm-12)],A
     491.  00:4803  C9                  		RET
     492.  00:4804                      
     493.  00:4804  0A                  C_ORPOS:	LD A,[BC]
     494.  00:4805  03                  		INC BC
     495.  00:4806  DD 77 F4            		LD [IX+(CHNPRM_PsInOr-12)],A
     496.  00:4809  C9                  		RET
     497.  00:480A                      
     498.  00:480A  0A                  C_VIBRT:	LD A,[BC]
     499.  00:480B  03                  		INC BC
     500.  00:480C  DD 77 FF            		LD [IX+(CHNPRM_OnOffD-12)],A
     501.  00:480F  DD 77 FE            		LD [IX+(CHNPRM_COnOff-12)],A
     502.  00:4812  0A                  		LD A,[BC]
     503.  00:4813  03                  		INC BC
     504.  00:4814  DD 77 00            		LD [IX+(CHNPRM_OffOnD-12)],A
     505.  00:4817  AF                  		XOR A
     506.  00:4818  DD 77 F9            		LD [IX+(CHNPRM_TSlCnt-12)],A
     507.  00:481B  DD 77 FA            		LD [IX+(CHNPRM_CrTnSl-12)],A
     508.  00:481E  DD 77 FB            		LD [IX+(CHNPRM_CrTnSl+1-12)],A
     509.  00:4821  C9                  		RET
     510.  00:4822                      
     511.  00:4822  0A                  C_ENGLS:	LD A,[BC]
     512.  00:4823  03                  		INC BC
     513.  00:4824  32 1E F0            		LD [PT3_Env_Del],A
     514.  00:4827  32 7D F0            		LD [CurEDel],A
     515.  00:482A  0A                  		LD A,[BC]
     516.  00:482B  03                  		INC BC
     517.  00:482C  6F                  		LD L,A
     518.  00:482D  0A                  		LD A,[BC]
     519.  00:482E  03                  		INC BC
     520.  00:482F  67                  		LD H,A
     521.  00:4830  22 1F F0            		LD [PT3_ESldAdd],HL
     522.  00:4833  C9                  		RET
     523.  00:4834                      
     524.  00:4834  0A                  C_DELAY:	LD A,[BC]
     525.  00:4835  03                  		INC BC
     526.  00:4836  32 1C F0            		LD [PT3_Delay],A
     527.  00:4839  C9                  		RET
     528.  00:483A                      	
     529.  00:483A  DD 73 08            SETENV:		LD [IX+(CHNPRM_Env_En-12)],E
     530.  00:483D  32 4D F1            		LD [AYREGS+AR_EnvTp],A
     531.  00:4840  0A                  		LD A,[BC]
     532.  00:4841  03                  		INC BC
     533.  00:4842  67                  		LD H,A
     534.  00:4843  0A                  		LD A,[BC]
     535.  00:4844  03                  		INC BC
     536.  00:4845  6F                  		LD L,A
     537.  00:4846  22 4E F1            		LD [EnvBase],HL
     538.  00:4849  AF                  		XOR A
     539.  00:484A  DD 77 F4            		LD [IX+(CHNPRM_PsInOr-12)],A
     540.  00:484D  32 7D F0            		LD [CurEDel],A
     541.  00:4850  67                  		LD H,A
     542.  00:4851  6F                  		LD L,A
     543.  00:4852  22 7B F0            		LD [CurESld],HL
     544.  00:4855  C9                  C_NOP:		RET
     545.  00:4856                      
     546.  00:4856  87                  SETORN:		ADD A,A
     547.  00:4857  5F                  		LD E,A
     548.  00:4858  16 00               		LD D,0
     549.  00:485A  DD 72 F4            		LD [IX+(CHNPRM_PsInOr-12)],D
     550.  00:485D  2A 07 F0            		LD HL,[PT3_OrnPtrs]
     551.  00:4860  19                  		ADD HL,DE
     552.  00:4861  5E                  		LD E,[HL]
     553.  00:4862  23                  		INC HL
     554.  00:4863  56                  		LD D,[HL]
     555.  00:4864  2A 01 F0            		LD HL,[PT3_MODADDR]
     556.  00:4867  19                  		ADD HL,DE
     557.  00:4868  DD 75 01            		LD [IX+(CHNPRM_OrnPtr-12)],L
     558.  00:486B  DD 74 02            		LD [IX+(CHNPRM_OrnPtr+1-12)],H
     559.  00:486E  C9                  		RET
     560.  00:486F                      
     561.  00:486F                      		;ALL 16 ADDRESSES TO PROTECT FROM BROKEN PT3 MODULES
     562.  00:486F  55 48               SPCCOMS:	dw C_NOP
     563.  00:4871  EB 47               		dw C_GLISS
     564.  00:4873  8A 47               		dw C_PORTM
     565.  00:4875  FE 47               		dw C_SMPOS
     566.  00:4877  04 48               		dw C_ORPOS
     567.  00:4879  0A 48               		dw C_VIBRT
     568.  00:487B  55 48               		dw C_NOP
     569.  00:487D  55 48               		dw C_NOP
     570.  00:487F  22 48               		dw C_ENGLS
     571.  00:4881  34 48               		dw C_DELAY
     572.  00:4883  55 48               		dw C_NOP
     573.  00:4885  55 48               		dw C_NOP
     574.  00:4887  55 48               		dw C_NOP
     575.  00:4889  55 48               		dw C_NOP
     576.  00:488B  55 48               		dw C_NOP
     577.  00:488D  55 48               		dw C_NOP
     578.  00:488F                      
     579.  00:488F  AF                  CHREGS:		XOR A
     580.  00:4890  32 4A F1            		LD [AYREGS+AR_AmplC],A
     581.  00:4893  DD CB 15 46         		BIT 0,[IX+CHNPRM_Flags]
     582.  00:4897  E5                  		PUSH HL
     583.  00:4898  CA BE 49            		JP Z,.CH_EXIT
     584.  00:489B  ED 73 0B F0         		LD [PT3_CSP],SP
     585.  00:489F  DD 6E 0D            		LD L,[IX+CHNPRM_OrnPtr]
     586.  00:48A2  DD 66 0E            		LD H,[IX+CHNPRM_OrnPtr+1]
     587.  00:48A5  F9                  		LD SP,HL
     588.  00:48A6  D1                  		POP DE
     589.  00:48A7  67                  		LD H,A
     590.  00:48A8  DD 7E 00            		LD A,[IX+CHNPRM_PsInOr]
     591.  00:48AB  6F                  		LD L,A
     592.  00:48AC  39                  		ADD HL,SP
     593.  00:48AD  3C                  		INC A
     594.  00:48AE  BA                  		CP D
     595.  00:48AF  38 01               		JR C,.CH_ORPS
     596.  00:48B1  7B                  		LD A,E
     597.  00:48B2  DD 77 00            .CH_ORPS:	LD [IX+CHNPRM_PsInOr],A
     598.  00:48B5  DD 7E 12            		LD A,[IX+CHNPRM_Note]
     599.  00:48B8  86                  		ADD A,[HL]
     600.  00:48B9  F2 BD 48            		JP P,.CH_NTP
     601.  00:48BC  AF                  		XOR A
     602.  00:48BD  FE 60               .CH_NTP:	CP 96
     603.  00:48BF  38 02               		JR C,.CH_NOK
     604.  00:48C1  3E 5F               		LD A,95
     605.  00:48C3  87                  .CH_NOK:	ADD A,A
     606.  00:48C4  08                  		EX AF,AF'
     607.  00:48C5  DD 6E 0F            		LD L,[IX+CHNPRM_SamPtr]
     608.  00:48C8  DD 66 10            		LD H,[IX+CHNPRM_SamPtr+1]
     609.  00:48CB  F9                  		LD SP,HL
     610.  00:48CC  D1                  		POP DE
     611.  00:48CD  26 00               		LD H,0
     612.  00:48CF  DD 7E 01            		LD A,[IX+CHNPRM_PsInSm]
     613.  00:48D2  47                  		LD B,A
     614.  00:48D3  87                  		ADD A,A
     615.  00:48D4  87                  		ADD A,A
     616.  00:48D5  6F                  		LD L,A
     617.  00:48D6  39                  		ADD HL,SP
     618.  00:48D7  F9                  		LD SP,HL
     619.  00:48D8  78                  		LD A,B
     620.  00:48D9  3C                  		INC A
     621.  00:48DA  BA                  		CP D
     622.  00:48DB  38 01               		JR C,.CH_SMPS
     623.  00:48DD  7B                  		LD A,E
     624.  00:48DE  DD 77 01            .CH_SMPS:	LD [IX+CHNPRM_PsInSm],A
     625.  00:48E1  C1                  		POP BC
     626.  00:48E2  E1                  		POP HL
     627.  00:48E3  DD 5E 08            		LD E,[IX+CHNPRM_TnAcc]
     628.  00:48E6  DD 56 09            		LD D,[IX+CHNPRM_TnAcc+1]
     629.  00:48E9  19                  		ADD HL,DE
     630.  00:48EA  CB 70               		BIT 6,B
     631.  00:48EC  28 06               		JR Z,.CH_NOAC
     632.  00:48EE  DD 75 08            		LD [IX+CHNPRM_TnAcc],L
     633.  00:48F1  DD 74 09            		LD [IX+CHNPRM_TnAcc+1],H
     634.  00:48F4  EB                  .CH_NOAC:	EX DE,HL
     635.  00:48F5  08                  		EX AF,AF'
     636.  00:48F6  6F                  		LD L,A
     637.  00:48F7  26 00               		LD H,0
     638.  00:48F9  31 80 F0            		LD SP,NT_
     639.  00:48FC  39                  		ADD HL,SP
     640.  00:48FD  F9                  		LD SP,HL
     641.  00:48FE  E1                  		POP HL
     642.  00:48FF  19                  		ADD HL,DE
     643.  00:4900  DD 5E 06            		LD E,[IX+CHNPRM_CrTnSl]
     644.  00:4903  DD 56 07            		LD D,[IX+CHNPRM_CrTnSl+1]
     645.  00:4906  19                  		ADD HL,DE
     646.  00:4907  ED 7B 0B F0         		LD SP,[PT3_CSP]
     647.  00:490B  E3                  		EX [SP],HL
     648.  00:490C  AF                  		XOR A
     649.  00:490D  DD B6 05            		OR [IX+CHNPRM_TSlCnt]
     650.  00:4910  28 3E               		JR Z,.CH_AMP
     651.  00:4912  DD 35 05            		DEC [IX+CHNPRM_TSlCnt]
     652.  00:4915  20 39               		JR NZ,.CH_AMP
     653.  00:4917  DD 7E 16            		LD A,[IX+CHNPRM_TnSlDl]
     654.  00:491A  DD 77 05            		LD [IX+CHNPRM_TSlCnt],A
     655.  00:491D  DD 6E 17            		LD L,[IX+CHNPRM_TSlStp]
     656.  00:4920  DD 66 18            		LD H,[IX+CHNPRM_TSlStp+1]
     657.  00:4923  7C                  		LD A,H
     658.  00:4924  19                  		ADD HL,DE
     659.  00:4925  DD 75 06            		LD [IX+CHNPRM_CrTnSl],L
     660.  00:4928  DD 74 07            		LD [IX+CHNPRM_CrTnSl+1],H
     661.  00:492B  DD CB 15 56         		BIT 2,[IX+CHNPRM_Flags]
     662.  00:492F  20 1F               		JR NZ,.CH_AMP
     663.  00:4931  DD 5E 19            		LD E,[IX+CHNPRM_TnDelt]
     664.  00:4934  DD 56 1A            		LD D,[IX+CHNPRM_TnDelt+1]
     665.  00:4937  A7                  		AND A
     666.  00:4938  28 01               		JR Z,.CH_STPP
     667.  00:493A  EB                  		EX DE,HL
     668.  00:493B  ED 52               .CH_STPP:	SBC HL,DE
     669.  00:493D  FA 50 49            		JP M,.CH_AMP
     670.  00:4940  DD 7E 13            		LD A,[IX+CHNPRM_SlToNt]
     671.  00:4943  DD 77 12            		LD [IX+CHNPRM_Note],A
     672.  00:4946  AF                  		XOR A
     673.  00:4947  DD 77 05            		LD [IX+CHNPRM_TSlCnt],A
     674.  00:494A  DD 77 06            		LD [IX+CHNPRM_CrTnSl],A
     675.  00:494D  DD 77 07            		LD [IX+CHNPRM_CrTnSl+1],A
     676.  00:4950  DD 7E 02            .CH_AMP:	LD A,[IX+CHNPRM_CrAmSl]
     677.  00:4953  CB 79               		BIT 7,C
     678.  00:4955  28 13               		JR Z,.CH_NOAM
     679.  00:4957  CB 71               		BIT 6,C
     680.  00:4959  28 07               		JR Z,.CH_AMIN
     681.  00:495B  FE 0F               		CP 15
     682.  00:495D  28 0B               		JR Z,.CH_NOAM
     683.  00:495F  3C                  		INC A
     684.  00:4960  18 05               		JR .CH_SVAM
     685.  00:4962  FE F1               .CH_AMIN:	CP -15
     686.  00:4964  28 04               		JR Z,.CH_NOAM
     687.  00:4966  3D                  		DEC A
     688.  00:4967  DD 77 02            .CH_SVAM:	LD [IX+CHNPRM_CrAmSl],A
     689.  00:496A  6F                  .CH_NOAM:	LD L,A
     690.  00:496B  78                  		LD A,B
     691.  00:496C  E6 0F               		AND 15
     692.  00:496E  85                  		ADD A,L
     693.  00:496F  F2 73 49            		JP P,.CH_APOS
     694.  00:4972  AF                  		XOR A
     695.  00:4973  FE 10               .CH_APOS:	CP 16
     696.  00:4975  38 02               		JR C,.CH_VOL
     697.  00:4977  3E 0F               		LD A,15
     698.  00:4979  DD B6 1C            .CH_VOL:	OR [IX+CHNPRM_Volume]
     699.  00:497C  6F                  		LD L,A
     700.  00:497D  26 00               		LD H,0
     701.  00:497F  11 40 F1            		LD DE,VT_
     702.  00:4982  19                  		ADD HL,DE
     703.  00:4983  7E                  		LD A,[HL]
     704.  00:4984  CB 41               .CH_ENV:	BIT 0,C
     705.  00:4986  20 03               		JR NZ,.CH_NOEN
     706.  00:4988  DD B6 14            		OR [IX+CHNPRM_Env_En]
     707.  00:498B  32 4A F1            .CH_NOEN:	LD [AYREGS+AR_AmplC],A
     708.  00:498E  CB 78               		BIT 7,B
     709.  00:4990  79                  		LD A,C
     710.  00:4991  28 19               		JR Z,.NO_ENSL
     711.  00:4993  17                  		RLA
     712.  00:4994  17                  		RLA
     713.  00:4995  CB 2F               		SRA A
     714.  00:4997  CB 2F               		SRA A
     715.  00:4999  CB 2F               		SRA A
     716.  00:499B  DD 86 04            		ADD A,[IX+CHNPRM_CrEnSl] ;SEE COMMENT BELOW
     717.  00:499E  CB 68               		BIT 5,B
     718.  00:49A0  28 03               		JR Z,.NO_ENAC
     719.  00:49A2  DD 77 04            		LD [IX+CHNPRM_CrEnSl],A
     720.  00:49A5  21 1D F0            .NO_ENAC:	LD HL,PT3_AddToEn
     721.  00:49A8  86                  		ADD A,[HL] ;BUG IN PT3 - NEED WORD HERE.
     722.  00:49A9                      			   ;FIX IT IN NEXT VERSION?
     723.  00:49A9  77                  		LD [HL],A
     724.  00:49AA  18 0E               		JR .CH_MIX
     725.  00:49AC  1F                  .NO_ENSL:	RRA
     726.  00:49AD  DD 86 03            		ADD A,[IX+CHNPRM_CrNsSl]
     727.  00:49B0  32 7F F0            		LD [AddToNs],A
     728.  00:49B3  CB 68               		BIT 5,B
     729.  00:49B5  28 03               		JR Z,.CH_MIX
     730.  00:49B7  DD 77 03            		LD [IX+CHNPRM_CrNsSl],A
     731.  00:49BA  78                  .CH_MIX:	LD A,B
     732.  00:49BB  1F                  		RRA
     733.  00:49BC  E6 48               		AND $48
     734.  00:49BE  21 47 F1            .CH_EXIT:	LD HL,AYREGS+AR_Mixer
     735.  00:49C1  B6                  		OR [HL]
     736.  00:49C2  0F                  		RRCA
     737.  00:49C3  77                  		LD [HL],A
     738.  00:49C4  E1                  		POP HL
     739.  00:49C5  AF                  		XOR A
     740.  00:49C6  DD B6 0A            		OR [IX+CHNPRM_COnOff]
     741.  00:49C9  C8                  		RET Z
     742.  00:49CA  DD 35 0A            		DEC [IX+CHNPRM_COnOff]
     743.  00:49CD  C0                  		RET NZ
     744.  00:49CE  DD AE 15            		XOR [IX+CHNPRM_Flags]
     745.  00:49D1  DD 77 15            		LD [IX+CHNPRM_Flags],A
     746.  00:49D4  1F                  		RRA
     747.  00:49D5  DD 7E 0B            		LD A,[IX+CHNPRM_OnOffD]
     748.  00:49D8  38 03               		JR C,.CH_ONDL
     749.  00:49DA  DD 7E 0C            		LD A,[IX+CHNPRM_OffOnD]
     750.  00:49DD  DD 77 0A            .CH_ONDL:	LD [IX+CHNPRM_COnOff],A
     751.  00:49E0  C9                  		RET
     752.  00:49E1                      
     753.  00:49E1  AF                  PT3_PLAY:	XOR A
     754.  00:49E2  32 1D F0            		LD [PT3_AddToEn],A
     755.  00:49E5  32 47 F1            		LD [AYREGS+AR_Mixer],A
     756.  00:49E8  3D                  		DEC A
     757.  00:49E9  32 4D F1            		LD [AYREGS+AR_EnvTp],A
     758.  00:49EC  21 7A F0            		LD HL,DelyCnt
     759.  00:49EF  35                  		DEC [HL]
     760.  00:49F0  C2 77 4A            		JP NZ,.PL2
     761.  00:49F3  21 3E F0            		LD HL,ChanA+CHNPRM_NtSkCn
     762.  00:49F6  35                  		DEC [HL]
     763.  00:49F7  20 4E               		JR NZ,.PL1B
     764.  00:49F9  ED 4B 12 F0         		LD BC,[PT3_AdInPtA]
     765.  00:49FD  0A                  		LD A,[BC]
     766.  00:49FE  A7                  		AND A
     767.  00:49FF  20 3B               		JR NZ,.PL1A
     768.  00:4A01  57                  		LD D,A
     769.  00:4A02  32 7E F0            		LD [Ns_Base],A
     770.  00:4A05  2A 03 F0            		LD HL,[PT3_CrPsPtr]
     771.  00:4A08  23                  		INC HL
     772.  00:4A09  7E                  		LD A,[HL]
     773.  00:4A0A  3C                  		INC A
     774.  00:4A0B  20 08               		JR NZ,.PLNLP
     775.  00:4A0D  CD 77 45            		CALL CHECKLP
     776.  00:4A10  2A 18 F0            		LD HL,[PT3_LPosPtr]
     777.  00:4A13  7E                  		LD A,[HL]
     778.  00:4A14  3C                  		INC A
     779.  00:4A15  22 03 F0            .PLNLP:	LD [PT3_CrPsPtr],HL
     780.  00:4A18  3D                  		DEC A
     781.  00:4A19  87                  		ADD A,A
     782.  00:4A1A  5F                  		LD E,A
     783.  00:4A1B  CB 12               		RL D
     784.  00:4A1D  2A 1A F0            		LD HL,[PT3_PatsPtr]
     785.  00:4A20  19                  		ADD HL,DE
     786.  00:4A21  ED 5B 01 F0         		LD DE,[PT3_MODADDR]
     787.  00:4A25  ED 73 0D F0         		LD [PT3_PSP],SP
     788.  00:4A29  F9                  		LD SP,HL
     789.  00:4A2A  E1                  		POP HL
     790.  00:4A2B  19                  		ADD HL,DE
     791.  00:4A2C  44                  		LD B,H
     792.  00:4A2D  4D                  		LD C,L
     793.  00:4A2E  E1                  		POP HL
     794.  00:4A2F  19                  		ADD HL,DE
     795.  00:4A30  22 14 F0            		LD [PT3_AdInPtB],HL
     796.  00:4A33  E1                  		POP HL
     797.  00:4A34  19                  		ADD HL,DE
     798.  00:4A35  22 16 F0            		LD [PT3_AdInPtC],HL
     799.  00:4A38  ED 7B 0D F0         		LD SP,[PT3_PSP]
     800.  00:4A3C                      
     801.  00:4A3C  DD 21 2F F0         .PL1A:		LD IX,ChanA+12
     802.  00:4A40  CD 1F 47            		CALL PTDECOD
     803.  00:4A43  ED 43 12 F0         		LD [PT3_AdInPtA],BC
     804.  00:4A47                      
     805.  00:4A47  21 5B F0            .PL1B:		LD HL,ChanB+CHNPRM_NtSkCn
     806.  00:4A4A  35                  		DEC [HL]
     807.  00:4A4B  20 0F               		JR NZ,.PL1C
     808.  00:4A4D  DD 21 4C F0         		LD IX,ChanB+12
     809.  00:4A51  ED 4B 14 F0         		LD BC,[PT3_AdInPtB]
     810.  00:4A55  CD 1F 47            		CALL PTDECOD
     811.  00:4A58  ED 43 14 F0         		LD [PT3_AdInPtB],BC
     812.  00:4A5C                      
     813.  00:4A5C  21 78 F0            .PL1C:		LD HL,ChanC+CHNPRM_NtSkCn
     814.  00:4A5F  35                  		DEC [HL]
     815.  00:4A60  20 0F               		JR NZ,.PL1D
     816.  00:4A62  DD 21 69 F0         		LD IX,ChanC+12
     817.  00:4A66  ED 4B 16 F0         		LD BC,[PT3_AdInPtC]
     818.  00:4A6A  CD 1F 47            		CALL PTDECOD
     819.  00:4A6D  ED 43 16 F0         		LD [PT3_AdInPtC],BC
     820.  00:4A71                      
     821.  00:4A71  3A 1C F0            .PL1D:		LD A,[PT3_Delay]
     822.  00:4A74  32 7A F0            		LD [DelyCnt],A
     823.  00:4A77                      
     824.  00:4A77  DD 21 23 F0         .PL2:		LD IX,ChanA
     825.  00:4A7B  2A 40 F1            		LD HL,[AYREGS+AR_TonA]
     826.  00:4A7E  CD 8F 48            		CALL CHREGS
     827.  00:4A81  22 40 F1            		LD [AYREGS+AR_TonA],HL
     828.  00:4A84  3A 4A F1            		LD A,[AYREGS+AR_AmplC]
     829.  00:4A87  32 48 F1            		LD [AYREGS+AR_AmplA],A
     830.  00:4A8A  DD 21 40 F0         		LD IX,ChanB
     831.  00:4A8E  2A 42 F1            		LD HL,[AYREGS+AR_TonB]
     832.  00:4A91  CD 8F 48            		CALL CHREGS
     833.  00:4A94  22 42 F1            		LD [AYREGS+AR_TonB],HL
     834.  00:4A97  3A 4A F1            		LD A,[AYREGS+AR_AmplC]
     835.  00:4A9A  32 49 F1            		LD [AYREGS+AR_AmplB],A
     836.  00:4A9D  DD 21 5D F0         		LD IX,ChanC
     837.  00:4AA1  2A 44 F1            		LD HL,[AYREGS+AR_TonC]
     838.  00:4AA4  CD 8F 48            		CALL CHREGS
     839.  00:4AA7  22 44 F1            		LD [AYREGS+AR_TonC],HL
     840.  00:4AAA                      
     841.  00:4AAA  2A 7E F0            		LD HL,[Ns_Base_AddToNs]
     842.  00:4AAD  7C                  		LD A,H
     843.  00:4AAE  85                  		ADD A,L
     844.  00:4AAF  32 46 F1            		LD [AYREGS+AR_Noise],A
     845.  00:4AB2                      
     846.  00:4AB2  3A 1D F0            		LD A,[PT3_AddToEn]
     847.  00:4AB5  5F                  		LD E,A
     848.  00:4AB6  87                  		ADD A,A
     849.  00:4AB7  9F                  		SBC A,A
     850.  00:4AB8  57                  		LD D,A
     851.  00:4AB9  2A 4E F1            		LD HL,[EnvBase]
     852.  00:4ABC  19                  		ADD HL,DE
     853.  00:4ABD  ED 5B 7B F0         		LD DE,[CurESld]
     854.  00:4AC1  19                  		ADD HL,DE
     855.  00:4AC2  22 4B F1            		LD [AYREGS+AR_Env],HL
     856.  00:4AC5                      
     857.  00:4AC5  AF                  		XOR A
     858.  00:4AC6  21 7D F0            		LD HL,CurEDel
     859.  00:4AC9  B6                  		OR [HL]
     860.  00:4ACA  C8                  		RET Z
     861.  00:4ACB  35                  		DEC [HL]
     862.  00:4ACC  C0                  		RET NZ
     863.  00:4ACD  3A 1E F0            		LD A,[PT3_Env_Del]
     864.  00:4AD0  77                  		LD [HL],A
     865.  00:4AD1  2A 1F F0            		LD HL,[PT3_ESldAdd]
     866.  00:4AD4  19                  		ADD HL,DE
     867.  00:4AD5  22 7B F0            		LD [CurESld],HL
     868.  00:4AD8  C9                  		RET
     869.  00:4AD9                      
     870.  00:4AD9  AF                  PT3_ROUT:	XOR A
     871.  00:4ADA                      	
     872.  00:4ADA                      ROUT_A0:	; --- FIXES BITS 6 AND 7 OF MIXER ---
     873.  00:4ADA  21 47 F1            		LD	HL,AYREGS+AR_Mixer
     874.  00:4ADD  CB FE               		set	7,[hl]
     875.  00:4ADF  CB B6               		res	6,[hl]
     876.  00:4AE1                      
     877.  00:4AE1  0E A0               		LD C,$A0
     878.  00:4AE3  21 40 F1            		LD HL,AYREGS
     879.  00:4AE6  ED 79               .LOUT:		OUT [C],A
     880.  00:4AE8  0C                  		INC C
     881.  00:4AE9  ED A3               		OUTI 
     882.  00:4AEB  0D                  		DEC C
     883.  00:4AEC  3C                  		INC A
     884.  00:4AED  FE 0D               		CP 13
     885.  00:4AEF  20 F5               		JR NZ,.LOUT
     886.  00:4AF1  ED 79               		OUT [C],A
     887.  00:4AF3  7E                  		LD A,[HL]
     888.  00:4AF4  A7                  		AND A
     889.  00:4AF5  F8                  		RET M
     890.  00:4AF6  0C                  		INC C
     891.  00:4AF7  ED 79               		OUT [C],A
     892.  00:4AF9  C9                  		RET
     893.  00:4AFA                      
     894.  00:4AFA  64                  NT_DATA:	db (T_NEW_0-T1_)*2
     895.  00:4AFB  2A                  		db TCNEW_0-T_
     896.  00:4AFC  65                  		db (T_OLD_0-T1_)*2+1
     897.  00:4AFD  00                  		db TCOLD_0-T_
     898.  00:4AFE  01                  		db (T_NEW_1-T1_)*2+1
     899.  00:4AFF  0C                  		db TCNEW_1-T_
     900.  00:4B00  01                  		db (T_OLD_1-T1_)*2+1
     901.  00:4B01  0C                  		db TCOLD_1-T_
     902.  00:4B02  94                  		db (T_NEW_2-T1_)*2
     903.  00:4B03  35                  		db TCNEW_2-T_
     904.  00:4B04  30                  		db (T_OLD_2-T1_)*2
     905.  00:4B05  0E                  		db TCOLD_2-T_
     906.  00:4B06  60                  		db (T_NEW_3-T1_)*2
     907.  00:4B07  20                  		db TCNEW_3-T_
     908.  00:4B08  60                  		db (T_OLD_3-T1_)*2
     909.  00:4B09  21                  		db TCOLD_3-T_
     910.  00:4B0A                      
     911.  00:4B0A                      T_:
     912.  00:4B0A                      
     913.  00:4B0A                      TCOLD_0:	db $00+1,$04+1,$08+1,$0A+1,$0C+1,$0E+1,$12+1,$14+1
     913.  00:4B0A  01 05 09 0B 0D 0F 13 15 
     914.  00:4B12  19 25 3D 00         		db $18+1,$24+1,$3C+1,0
     915.  00:4B16                      TCNEW_1:	
     916.  00:4B16  5D 00               TCOLD_1:	db $5C+1,0
     917.  00:4B18                      TCOLD_2:	db $30+1,$36+1,$4C+1,$52+1,$5E+1,$70+1,$82,$8C,$9C
     917.  00:4B18  31 37 4D 53 5F 71 82 8C 9C 
     918.  00:4B21                      		db $9E,$A0,$A6,$A8,$AA,$AC,$AE,$AE,0
     918.  00:4B21  9E A0 A6 A8 AA AC AE AE 00 
     919.  00:4B2A  57                  TCNEW_3:	db $56+1
     920.  00:4B2B                      TCOLD_3:	db $1E+1,$22+1,$24+1,$28+1,$2C+1,$2E+1,$32+1,$BE+1,0
     920.  00:4B2B  1F 23 25 29 2D 2F 33 BF 00 
     921.  00:4B34                      TCNEW_0:	db $1C+1,$20+1,$22+1,$26+1,$2A+1,$2C+1,$30+1,$54+1
     921.  00:4B34  1D 21 23 27 2B 2D 31 55 
     922.  00:4B3C  BD BF 00            		db $BC+1,$BE+1,0
     923.  00:4B3F                      TCNEW_2:	db $1A+1,$20+1,$24+1,$28+1,$2A+1,$3A+1,$4C+1,$5E+1
     923.  00:4B3F  1B 21 25 29 2B 3B 4D 5F 
     924.  00:4B47  BB BD BF            		db $BA+1,$BC+1,$BE+1
     925.  00:4B4A                      
     926.  00:4B4A  00 01 00 90         EMPTYSAMORN: 	db 0,1,0,$90 ;delete $90 if you don't need default sample
     927.  00:4B4E                      
     928.  00:4B4E                      T_PACK:		; First 12 values of tone tables (packed)
     929.  00:4B4E  0D                  		db ($06EC*2)/256
     930.  00:4B4F  D8                  		db #d8
     931.  00:4B50  69                  		db $0755-$06EC
     932.  00:4B51  70                  		db $07C5-$0755
     933.  00:4B52  76                  		db $083B-$07C5
     934.  00:4B53  7D                  		db $08B8-$083B
     935.  00:4B54  85                  		db $093D-$08B8
     936.  00:4B55  8D                  		db $09CA-$093D
     937.  00:4B56  95                  		db $0A5F-$09CA
     938.  00:4B57  9D                  		db $0AFC-$0A5F
     939.  00:4B58  A8                  		db $0BA4-$0AFC
     940.  00:4B59  B1                  		db $0C55-$0BA4
     941.  00:4B5A  BB                  		db $0D10-$0C55
     942.  00:4B5B  0C                  		db ($066D*2)/256
     943.  00:4B5C  DA                  		db #da
     944.  00:4B5D  62                  		db $06CF-$066D
     945.  00:4B5E  68                  		db $0737-$06CF
     946.  00:4B5F  6D                  		db $07A4-$0737
     947.  00:4B60  75                  		db $0819-$07A4
     948.  00:4B61  7B                  		db $0894-$0819
     949.  00:4B62  83                  		db $0917-$0894
     950.  00:4B63  8A                  		db $09A1-$0917
     951.  00:4B64  92                  		db $0A33-$09A1
     952.  00:4B65  9C                  		db $0ACF-$0A33
     953.  00:4B66  A4                  		db $0B73-$0ACF
     954.  00:4B67  AF                  		db $0C22-$0B73
     955.  00:4B68  B8                  		db $0CDA-$0C22
     956.  00:4B69  0E                  		db ($0704*2)/256
     957.  00:4B6A  08                  		db #08
     958.  00:4B6B  6A                  		db $076E-$0704
     959.  00:4B6C  72                  		db $07E0-$076E
     960.  00:4B6D  78                  		db $0858-$07E0
     961.  00:4B6E  7E                  		db $08D6-$0858
     962.  00:4B6F  86                  		db $095C-$08D6
     963.  00:4B70  90                  		db $09EC-$095C
     964.  00:4B71  96                  		db $0A82-$09EC
     965.  00:4B72  A0                  		db $0B22-$0A82
     966.  00:4B73  AA                  		db $0BCC-$0B22
     967.  00:4B74  B4                  		db $0C80-$0BCC
     968.  00:4B75  BE                  		db $0D3E-$0C80
     969.  00:4B76  0F                  		db ($07E0*2)/256
     970.  00:4B77  C0                  		db #c0
     971.  00:4B78  78                  		db $0858-$07E0
     972.  00:4B79  88                  		db $08E0-$0858
     973.  00:4B7A  80                  		db $0960-$08E0
     974.  00:4B7B  90                  		db $09F0-$0960
     975.  00:4B7C  98                  		db $0A88-$09F0
     976.  00:4B7D  A0                  		db $0B28-$0A88
     977.  00:4B7E  B0                  		db $0BD8-$0B28
     978.  00:4B7F  A8                  		db $0C80-$0BD8
     979.  00:4B80  E0                  		db $0D60-$0C80
     980.  00:4B81  B0                  		db $0E10-$0D60
     981.  00:4B82  E8                  		db $0EF8-$0E10
     982.  00:4B83                      
     983.  00:4B83                      
     984.  00:4B83                      
     985.  00:4B83                      
     986.  00:4B83                      
     987.  00:4B83                      
     988.  00:4B83                      
     989.  00:4B83                      
     990.  00:4B83                      
     991.  00:4B83                      
     992.  00:4B83                      
     993.  00:4B83                      
     994.  00:4B83                      
     995.  00:4B83                      	;Variables del replayer... las coloco desde aqui.
     996.  00:4B83                      	;mirar que hace la directiva MAP del SJASM
     997.  00:4B83  (F000)              	map		#f000
     998.  00:4B83                      
     999.  00:4B83                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;PT3 REPLAYER
    1000.  00:4B83  (00:F000)           PT3_SETUP:		#1	;set bit0 to 1, if you want to play without looping
    1001.  00:4B83                      					;bit7 is set each time, when loop point is passed
    1002.  00:4B83  (00:F001)           PT3_MODADDR:	#2
    1003.  00:4B83  (00:F003)           PT3_CrPsPtr:		#2
    1004.  00:4B83  (00:F005)           PT3_SAMPTRS:		#2
    1005.  00:4B83  (00:F007)           PT3_OrnPtrs:		#2
    1006.  00:4B83  (00:F009)           PT3_PDSP:		#2
    1007.  00:4B83  (00:F00B)           PT3_CSP:		#2 
    1008.  00:4B83  (00:F00D)           PT3_PSP:		#2
    1009.  00:4B83  (00:F00F)           PT3_PrNote:		#1
    1010.  00:4B83  (00:F010)           PT3_PrSlide:		#2
    1011.  00:4B83  (00:F012)           PT3_AdInPtA:		#2
    1012.  00:4B83  (00:F014)           PT3_AdInPtB:		#2
    1013.  00:4B83  (00:F016)           PT3_AdInPtC:		#2
    1014.  00:4B83  (00:F018)           PT3_LPosPtr:		#2
    1015.  00:4B83  (00:F01A)           PT3_PatsPtr:		#2
    1016.  00:4B83  (00:F01C)           PT3_Delay:		#1
    1017.  00:4B83  (00:F01D)           PT3_AddToEn:		#1
    1018.  00:4B83  (00:F01E)           PT3_Env_Del:		#1
    1019.  00:4B83  (00:F01F)           PT3_ESldAdd:		#2
    1020.  00:4B83  (00:F021)           PT3_NTL3:		#2	; AND A / NOP (note table creator)
    1021.  00:4B83                      
    1022.  00:4B83  (00:F023)           VARS:			#0
    1023.  00:4B83                      
    1024.  00:4B83  (00:F023)           ChanA:			#29			;CHNPRM_Size
    1025.  00:4B83  (00:F040)           ChanB:			#29			;CHNPRM_Size
    1026.  00:4B83  (00:F05D)           ChanC:			#29			;CHNPRM_Size
    1027.  00:4B83                      
    1028.  00:4B83                      ;GlobalVars
    1029.  00:4B83  (00:F07A)           DelyCnt:		#1
    1030.  00:4B83  (00:F07B)           CurESld:		#2
    1031.  00:4B83  (00:F07D)           CurEDel:		#1
    1032.  00:4B83  (00:F07E)           Ns_Base_AddToNs:	#0
    1033.  00:4B83  (00:F07E)           Ns_Base:		#1
    1034.  00:4B83  (00:F07F)           AddToNs:		#1
    1035.  00:4B83                      
    1036.  00:4B83  (00:F080)           NT_:			#192	; Puntero a/tabla de frecuencias
    1037.  00:4B83                      
    1038.  00:4B83  (00:F140)           AYREGS:			#0
    1039.  00:4B83  (00:F140)           VT_:			#14
    1040.  00:4B83  (00:F14E)           EnvBase:		#2
    1041.  00:4B83  (00:F150)           VAR0END:		#0
    1042.  00:4B83                      
    1043.  00:4B83  (00:F150)           T1_:			#0		
    1044.  00:4B83  (00:F150)           T_NEW_1:		#0
    1045.  00:4B83  (00:F150)           T_OLD_1:		#24
    1046.  00:4B83  (00:F168)           T_OLD_2:		#24
    1047.  00:4B83  (00:F180)           T_NEW_3:		#0
    1048.  00:4B83  (00:F180)           T_OLD_3:		#2
    1049.  00:4B83  (00:F182)           T_OLD_0:		#0
    1050.  00:4B83  (00:F182)           T_NEW_0:		#24
    1051.  00:4B83  (00:F19A)           T_NEW_2:		#166
    1052.  00:4B83                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;PT3 REPLAYER END
      30   00:4B83                      START
      31   00:4B83                      	; CODE
      32   00:4B83                      
      33   00:4B83                      	;LD A,8
      34   00:4B83                      	;CALL CHGMOD    	
      35   00:4B83  CD 74 41                CALL SETPAGES32K
      36   00:4B86                      ;	CALL opening_screen
      37   00:4B86  3E 01               	LD A,1
      38   00:4B88  32 00 70            	LD (_bank2),A
      39   00:4B8B                      ;	CALL CHGET
      40   00:4B8B                      	; Empieza el juego    
      41   00:4B8B  CD E1 40            	call ClearVram_MSX2		
      42   00:4B8E  CD 87 41            	call SET_SCREEN5_MODE    
      43   00:4B91  CD D5 40                call Set212Lines
      44   00:4B94                              
      45   00:4B94  CD A6 4B                call INIT_CHARS_VARS
      46   00:4B97  3E FF                   LD A, -MOV_SPEED_GHOST
      47   00:4B99  32 0C C0            	LD (CHAR_SPEED_X_GHOST), A
      48   00:4B9C  21 42 70                LD HL, PaletteData
      49   00:4B9F  CD 06 42                CALL SetPalette
      50   00:4BA2  CD 2C 4C                CALL STAGE1
      51   00:4BA5                          ;call MAIN_LOOP
      52   00:4BA5                          ;CALL CHGET
      53   00:4BA5  C9                  	ret
      54   00:4BA6                      
      55   00:4BA6                      
      56   00:4BA6                      INIT_CHARS_VARS:    
      57   00:4BA6  DD 21 19 C0             ld ix, SPRITE_ATTRS           
      58   00:4BAA                          
      59   00:4BAA  DD 36 00 69             ld (ix), 69h        ; Sprite 1 - $AF abajo - Y
      60   00:4BAE  DD 36 01 7F             ld (ix+1), 7Fh      ; X        
      61   00:4BB2  DD 36 02 00             ld (ix+2), 00h      ; Pattern
      62   00:4BB6                      
      63   00:4BB6  DD 36 04 69             ld (ix+4), 69h     ; Sprite 2
      64   00:4BBA  DD 36 05 7F             ld (ix+5), 7Fh
      65   00:4BBE  DD 36 06 04             ld (ix+6), 04h        
      66   00:4BC2                      
      67   00:4BC2  DD 36 08 69             ld (ix+8), 69h     ; Sprite 3
      68   00:4BC6  DD 36 09 7F             ld (ix+9), 7Fh
      69   00:4BCA  DD 36 0A 08             ld (ix+10), 08h        
      70   00:4BCE                      
      71   00:4BCE  DD 36 10 0F             ld (ix+SPR_GHOST_STG1), $0f      ; Sprite 1 - Ghost - mask0
      72   00:4BD2  DD 36 11 B9             ld (ix+SPR_GHOST_STG1+1), $B9
      73   00:4BD6  DD 36 12 1C             ld (ix+SPR_GHOST_STG1+2), SPR_GHOST_STG1_PTRN_L1
      74   00:4BDA                          
      75   00:4BDA  DD 36 14 0F             ld (ix+SPR_GHOST_STG1+4), $0f      ; Sprite 1 - Ghost - mask0
      76   00:4BDE  DD 36 15 B9             ld (ix+SPR_GHOST_STG1+5), $B9
      77   00:4BE2  DD 36 16 20             ld (ix+SPR_GHOST_STG1+6), SPR_GHOST_STG1_PTRN_L1+4
      78   00:4BE6                          
      79   00:4BE6  AF                      XOR A
      80   00:4BE7  32 09 C0                LD (JIFFY_TEMP),A
      81   00:4BEA  32 0A C0                LD (CHAR_SPEED_X),A
      82   00:4BED  32 0B C0                LD (CHAR_SPEED_Y),A
      83   00:4BF0  32 0C C0                LD (CHAR_SPEED_X_GHOST),A
      84   00:4BF3  32 11 C0                LD (CHAR_DIR_GHOST1),A      ; $00 - LEFT, $FF - RIGHT
      85   00:4BF6  32 14 C0                LD (CHAR_NEW_DIR_MAIN),A    
      86   00:4BF9  32 15 C0                LD (CHAR_MAIN_SHOOT),A      ; Indica si el personaje está disparando - $FF
      87   00:4BFC  32 17 C0                LD (CHAR_DISTANCE_SHOOT),A
      88   00:4BFF  32 18 C0                LD (CHAR_SPEED_SHOOT),A
      89   00:4C02  32 0E C0                LD (CHAR_GHOST_DEAD),A
      90   00:4C05  32 16 C0                LD (CHAR_MIN_STEP), A
      91   00:4C08  32 A0 C0                LD (SPRITE_COLOR_REPLACE2), A
      92   00:4C0B  32 02 C0                LD (SHOWING_GUS_DIALOG), A
      93   00:4C0E  32 01 C0                LD (SHOWING_JOHN_DIALOG), A
      94   00:4C11  32 00 C0                LD (SHOWING_MIKE_DIALOG), A
      95   00:4C14                      
      96   00:4C14                         ; LD A,$FF
      97   00:4C14  32 08 C0                LD (OLD_KEY_PRESSED), A
      98   00:4C17  3E 01                   LD A,$01
      99   00:4C19  32 13 C0                LD (CHAR_DIR_MAIN),A        ; $00 - UP, $01 - DOWN, $02 - LEFT, $03 - RIGHT
     100   00:4C1C                      
     101   00:4C1C  21 EE 5E                ld hl, SPRITE_P1_DOWN
     102   00:4C1F  22 9C C0                ld (SPRITE_PTR_REPLACE), HL    
     103   00:4C22  21 EE 64                ld hl, SPRITE_COLOR_P1_DOWN
     104   00:4C25  22 9E C0                ld (SPRITE_COLOR_REPLACE), HL
     105   00:4C28  22 A0 C0                LD (SPRITE_COLOR_REPLACE2), HL
     106   00:4C2B                      
     107   00:4C2B                          
     108   00:4C2B  C9                      ret
     109   00:4C2C                      
     110   00:4C2C                      STAGE1:
     111   00:4C2C  CD 41 00                CALL DISSCR
     112   00:4C2F  21 00 80                LD HL, CEMENTER1
     113   00:4C32  22 A4 C0                LD (BITMAP), HL
     114   00:4C35  06 07                   LD B, :CEMENTER1
     115   00:4C37  CD 1F 41                call load_screen
     116   00:4C3A                          
     117   00:4C3A  CD A9 41                call DUMP_SPR_ALL
     118   00:4C3D  CD E9 41                CALL DUMP_SPR_P1
     119   00:4C40  21 AE 65                LD HL, mapa1
     120   00:4C43  22 A2 C0                LD (MAPA), HL
     121   00:4C46                          
     122   00:4C46  CD 44 00                CALL ENASCR
     123   00:4C49                          ;CALL CHGET
     124   00:4C49                          ;CALL CLEAR_DIALOG_BOX
     125   00:4C49                          
     126   00:4C49                      
     127   00:4C49                      MAIN_LOOP:
     128   00:4C49                          ;halt ; sincroniza el teclado y pantalla con el procesador (que va muy rápido)    
     129   00:4C49                      
     130   00:4C49  DD 7E 00                LD A, (ix)  ; Cargamos la Y
     131   00:4C4C  FE 00                   CP $00
     132   00:4C4E  CA 08 4E                JP Z, STAGE2
     133   00:4C51  CD CE 41                call DUMP_SPR_ATTS    
     134   00:4C54                      
     135   00:4C54                      .check_tombs:
     136   00:4C54  DD 7E 01                LD A, (ix +1)   ; Cargamos la X para mirar si hay colisión con la tumba
     137   00:4C57  FE C8                   CP MIKE_TOMB_STG1_X
     138   00:4C59  20 15                   JR NZ, .check_john_tomb
     139   00:4C5B  3A 00 C0                LD A, (SHOWING_MIKE_DIALOG)
     140   00:4C5E  FE 01                   CP 1
     141   00:4C60  28 6E                   JR Z, .animate_ghost
     142   00:4C62  FD 21 10 40             LD IY, mike_tomb_strings
     143   00:4C66  CD AD 44                CALL print_strings_dialog_box
     144   00:4C69  3E 01                   LD A,1
     145   00:4C6B  32 00 C0                LD (SHOWING_MIKE_DIALOG), A
     146   00:4C6E  18 60                   JR .animate_ghost
     147   00:4C70                      
     148   00:4C70                      .check_john_tomb:
     149   00:4C70  FE 29                   CP JOHN_TOMB_STG1_X
     150   00:4C72  20 15                   jr nz, .check_gus_tomb
     151   00:4C74  3A 01 C0                LD A, (SHOWING_JOHN_DIALOG)
     152   00:4C77  FE 01                   CP 1
     153   00:4C79  28 55                   JR Z, .animate_ghost
     154   00:4C7B  FD 21 39 40             LD IY, john_tomb_strings
     155   00:4C7F  CD AD 44                CALL print_strings_dialog_box
     156   00:4C82  3E 01                   LD A,1
     157   00:4C84  32 01 C0                LD (SHOWING_JOHN_DIALOG), A
     158   00:4C87  18 47                   JR .animate_ghost
     159   00:4C89                      
     160   00:4C89                      .check_gus_tomb:
     161   00:4C89  FE 49                   CP GUS_TOMB_STG1_X
     162   00:4C8B  20 15                   jr nz, .check_dialog_box
     163   00:4C8D  3A 02 C0                LD A, (SHOWING_GUS_DIALOG)
     164   00:4C90  FE 01                   CP 1
     165   00:4C92  28 3C                   JR Z, .animate_ghost
     166   00:4C94  FD 21 62 40             LD IY, gus_tomb_strings
     167   00:4C98  CD AD 44                CALL print_strings_dialog_box
     168   00:4C9B  3E 01                   LD A,1
     169   00:4C9D  32 02 C0                LD (SHOWING_GUS_DIALOG), A
     170   00:4CA0  18 2E                   JR .animate_ghost
     171   00:4CA2                      
     172   00:4CA2                      .check_dialog_box
     173   00:4CA2  3A 00 C0                LD A, (SHOWING_MIKE_DIALOG)
     174   00:4CA5  FE 01                   CP 1
     175   00:4CA7  20 09                   JR nz, .check_gus_dialog
     176   00:4CA9  CD 45 45                CALL CLEAR_DIALOG_BOX
     177   00:4CAC  AF                      XOR A
     178   00:4CAD  32 00 C0                LD (SHOWING_MIKE_DIALOG), A
     179   00:4CB0  18 1E                   JR .animate_ghost
     180   00:4CB2                      
     181   00:4CB2                      .check_gus_dialog
     182   00:4CB2  3A 02 C0                LD A, (SHOWING_GUS_DIALOG)
     183   00:4CB5  FE 01                   CP 1
     184   00:4CB7  20 09                   JR nz, .check_john_dialog
     185   00:4CB9  CD 45 45                CALL CLEAR_DIALOG_BOX
     186   00:4CBC  AF                      XOR A
     187   00:4CBD  32 02 C0                LD (SHOWING_GUS_DIALOG), A
     188   00:4CC0  18 0E                   JR .animate_ghost
     189   00:4CC2                      
     190   00:4CC2                      .check_john_dialog
     191   00:4CC2  3A 01 C0                LD A, (SHOWING_JOHN_DIALOG)
     192   00:4CC5  FE 01                   CP 1
     193   00:4CC7  20 07                   JR nz, .animate_ghost
     194   00:4CC9  CD 45 45                CALL CLEAR_DIALOG_BOX
     195   00:4CCC  AF                      XOR A
     196   00:4CCD  32 01 C0                LD (SHOWING_JOHN_DIALOG), A
     197   00:4CD0                      
     198   00:4CD0                      .animate_ghost    
     199   00:4CD0  3A 0E C0                LD A,(CHAR_GHOST_DEAD)
     200   00:4CD3  FE 01                   CP $01
     201   00:4CD5  CA 49 4D                JP Z,.continue
     202   00:4CD8  DD 7E 11                LD A, (ix+SPR_GHOST_STG1+1)          ;cargamos la X del Fantasma
     203   00:4CDB  2A 0C C0            	LD HL, (CHAR_SPEED_X_GHOST)
     204   00:4CDE  85                  	ADD L					; Actualizamos la posicion en base a la velocidad
     205   00:4CDF                          
     206   00:4CDF  DD 77 11            	LD (ix+SPR_GHOST_STG1+1), A
     207   00:4CE2  DD 77 15                LD (ix+SPR_GHOST_STG1+5), A
     208   00:4CE5  FE 16                   CP $16
     209   00:4CE7  CA F2 4C                JP Z,.CHANGE_DIR_RIGHT
     210   00:4CEA  FE B9                   CP $B9
     211   00:4CEC  CA FF 4C                JP Z,.CHANGE_DIR_LEFT
     212   00:4CEF                          		
     213   00:4CEF  C3 08 4D                JP .check_pattern
     214   00:4CF2                      
     215   00:4CF2                      .CHANGE_DIR_RIGHT:
     216   00:4CF2  3E 01                   LD A, MOV_SPEED_GHOST
     217   00:4CF4  32 0C C0            	LD (CHAR_SPEED_X_GHOST), A
     218   00:4CF7  3E FF                   LD A,$FF
     219   00:4CF9  32 11 C0                LD (CHAR_DIR_GHOST1),A
     220   00:4CFC  C3 08 4D                JP .check_pattern
     221   00:4CFF                      
     222   00:4CFF                      .CHANGE_DIR_LEFT:
     223   00:4CFF  3E FF                   LD A, -MOV_SPEED_GHOST
     224   00:4D01  32 0C C0            	LD (CHAR_SPEED_X_GHOST), A
     225   00:4D04  AF                      XOR A   ; Pone A a 0
     226   00:4D05  32 11 C0                LD (CHAR_DIR_GHOST1),A
     227   00:4D08                      
     228   00:4D08                      .check_pattern:
     229   00:4D08  3A 11 C0                LD A,(CHAR_DIR_GHOST1)
     230   00:4D0B  FE FF                   CP $FF
     231   00:4D0D  CA 2E 4D                JP Z,.check_pattern_RIGHT
     232   00:4D10  DD 7E 12                LD A, (ix+SPR_GHOST_STG1+2)       ; Cargamos el patrón y lo cambiamos
     233   00:4D13  FE 1C                   CP SPR_GHOST_STG1_PTRN_L1
     234   00:4D15  CA 23 4D                jp z,.change_pattern_L
     235   00:4D18  DD 36 12 1C             LD (ix+SPR_GHOST_STG1+2),SPR_GHOST_STG1_PTRN_L1
     236   00:4D1C  DD 36 16 20             LD (ix+SPR_GHOST_STG1+6),SPR_GHOST_STG1_PTRN_L1+4
     237   00:4D20  C3 49 4D                jp .continue
     238   00:4D23                      .change_pattern_L:
     239   00:4D23  DD 36 12 24             LD (ix+SPR_GHOST_STG1+2),SPR_GHOST_STG1_PTRN_L2
     240   00:4D27  DD 36 16 28             LD (ix+SPR_GHOST_STG1+6),SPR_GHOST_STG1_PTRN_L2+4
     241   00:4D2B  C3 49 4D                jp .continue
     242   00:4D2E                      
     243   00:4D2E                      .check_pattern_RIGHT
     244   00:4D2E  DD 7E 12                LD A, (ix+SPR_GHOST_STG1+2)       ; Cargamos el patrón y lo cambiamos
     245   00:4D31  FE 2C                   CP SPR_GHOST_STG1_PTRN_R1
     246   00:4D33  CA 41 4D                jp z,.change_pattern_R
     247   00:4D36  DD 36 12 2C             LD (ix+SPR_GHOST_STG1+2),SPR_GHOST_STG1_PTRN_R1
     248   00:4D3A  DD 36 16 30             LD (ix+SPR_GHOST_STG1+6),SPR_GHOST_STG1_PTRN_R1+4
     249   00:4D3E  C3 49 4D                jp .continue
     250   00:4D41                      .change_pattern_R:
     251   00:4D41  DD 36 12 34             LD (ix+SPR_GHOST_STG1+2),SPR_GHOST_STG1_PTRN_R2
     252   00:4D45  DD 36 16 38             LD (ix+SPR_GHOST_STG1+6),SPR_GHOST_STG1_PTRN_R2+4
     253   00:4D49                      
     254   00:4D49                      .continue:    
     255   00:4D49  CD 42 44                CALL MOVE_SHOOT
     256   00:4D4C                      .CHECK_GHOST:
     257   00:4D4C                          ; Comprobamos si hay colision con el fantasma
     258   00:4D4C  3A 0E C0                LD A,(CHAR_GHOST_DEAD)  ; si está muerto,no lo miramos
     259   00:4D4F  FE 01                   CP $01
     260   00:4D51  CA 75 4D                JP Z,.check_KB
     261   00:4D54                      
     262   00:4D54  DD 46 0C                LD B,(ix+SPR_SHOOT_P1)         ; Y del disparo
     263   00:4D57  DD 4E 0D                LD C,(ix+SPR_SHOOT_P1+1)         ; X del disparo
     264   00:4D5A  DD 56 10                LD D,(ix+SPR_GHOST_STG1)         ; Y del fantasma 
     265   00:4D5D  DD 5E 11                LD E,(ix+SPR_GHOST_STG1+1)         ; X del fantasma
     266   00:4D60  CD 88 40                call check_spr_collision
     267   00:4D63  FE 01                   CP 1
     268   00:4D65  C2 75 4D                JP NZ,.check_KB
     269   00:4D68                      
     270   00:4D68                      .KILL_GHOST:
     271   00:4D68  3E 01                   LD A,1
     272   00:4D6A  32 0E C0                LD (CHAR_GHOST_DEAD),A
     273   00:4D6D  DD 36 10 D9             LD (ix+SPR_GHOST_STG1),217    
     274   00:4D71  DD 36 14 D9             LD (ix+SPR_GHOST_STG1+4),217    
     275   00:4D75                      
     276   00:4D75                      .check_KB:
     277   00:4D75  76                      halt    
     278   00:4D76                      	
     279   00:4D76  3E 08                   ld a, 8
     280   00:4D78  CD 41 01            	call SNSMAT   
     281   00:4D7B                          
     282   00:4D7B  4F                      LD C,A    
     283   00:4D7C                          
     284   00:4D7C  CB 79                   BIT KB_RIGHT, C			; La tecla presionada es RIGHT?
     285   00:4D7E  CC 8A 42                call z, move_right
     286   00:4D81                          
     287   00:4D81  CB 61                   BIT KB_LEFT, C			; La tecla presionada es LEFT?
     288   00:4D83  CC E9 42                call z, move_left
     289   00:4D86                      
     290   00:4D86  CB 69                   BIT KB_UP, C			; La tecla presionada es UP?
     291   00:4D88  CC 15 42                call z, move_up
     292   00:4D8B                      
     293   00:4D8B  CB 71                   BIT KB_DOWN, C			; La tecla presionada es DOWN?
     294   00:4D8D  CC 4F 42                call z, move_down
     295   00:4D90                      
     296   00:4D90                      no_arrows:
     297   00:4D90  CB 41                   BIT KB_SPACE, C			; La tecla presionada es SPACE
     298   00:4D92  CC 98 4D                call z,SHOOT_MAIN_CHAR
     299   00:4D95                      
     300   00:4D95                          ;BIT KB_DEL, C			; La tecla presionada es DEL    
     301   00:4D95                          ;ret z
     302   00:4D95                      
     303   00:4D95  C3 49 4C                jp MAIN_LOOP
     304   00:4D98                      
     305   00:4D98                      SHOOT_MAIN_CHAR:    
     306   00:4D98  3A 15 C0                LD A, (CHAR_MAIN_SHOOT)
     307   00:4D9B  FE 01                   CP $01                  ; Si ya está disparando esperamos a que termine
     308   00:4D9D  C8                      RET Z;,MAIN_LOOP
     309   00:4D9E  FE 02                   CP $02                  ; Si ya está disparando esperamos a que termine
     310   00:4DA0  C8                      RET Z;,MAIN_LOOP
     311   00:4DA1  FE 03                   CP $03                  ; Si ya está disparando esperamos a que termine
     312   00:4DA3  C8                      RET Z;,MAIN_LOOP
     313   00:4DA4  FE 04                   CP $04                  ; Si ya está disparando esperamos a que termine
     314   00:4DA6  C8                      RET Z;,MAIN_LOOP
     315   00:4DA7                      
     316   00:4DA7  DD 36 0E 18             ld (ix+SPR_SHOOT_P1+2), SPR_SHOOT_P1_PTRN     ; Sprite Disparo
     317   00:4DAB                      
     318   00:4DAB  DD 7E 00                LD A, (ix)          
     319   00:4DAE  DD 77 0C                ld (ix+SPR_SHOOT_P1), A       ; Asignamos la Y del personaje    
     320   00:4DB1                      
     321   00:4DB1  3A 13 C0                LD A, (CHAR_DIR_MAIN)
     322   00:4DB4  FE 03                   CP $03
     323   00:4DB6  CA D2 4D                JP Z,.SHOOT_RIGHT
     324   00:4DB9  FE 00                   CP $00
     325   00:4DBB  CA E1 4D                JP Z,.SHOOT_UP
     326   00:4DBE  FE 01                   CP $01
     327   00:4DC0  CA F4 4D                JP Z,.SHOOT_DOWN
     328   00:4DC3                          ; SHOOT LEFT
     329   00:4DC3  3E 01                   LD A,$01                ; SHOOT LEFT
     330   00:4DC5  32 15 C0                LD (CHAR_MAIN_SHOOT),A   ; Activo el estado disparando izquierda
     331   00:4DC8  DD 7E 01                LD A, (ix+1)			;cargamos la X - Si no es derecha, debe ser izquierda
     332   00:4DCB  21 F4 FF            	LD HL, -12
     333   00:4DCE  85                  	ADD L
     334   00:4DCF                          
     335   00:4DCF  C3 04 4E                JP .CONTINUE
     336   00:4DD2                      
     337   00:4DD2                      .SHOOT_RIGHT:    
     338   00:4DD2  3E 02                   LD A,$02
     339   00:4DD4  32 15 C0                LD (CHAR_MAIN_SHOOT),A   ; Activo el estado disparando derecha
     340   00:4DD7                          
     341   00:4DD7  DD 7E 01                LD A, (ix+1)			;cargamos la X
     342   00:4DDA  21 0C 00            	LD HL, 12
     343   00:4DDD  85                  	ADD L
     344   00:4DDE  C3 04 4E                JP .CONTINUE
     345   00:4DE1                      
     346   00:4DE1                      .SHOOT_UP:
     347   00:4DE1  3E 03                   LD A,$03
     348   00:4DE3  32 15 C0                LD (CHAR_MAIN_SHOOT),A   ; Activo el estado disparando arriba
     349   00:4DE6                          
     350   00:4DE6                          ; Sumamos el desplazamiento a la Y
     351   00:4DE6  DD 7E 0C                LD A, (ix+SPR_SHOOT_P1)
     352   00:4DE9  D6 10                   SUB 16
     353   00:4DEB  DD 77 0C                LD (ix+SPR_SHOOT_P1), A    
     354   00:4DEE                          ;LD (ix+17), D
     355   00:4DEE  DD 7E 01                LD A, (ix+1)			;cargamos la X    
     356   00:4DF1  C3 04 4E                JP .CONTINUE
     357   00:4DF4                      
     358   00:4DF4                      .SHOOT_DOWN
     359   00:4DF4  3E 04               	LD A,$04
     360   00:4DF6  32 15 C0                LD (CHAR_MAIN_SHOOT),A   ; Activo el estado disparando abajo
     361   00:4DF9                          
     362   00:4DF9                          ; Sumamos el desplazamiento a la Y
     363   00:4DF9  DD 7E 0C                LD A, (ix+SPR_SHOOT_P1)
     364   00:4DFC  C6 10                   ADD 16
     365   00:4DFE  DD 77 0C                LD (ix+SPR_SHOOT_P1), A    
     366   00:4E01                          ;LD (ix+17), D
     367   00:4E01  DD 7E 01                LD A, (ix+1)			;cargamos la X    
     368   00:4E04                      
     369   00:4E04                      .CONTINUE:
     370   00:4E04                          ;ld (ix+16), B       ; Asignamos la Y del personaje
     371   00:4E04  DD 77 0D                ld (ix+SPR_SHOOT_P1+1), A       ; Asignamos la X del personaje + el desplazamiento        
     372   00:4E07                          ;jp MAIN_LOOP
     373   00:4E07  C9                      ret
     374   00:4E08                      
     375   00:4E08                      STAGE2:
     376   00:4E08  CD 41 00                CALL DISSCR
     377   00:4E0B  21 00 80                LD HL, CEMENTER2
     378   00:4E0E  22 A4 C0                LD (BITMAP), HL
     379   00:4E11  06 0D                   LD B, :CEMENTER2
     380   00:4E13                      
     381   00:4E13  CD 1F 41                call load_screen
     382   00:4E16  21 EE 68                LD HL, mapa2
     383   00:4E19  22 A2 C0                LD (MAPA), HL
     384   00:4E1C                          
     385   00:4E1C                          ; Ponemos el P1 por encima del marco
     386   00:4E1C  DD 36 00 A1             LD (ix), 161      ; mask 0
     387   00:4E20  DD 36 04 A1             LD (ix+4), 161    ; mask 1
     388   00:4E24  DD 36 08 A1             LD (ix+8), 161    ; mask 2
     389   00:4E28                          
     390   00:4E28  DD 36 10 D9             LD (ix+SPR_GHOST_STG1),217  ; ocultamos el fantasma
     391   00:4E2C  DD 36 14 D9             LD (ix+SPR_GHOST_STG1+4),217  ; ocultamos el fantasma
     392   00:4E30                          
     393   00:4E30  CD A9 41                CALL DUMP_SPR_ALL
     394   00:4E33  CD E9 41                CALL DUMP_SPR_P1
     395   00:4E36                          
     396   00:4E36                          ; Esqueleto
     397   00:4E36  DD 36 18 10             LD (ix+SPR_GHOST_STG2), 10h
     398   00:4E3A  DD 36 19 10             LD (ix+SPR_GHOST_STG2+1), 10h
     399   00:4E3E  DD 36 1A 3C             LD (ix+SPR_GHOST_STG2+2), SPR_GHOST_STG2_PTRN_L1
     400   00:4E42                      
     401   00:4E42  DD 36 1C 10             LD (ix+SPR_GHOST_STG2+4), 10h
     402   00:4E46  DD 36 1D 10             LD (ix+SPR_GHOST_STG2+5), 10h
     403   00:4E4A  DD 36 1E 40             LD (ix+SPR_GHOST_STG2+6), SPR_GHOST_STG2_PTRN_L1+4
     404   00:4E4E                      
     405   00:4E4E  AF                      XOR A
     406   00:4E4F  32 0F C0                LD (CHAR_GHOST_DEAD_STG2), A
     407   00:4E52  32 10 C0                LD (CHAR_MIN_STEP_STG2), A
     408   00:4E55  3E FF                   LD A, $FF
     409   00:4E57  32 12 C0                LD (CHAR_DIR_GHOST_STG2), A
     410   00:4E5A  3E 01                   LD A, MOV_SPEED_GHOST
     411   00:4E5C  32 0D C0            	LD (CHAR_SPEED_X_GHOST_STG2), A
     412   00:4E5F                      
     413   00:4E5F  CD 44 00                CALL ENASCR
     414   00:4E62                          
     415   00:4E62                      MAIN_LOOP2:
     416   00:4E62  76                      halt    
     417   00:4E63                      
     418   00:4E63  DD 7E 00                LD A, (ix)    
     419   00:4E66  FE A2                   CP 162      ; Miramos si la Y es 160 para pasar a stg1
     420   00:4E68  C2 92 4E                JP NZ, .no_screen_change
     421   00:4E6B                          ; Ponemos el SP1 al principio de la pantalla 1
     422   00:4E6B  DD 36 00 01             LD (ix), 1          ; SP1 - Y = 1
     423   00:4E6F  DD 36 04 01             LD (ix+4), 1
     424   00:4E73  DD 36 08 01             LD (ix+8), 1
     425   00:4E77                      
     426   00:4E77  3A 0E C0                LD A, (CHAR_GHOST_DEAD)
     427   00:4E7A  FE 01                   CP $01
     428   00:4E7C  CA 87 4E                JP Z, .GHOST_DEAD
     429   00:4E7F  DD 36 10 0F             ld (ix+SPR_GHOST_STG1), $0F      ; Sprite 1 - Ghost
     430   00:4E83  DD 36 14 0F             ld (ix+SPR_GHOST_STG1+4), $0F      ; Sprite 1 - Ghost
     431   00:4E87                      .GHOST_DEAD:
     432   00:4E87  DD 36 18 D9             LD (ix+SPR_GHOST_STG2),217  ; ocultamos el esqueleto
     433   00:4E8B  DD 36 1C D9             LD (ix+SPR_GHOST_STG2+4),217  ; ocultamos el esqueleto
     434   00:4E8F  CD 2C 4C                CALL STAGE1
     435   00:4E92                      
     436   00:4E92                      .no_screen_change:
     437   00:4E92                      
     438   00:4E92  CD CE 41                call DUMP_SPR_ATTS    
     439   00:4E95                          ; Movemos el esqueleto
     440   00:4E95  3A 0F C0                LD A,(CHAR_GHOST_DEAD_STG2)
     441   00:4E98  FE 01                   CP $01
     442   00:4E9A  CA 1F 4F                JP Z,.continue
     443   00:4E9D  DD 7E 19                LD A, (ix+SPR_GHOST_STG2+1)          ;cargamos la X del Esqueleto
     444   00:4EA0  2A 0D C0            	LD HL, (CHAR_SPEED_X_GHOST_STG2)
     445   00:4EA3  85                  	ADD L					; Actualizamos la posicion en base a la velocidad
     446   00:4EA4                          
     447   00:4EA4  DD 77 19            	LD (ix+SPR_GHOST_STG2+1), A	
     448   00:4EA7  DD 77 1D                LD (ix+SPR_GHOST_STG2+5), A
     449   00:4EAA  FE 16                   CP $16
     450   00:4EAC  CA C4 4E                JP Z,.CHANGE_DIR_RIGHT
     451   00:4EAF  FE B9                   CP $B9
     452   00:4EB1  CA D1 4E                JP Z,.CHANGE_DIR_LEFT
     453   00:4EB4                      
     454   00:4EB4  3A 10 C0                LD A, (CHAR_MIN_STEP_STG2)		
     455   00:4EB7  FE 06                   CP MAX_CHAR_STEPS_STG2
     456   00:4EB9  CA DA 4E                JP Z,.check_pattern
     457   00:4EBC  C6 01                   ADD 1
     458   00:4EBE  32 10 C0                LD (CHAR_MIN_STEP_STG2), A
     459   00:4EC1  C3 1F 4F                JP .continue
     460   00:4EC4                      
     461   00:4EC4                      .CHANGE_DIR_RIGHT:
     462   00:4EC4  3E 01                   LD A, MOV_SPEED_GHOST
     463   00:4EC6  32 0D C0            	LD (CHAR_SPEED_X_GHOST_STG2), A
     464   00:4EC9  3E FF                   LD A,$FF
     465   00:4ECB  32 12 C0                LD (CHAR_DIR_GHOST_STG2),A
     466   00:4ECE  C3 DA 4E                JP .check_pattern
     467   00:4ED1                      
     468   00:4ED1                      .CHANGE_DIR_LEFT:
     469   00:4ED1  3E FF                   LD A, -MOV_SPEED_GHOST
     470   00:4ED3  32 0D C0            	LD (CHAR_SPEED_X_GHOST_STG2), A
     471   00:4ED6  AF                      XOR A   ; Pone A a 0
     472   00:4ED7  32 12 C0                LD (CHAR_DIR_GHOST_STG2),A
     473   00:4EDA                      
     474   00:4EDA                      .check_pattern:
     475   00:4EDA  AF                      XOR A
     476   00:4EDB  32 10 C0                LD (CHAR_MIN_STEP_STG2), A
     477   00:4EDE  3A 12 C0                LD A,(CHAR_DIR_GHOST_STG2)
     478   00:4EE1  FE FF                   CP $FF
     479   00:4EE3  CA 04 4F                JP Z,.check_pattern_RIGHT
     480   00:4EE6  DD 7E 1A                LD A, (ix+SPR_GHOST_STG2+2)       ; Cargamos el patrón y lo cambiamos
     481   00:4EE9  FE 3C                   CP SPR_GHOST_STG2_PTRN_L1
     482   00:4EEB  CA F9 4E                jp z,.change_pattern_L
     483   00:4EEE  DD 36 1A 3C             LD (ix+SPR_GHOST_STG2+2),SPR_GHOST_STG2_PTRN_L1
     484   00:4EF2  DD 36 1E 40             LD (ix+SPR_GHOST_STG2+6),SPR_GHOST_STG2_PTRN_L1+4
     485   00:4EF6  C3 1F 4F                jp .continue
     486   00:4EF9                      .change_pattern_L:
     487   00:4EF9  DD 36 1A 44             LD (ix+SPR_GHOST_STG2+2),SPR_GHOST_STG2_PTRN_L2
     488   00:4EFD  DD 36 1E 48             LD (ix+SPR_GHOST_STG2+6),SPR_GHOST_STG2_PTRN_L2+4
     489   00:4F01  C3 1F 4F                jp .continue
     490   00:4F04                      
     491   00:4F04                      .check_pattern_RIGHT
     492   00:4F04  DD 7E 1A                LD A, (ix+SPR_GHOST_STG2+2)       ; Cargamos el patrón y lo cambiamos
     493   00:4F07  FE 4C                   CP SPR_GHOST_STG2_PTRN_R1
     494   00:4F09  CA 17 4F                jp z,.change_pattern_R
     495   00:4F0C  DD 36 1A 4C             LD (ix+SPR_GHOST_STG2+2),SPR_GHOST_STG2_PTRN_R1
     496   00:4F10  DD 36 1E 50             LD (ix+SPR_GHOST_STG2+6),SPR_GHOST_STG2_PTRN_R1+4
     497   00:4F14  C3 1F 4F                jp .continue
     498   00:4F17                      .change_pattern_R:
     499   00:4F17  DD 36 1A 54             LD (ix+SPR_GHOST_STG2+2),SPR_GHOST_STG2_PTRN_R2
     500   00:4F1B  DD 36 1E 58             LD (ix+SPR_GHOST_STG2+6),SPR_GHOST_STG2_PTRN_R2+4
     501   00:4F1F                      
     502   00:4F1F                      .continue:
     503   00:4F1F  CD 42 44                CALL MOVE_SHOOT    
     504   00:4F22                      
     505   00:4F22  3E 08                   ld a, 8
     506   00:4F24  CD 41 01            	call SNSMAT   
     507   00:4F27  4F                      LD C,A    
     508   00:4F28                              
     509   00:4F28  CB 79                   BIT KB_RIGHT, C			; La tecla presionada es RIGHT?
     510   00:4F2A  CC 8A 42                call z, move_right
     511   00:4F2D                          
     512   00:4F2D  CB 61                   BIT KB_LEFT, C			; La tecla presionada es LEFT?
     513   00:4F2F  CC E9 42                call z, move_left
     514   00:4F32                      
     515   00:4F32  CB 69                   BIT KB_UP, C			; La tecla presionada es UP?
     516   00:4F34  CC 15 42                call z, move_up
     517   00:4F37                      
     518   00:4F37  CB 71                   BIT KB_DOWN, C			; La tecla presionada es DOWN?
     519   00:4F39  CC 4F 42                call z, move_down
     520   00:4F3C                      
     521   00:4F3C  CB 41                   BIT KB_SPACE, C			; La tecla presionada es SPACE
     522   00:4F3E  CC 98 4D                call z,SHOOT_MAIN_CHAR
     523   00:4F41                      
     524   00:4F41  CB 59                   BIT KB_DEL, C			; La tecla presionada es DEL    
     525   00:4F43  C8                      ret z
     526   00:4F44                      
     527   00:4F44  C3 62 4E                jp MAIN_LOOP2
     528   00:4F47                      
     529   00:4F47                      
     530   00:4F47                      SONG:
     531   00:4F47                      	;incbin "musica_sin_cabacera.pt3"
     532   00:4F47  (0EE7)                  incbin "sfx\test.pt3"
     533   00:5E2E                      include "include\BTH_data.asm"
       1.  00:5E2E                      SPRITE_P1_UP:
       2.  00:5E2E                          ; UP 1        
       3.  00:5E2E                          ; mask 0
       4.  00:5E2E                          DB $07,$0F,$05,$1F,$1F,$3F,$3F,$7F
       4.  00:5E2E  07 0F 05 1F 1F 3F 3F 7F 
       5.  00:5E36                          DB $00,$4F,$70,$38,$0C,$0E,$07,$04
       5.  00:5E36  00 4F 70 38 0C 0E 07 04 
       6.  00:5E3E                          DB $E0,$F0,$A0,$F8,$F8,$F8,$FC,$FE
       6.  00:5E3E  E0 F0 A0 F8 F8 F8 FC FE 
       7.  00:5E46                          DB $06,$F2,$1E,$3C,$30,$70,$C0,$00
       7.  00:5E46  06 F2 1E 3C 30 70 C0 00 
       8.  00:5E4E                          ; mask 1
       9.  00:5E4E                          DB $00,$00,$18,$00,$1F,$00,$00,$00
       9.  00:5E4E  00 00 18 00 1F 00 00 00 
      10.  00:5E56                          DB $7F,$50,$4F,$3F,$0F,$0F,$07,$02
      10.  00:5E56  7F 50 4F 3F 0F 0F 07 02 
      11.  00:5E5E                          DB $00,$00,$10,$00,$FC,$00,$00,$00
      11.  00:5E5E  00 00 10 00 FC 00 00 00 
      12.  00:5E66                          DB $F2,$0E,$FE,$FC,$F0,$F0,$A0,$00
      12.  00:5E66  F2 0E FE FC F0 F0 A0 00 
      13.  00:5E6E                          ; mask 2
      14.  00:5E6E                          DB $00,$00,$1A,$00,$00,$00,$00,$00
      14.  00:5E6E  00 00 1A 00 00 00 00 00 
      15.  00:5E76                          DB $7F,$60,$00,$00,$00,$00,$07,$00
      15.  00:5E76  7F 60 00 00 00 00 07 00 
      16.  00:5E7E                          DB $00,$00,$50,$00,$00,$00,$00,$00
      16.  00:5E7E  00 00 50 00 00 00 00 00 
      17.  00:5E86                          DB $FA,$0E,$00,$00,$00,$00,$80,$00
      17.  00:5E86  FA 0E 00 00 00 00 80 00 
      18.  00:5E8E                          
      19.  00:5E8E                          ; UP 2
      20.  00:5E8E                          ; mask 0
      21.  00:5E8E                          DB $07,$0F,$05,$1F,$1F,$3F,$3F,$7F
      21.  00:5E8E  07 0F 05 1F 1F 3F 3F 7F 
      22.  00:5E96                          DB $10,$4F,$70,$38,$0C,$0E,$05,$00
      22.  00:5E96  10 4F 70 38 0C 0E 05 00 
      23.  00:5E9E                          DB $E0,$F0,$A0,$F8,$F8,$F8,$FC,$FE
      23.  00:5E9E  E0 F0 A0 F8 F8 F8 FC FE 
      24.  00:5EA6                          DB $02,$F2,$1E,$3C,$30,$70,$E0,$40
      24.  00:5EA6  02 F2 1E 3C 30 70 E0 40 
      25.  00:5EAE                          ; mask 1
      26.  00:5EAE                          DB $00,$00,$18,$00,$1F,$00,$00,$00
      26.  00:5EAE  00 00 18 00 1F 00 00 00 
      27.  00:5EB6                          DB $4F,$70,$7F,$3F,$0F,$0F,$03,$00
      27.  00:5EB6  4F 70 7F 3F 0F 0F 03 00 
      28.  00:5EBE                          DB $00,$00,$10,$00,$FC,$00,$00,$00
      28.  00:5EBE  00 00 10 00 FC 00 00 00 
      29.  00:5EC6                          DB $FE,$06,$F2,$FC,$F0,$F0,$E0,$20
      29.  00:5EC6  FE 06 F2 FC F0 F0 E0 20 
      30.  00:5ECE                          ; mask 2
      31.  00:5ECE                          DB $00,$00,$1A,$00,$00,$00,$00,$00
      31.  00:5ECE  00 00 1A 00 00 00 00 00 
      32.  00:5ED6                          DB $6F,$70,$00,$00,$00,$00,$01,$00
      32.  00:5ED6  6F 70 00 00 00 00 01 00 
      33.  00:5EDE                          DB $00,$00,$50,$00,$00,$00,$00,$00
      33.  00:5EDE  00 00 50 00 00 00 00 00 
      34.  00:5EE6                          DB $FE,$0A,$00,$00,$00,$00,$E0,$00
      34.  00:5EE6  FE 0A 00 00 00 00 E0 00 
      35.  00:5EEE                          
      36.  00:5EEE                      SPRITE_P1_DOWN:
      37.  00:5EEE                          ; DOWN 1 - 00h
      38.  00:5EEE                          ; mask 0
      39.  00:5EEE                          DB $07,$0F,$04,$06,$0F,$07,$1F,$3F
      39.  00:5EEE  07 0F 04 06 0F 07 1F 3F 
      40.  00:5EF6                          DB $4C,$4E,$4E,$3C,$0C,$0E,$0F,$08
      40.  00:5EF6  4C 4E 4E 3C 0C 0E 0F 08 
      41.  00:5EFE                          DB $E0,$F0,$20,$20,$70,$E0,$F8,$FC
      41.  00:5EFE  E0 F0 20 20 70 E0 F8 FC 
      42.  00:5F06                          DB $32,$72,$7E,$7C,$70,$F0,$C0,$00    
      42.  00:5F06  32 72 7E 7C 70 F0 C0 00 
      43.  00:5F0E                          ; mask 1
      44.  00:5F0E                          DB $00,$00,$19,$19,$10,$3A,$3A,$78
      44.  00:5F0E  00 00 19 19 10 3A 3A 78 
      45.  00:5F16                          DB $5F,$5E,$7E,$3C,$0C,$0E,$0F,$04
      45.  00:5F16  5F 5E 7E 3C 0C 0E 0F 04 
      46.  00:5F1E                          DB $00,$00,$90,$D8,$88,$58,$5C,$1E
      46.  00:5F1E  00 00 90 D8 88 58 5C 1E 
      47.  00:5F26                          DB $F6,$FE,$FE,$3C,$30,$70,$A0,$00    
      47.  00:5F26  F6 FE FE 3C 30 70 A0 00 
      48.  00:5F2E                          ; mask 2
      49.  00:5F2E                          DB $00,$00,$1B,$00,$10,$00,$00,$00
      49.  00:5F2E  00 00 1B 00 10 00 00 00 
      50.  00:5F36                          DB $6F,$6F,$7F,$3F,$0F,$0F,$0F,$00
      50.  00:5F36  6F 6F 7F 3F 0F 0F 0F 00 
      51.  00:5F3E                          DB $00,$00,$D0,$00,$8C,$00,$00,$00
      51.  00:5F3E  00 00 D0 00 8C 00 00 00 
      52.  00:5F46                          DB $FA,$7E,$7E,$BC,$B0,$70,$80,$00
      52.  00:5F46  FA 7E 7E BC B0 70 80 00 
      53.  00:5F4E                          
      54.  00:5F4E                          ; DOWN 2
      55.  00:5F4E                          ; mask 0 - 0Ch    
      56.  00:5F4E                          DB $07,$0F,$04,$06,$0F,$07,$1F,$3F
      56.  00:5F4E  07 0F 04 06 0F 07 1F 3F 
      57.  00:5F56                          DB $4C,$4E,$7E,$3C,$0C,$0E,$05,$00
      57.  00:5F56  4C 4E 7E 3C 0C 0E 05 00 
      58.  00:5F5E                          DB $E0,$F0,$20,$20,$70,$E0,$F8,$FC
      58.  00:5F5E  E0 F0 20 20 70 E0 F8 FC 
      59.  00:5F66                          DB $32,$72,$72,$7C,$70,$F0,$E0,$40    
      59.  00:5F66  32 72 72 7C 70 F0 E0 40 
      60.  00:5F6E                          ; mask 1
      61.  00:5F6E                          DB $00,$00,$19,$19,$10,$3A,$3A,$78
      61.  00:5F6E  00 00 19 19 10 3A 3A 78 
      62.  00:5F76                          DB $5F,$7E,$7E,$3C,$0C,$0E,$03,$00
      62.  00:5F76  5F 7E 7E 3C 0C 0E 03 00 
      63.  00:5F7E                          DB $00,$00,$90,$D8,$88,$58,$5C,$1E
      63.  00:5F7E  00 00 90 D8 88 58 5C 1E 
      64.  00:5F86                          DB $F6,$F6,$FE,$3C,$30,$70,$E0,$20    
      64.  00:5F86  F6 F6 FE 3C 30 70 E0 20 
      65.  00:5F8E                          ; mask 2
      66.  00:5F8E                          DB $00,$00,$1B,$00,$10,$00,$00,$00
      66.  00:5F8E  00 00 1B 00 10 00 00 00 
      67.  00:5F96                          DB $6F,$7F,$7F,$3F,$0F,$0F,$01,$00
      67.  00:5F96  6F 7F 7F 3F 0F 0F 01 00 
      68.  00:5F9E                          DB $00,$00,$D0,$00,$8C,$00,$00,$00
      68.  00:5F9E  00 00 D0 00 8C 00 00 00 
      69.  00:5FA6                          DB $FA,$7A,$7E,$BC,$B0,$70,$E0,$00
      69.  00:5FA6  FA 7A 7E BC B0 70 E0 00 
      70.  00:5FAE                      
      71.  00:5FAE                      SPRITE_P1_LEFT:         
      72.  00:5FAE                          ; --- Slot 3
      73.  00:5FAE                          ; mask 0
      74.  00:5FAE                          DB $07,$0F,$02,$05,$07,$07,$0F,$0F
      74.  00:5FAE  07 0F 02 05 07 07 0F 0F 
      75.  00:5FB6                          DB $07,$03,$03,$03,$01,$03,$03,$04
      75.  00:5FB6  07 03 03 03 01 03 03 04 
      76.  00:5FBE                          DB $E0,$F0,$80,$00,$A0,$E0,$C0,$C0
      76.  00:5FBE  E0 F0 80 00 A0 E0 C0 C0 
      77.  00:5FC6                          DB $E0,$B0,$70,$F0,$F0,$F0,$C0,$00    
      77.  00:5FC6  E0 B0 70 F0 F0 F0 C0 00 
      78.  00:5FCE                          ; mask 1
      79.  00:5FCE                          DB $00,$00,$18,$1A,$08,$0A,$12,$10
      79.  00:5FCE  00 00 18 1A 08 0A 12 10 
      80.  00:5FD6                          DB $08,$03,$02,$02,$01,$03,$03,$03
      80.  00:5FD6  08 03 02 02 01 03 03 03 
      81.  00:5FDE                          DB $00,$00,$78,$F8,$5C,$1C,$7E,$7E
      81.  00:5FDE  00 00 78 F8 5C 1C 7E 7E 
      82.  00:5FE6                          DB $FE,$3E,$7E,$7C,$F8,$F8,$B0,$00
      82.  00:5FE6  FE 3E 7E 7C F8 F8 B0 00 
      83.  00:5FEE                          ; mask 2
      84.  00:5FEE                          DB $00,$00,$1D,$00,$28,$00,$00,$00
      84.  00:5FEE  00 00 1D 00 28 00 00 00 
      85.  00:5FF6                          DB $00,$07,$06,$06,$07,$07,$03,$00
      85.  00:5FF6  00 07 06 06 07 07 03 00 
      86.  00:5FFE                          DB $00,$00,$78,$00,$5C,$00,$00,$00
      86.  00:5FFE  00 00 78 00 5C 00 00 00 
      87.  00:6006                          DB $00,$7E,$FE,$7C,$F8,$F8,$80,$00
      87.  00:6006  00 7E FE 7C F8 F8 80 00 
      88.  00:600E                          ; --- Slot 4
      89.  00:600E                          ; mask 0
      90.  00:600E                          DB $07,$0F,$02,$05,$07,$07,$0F,$0F
      90.  00:600E  07 0F 02 05 07 07 0F 0F 
      91.  00:6016                          DB $07,$03,$03,$03,$01,$03,$04,$00
      91.  00:6016  07 03 03 03 01 03 04 00 
      92.  00:601E                          DB $E0,$F0,$80,$00,$A0,$E0,$C0,$C0
      92.  00:601E  E0 F0 80 00 A0 E0 C0 C0 
      93.  00:6026                          DB $E0,$B0,$D0,$D0,$F0,$F0,$E0,$40
      93.  00:6026  E0 B0 D0 D0 F0 F0 E0 40 
      94.  00:602E                          ; mask 1
      95.  00:602E                          DB $00,$00,$18,$1A,$08,$0A,$12,$10
      95.  00:602E  00 00 18 1A 08 0A 12 10 
      96.  00:6036                          DB $08,$03,$03,$03,$01,$03,$03,$00
      96.  00:6036  08 03 03 03 01 03 03 00 
      97.  00:603E                          DB $00,$00,$78,$F8,$5C,$1C,$7E,$7E
      97.  00:603E  00 00 78 F8 5C 1C 7E 7E 
      98.  00:6046                          DB $FE,$3E,$9E,$9C,$98,$F8,$E0,$30
      98.  00:6046  FE 3E 9E 9C 98 F8 E0 30 
      99.  00:604E                          ; mask 2
     100.  00:604E                          DB $00,$00,$1D,$00,$28,$00,$00,$00
     100.  00:604E  00 00 1D 00 28 00 00 00 
     101.  00:6056                          DB $00,$07,$07,$07,$07,$07,$00,$00
     101.  00:6056  00 07 07 07 07 07 00 00 
     102.  00:605E                          DB $00,$00,$78,$00,$5C,$00,$00,$00
     102.  00:605E  00 00 78 00 5C 00 00 00 
     103.  00:6066                          DB $00,$7E,$BE,$BC,$98,$F8,$E0,$00
     103.  00:6066  00 7E BE BC 98 F8 E0 00 
     104.  00:606E                      
     105.  00:606E                      SPRITE_P1_RIGHT:
     106.  00:606E                          ; --- Slot 0
     107.  00:606E                          ; mask 0
     108.  00:606E                          DB $07,$0F,$01,$00,$05,$07,$03,$03
     108.  00:606E  07 0F 01 00 05 07 03 03 
     109.  00:6076                          DB $07,$0D,$0E,$0F,$0F,$0F,$03,$00
     109.  00:6076  07 0D 0E 0F 0F 0F 03 00 
     110.  00:607E                          DB $E0,$F0,$40,$A0,$E0,$E0,$F0,$F0
     110.  00:607E  E0 F0 40 A0 E0 E0 F0 F0 
     111.  00:6086                          DB $E0,$C0,$C0,$C0,$80,$C0,$C0,$20
     111.  00:6086  E0 C0 C0 C0 80 C0 C0 20 
     112.  00:608E                          ; mask 1
     113.  00:608E                          DB $00,$00,$1E,$1F,$3A,$38,$7E,$7E
     113.  00:608E  00 00 1E 1F 3A 38 7E 7E 
     114.  00:6096                          DB $7F,$7C,$7E,$3E,$1F,$1F,$0D,$00
     114.  00:6096  7F 7C 7E 3E 1F 1F 0D 00 
     115.  00:609E                          DB $00,$00,$18,$58,$10,$50,$48,$08
     115.  00:609E  00 00 18 58 10 50 48 08 
     116.  00:60A6                          DB $10,$C0,$40,$40,$80,$C0,$C0,$C0
     116.  00:60A6  10 C0 40 40 80 C0 C0 C0 
     117.  00:60AE                          ; mask 2
     118.  00:60AE                          DB $00,$00,$1E,$00,$3A,$00,$00,$00
     118.  00:60AE  00 00 1E 00 3A 00 00 00 
     119.  00:60B6                          DB $00,$7E,$7F,$3E,$1F,$1F,$01,$00
     119.  00:60B6  00 7E 7F 3E 1F 1F 01 00 
     120.  00:60BE                          DB $00,$00,$B8,$00,$14,$00,$00,$00
     120.  00:60BE  00 00 B8 00 14 00 00 00 
     121.  00:60C6                          DB $00,$E0,$60,$60,$E0,$E0,$C0,$00
     121.  00:60C6  00 E0 60 60 E0 E0 C0 00 
     122.  00:60CE                          
     123.  00:60CE                          ; --- Slot 2
     124.  00:60CE                         ; mask 0
     125.  00:60CE                          DB $07,$0F,$01,$00,$05,$07,$03,$03
     125.  00:60CE  07 0F 01 00 05 07 03 03 
     126.  00:60D6                          DB $07,$0D,$0B,$0B,$0F,$0F,$07,$02
     126.  00:60D6  07 0D 0B 0B 0F 0F 07 02 
     127.  00:60DE                          DB $E0,$F0,$40,$A0,$E0,$E0,$F0,$F0
     127.  00:60DE  E0 F0 40 A0 E0 E0 F0 F0 
     128.  00:60E6                          DB $E0,$C0,$C0,$C0,$80,$C0,$20,$00
     128.  00:60E6  E0 C0 C0 C0 80 C0 20 00 
     129.  00:60EE                          ; mask 1
     130.  00:60EE                          DB $00,$00,$1E,$1F,$3A,$38,$7E,$7E
     130.  00:60EE  00 00 1E 1F 3A 38 7E 7E 
     131.  00:60F6                          DB $7F,$7C,$79,$39,$19,$1F,$07,$0C
     131.  00:60F6  7F 7C 79 39 19 1F 07 0C 
     132.  00:60FE                          DB $00,$00,$18,$58,$10,$50,$48,$08
     132.  00:60FE  00 00 18 58 10 50 48 08 
     133.  00:6106                          DB $10,$C0,$C0,$C0,$80,$C0,$C0,$00
     133.  00:6106  10 C0 C0 C0 80 C0 C0 00 
     134.  00:610E                              ; mask 2
     135.  00:610E                          DB $00,$00,$1E,$00,$3A,$00,$00,$00
     135.  00:610E  00 00 1E 00 3A 00 00 00 
     136.  00:6116                          DB $00,$7E,$7D,$3D,$19,$1F,$07,$00
     136.  00:6116  00 7E 7D 3D 19 1F 07 00 
     137.  00:611E                          DB $00,$00,$B8,$00,$14,$00,$00,$00
     137.  00:611E  00 00 B8 00 14 00 00 00 
     138.  00:6126                          DB $00,$E0,$E0,$E0,$E0,$E0,$00,$00
     138.  00:6126  00 E0 E0 E0 E0 E0 00 00 
     139.  00:612E                          
     140.  00:612E                      SPRITE_PATTERN:    
     141.  00:612E                          ; P1 - DOWN 1 
     142.  00:612E                          ; DOWN 1 - 00h
     143.  00:612E                          ; mask 0
     144.  00:612E                          DB $07,$0F,$04,$06,$0F,$07,$1F,$3F
     144.  00:612E  07 0F 04 06 0F 07 1F 3F 
     145.  00:6136                          DB $4C,$4E,$4E,$3C,$0C,$0E,$0F,$08
     145.  00:6136  4C 4E 4E 3C 0C 0E 0F 08 
     146.  00:613E                          DB $E0,$F0,$20,$20,$70,$E0,$F8,$FC
     146.  00:613E  E0 F0 20 20 70 E0 F8 FC 
     147.  00:6146                          DB $32,$72,$7E,$7C,$70,$F0,$C0,$00    
     147.  00:6146  32 72 7E 7C 70 F0 C0 00 
     148.  00:614E                          ; mask 1
     149.  00:614E                          DB $00,$00,$19,$19,$10,$3A,$3A,$78
     149.  00:614E  00 00 19 19 10 3A 3A 78 
     150.  00:6156                          DB $5F,$5E,$7E,$3C,$0C,$0E,$0F,$04
     150.  00:6156  5F 5E 7E 3C 0C 0E 0F 04 
     151.  00:615E                          DB $00,$00,$90,$D8,$88,$58,$5C,$1E
     151.  00:615E  00 00 90 D8 88 58 5C 1E 
     152.  00:6166                          DB $F6,$FE,$FE,$3C,$30,$70,$A0,$00    
     152.  00:6166  F6 FE FE 3C 30 70 A0 00 
     153.  00:616E                          ; mask 2
     154.  00:616E                          DB $00,$00,$1B,$00,$10,$00,$00,$00
     154.  00:616E  00 00 1B 00 10 00 00 00 
     155.  00:6176                          DB $6F,$6F,$7F,$3F,$0F,$0F,$0F,$00
     155.  00:6176  6F 6F 7F 3F 0F 0F 0F 00 
     156.  00:617E                          DB $00,$00,$D0,$00,$8C,$00,$00,$00
     156.  00:617E  00 00 D0 00 8C 00 00 00 
     157.  00:6186                          DB $FA,$7E,$7E,$BC,$B0,$70,$80,$00
     157.  00:6186  FA 7E 7E BC B0 70 80 00 
     158.  00:618E                          
     159.  00:618E                          ; DOWN 2
     160.  00:618E                          ; mask 0 - 0Ch    
     161.  00:618E                          DB $07,$0F,$04,$06,$0F,$07,$1F,$3F
     161.  00:618E  07 0F 04 06 0F 07 1F 3F 
     162.  00:6196                          DB $4C,$4E,$7E,$3C,$0C,$0E,$05,$00
     162.  00:6196  4C 4E 7E 3C 0C 0E 05 00 
     163.  00:619E                          DB $E0,$F0,$20,$20,$70,$E0,$F8,$FC
     163.  00:619E  E0 F0 20 20 70 E0 F8 FC 
     164.  00:61A6                          DB $32,$72,$72,$7C,$70,$F0,$E0,$40    
     164.  00:61A6  32 72 72 7C 70 F0 E0 40 
     165.  00:61AE                          ; mask 1
     166.  00:61AE                          DB $00,$00,$19,$19,$10,$3A,$3A,$78
     166.  00:61AE  00 00 19 19 10 3A 3A 78 
     167.  00:61B6                          DB $5F,$7E,$7E,$3C,$0C,$0E,$03,$00
     167.  00:61B6  5F 7E 7E 3C 0C 0E 03 00 
     168.  00:61BE                          DB $00,$00,$90,$D8,$88,$58,$5C,$1E
     168.  00:61BE  00 00 90 D8 88 58 5C 1E 
     169.  00:61C6                          DB $F6,$F6,$FE,$3C,$30,$70,$E0,$20    
     169.  00:61C6  F6 F6 FE 3C 30 70 E0 20 
     170.  00:61CE                          ; mask 2
     171.  00:61CE                          DB $00,$00,$1B,$00,$10,$00,$00,$00
     171.  00:61CE  00 00 1B 00 10 00 00 00 
     172.  00:61D6                          DB $6F,$7F,$7F,$3F,$0F,$0F,$01,$00
     172.  00:61D6  6F 7F 7F 3F 0F 0F 01 00 
     173.  00:61DE                          DB $00,$00,$D0,$00,$8C,$00,$00,$00
     173.  00:61DE  00 00 D0 00 8C 00 00 00 
     174.  00:61E6                          DB $FA,$7A,$7E,$BC,$B0,$70,$E0,$00
     174.  00:61E6  FA 7A 7E BC B0 70 E0 00 
     175.  00:61EE                          
     176.  00:61EE                          ; Antichrist - RIGHT
     177.  00:61EE                          ; mask 0 - 18h    
     178.  00:61EE                          DB $00,$00,$00,$01,$01,$01,$01,$01
     178.  00:61EE  00 00 00 01 01 01 01 01 
     179.  00:61F6                          DB $01,$01,$07,$07,$01,$01,$00,$00
     179.  00:61F6  01 01 07 07 01 01 00 00 
     180.  00:61FE                          DB $00,$00,$00,$80,$80,$80,$80,$80
     180.  00:61FE  00 00 00 80 80 80 80 80 
     181.  00:6206                          DB $80,$80,$E0,$E0,$80,$80,$00,$00
     181.  00:6206  80 80 E0 E0 80 80 00 00 
     182.  00:620E                      
     183.  00:620E                          ;Ghost 1 Left - 1CH
     184.  00:620E                          ; mask 0
     185.  00:620E                          DB $03,$04,$08,$68,$B5,$90,$50,$40
     185.  00:620E  03 04 08 68 B5 90 50 40 
     186.  00:6216                          DB $22,$20,$10,$10,$08,$06,$03,$00
     186.  00:6216  22 20 10 10 08 06 03 00 
     187.  00:621E                          DB $C0,$E0,$70,$36,$BB,$33,$26,$06
     187.  00:621E  C0 E0 70 36 BB 33 26 06 
     188.  00:6226                          DB $0C,$18,$3E,$19,$07,$0C,$F8,$E0
     188.  00:6226  0C 18 3E 19 07 0C F8 E0 
     189.  00:622E                          ; mask 1    20h
     190.  00:622E                          DB $00,$07,$0F,$6F,$DF,$FF,$6F,$7F
     190.  00:622E  00 07 0F 6F DF FF 6F 7F 
     191.  00:6236                          DB $3F,$3F,$1F,$1F,$0F,$05,$03,$00
     191.  00:6236  3F 3F 1F 1F 0F 05 03 00 
     192.  00:623E                          DB $00,$20,$90,$D6,$DD,$DD,$DA,$FA
     192.  00:623E  00 20 90 D6 DD DD DA FA 
     193.  00:6246                          DB $F4,$E8,$CE,$EF,$FB,$F4,$18,$00
     193.  00:6246  F4 E8 CE EF FB F4 18 00 
     194.  00:624E                          
     195.  00:624E                          ; Ghost 2 Left - 24h
     196.  00:624E                          ; mask 0    24-h
     197.  00:624E                          DB $03,$04,$08,$08,$65,$B0,$90,$40
     197.  00:624E  03 04 08 08 65 B0 90 40 
     198.  00:6256                          DB $22,$20,$10,$10,$08,$06,$01,$00
     198.  00:6256  22 20 10 10 08 06 01 00 
     199.  00:625E                          DB $C0,$E0,$70,$30,$B6,$3B,$27,$06
     199.  00:625E  C0 E0 70 30 B6 3B 27 06 
     200.  00:6266                          DB $0C,$18,$3C,$1A,$06,$0C,$F0,$C0
     200.  00:6266  0C 18 3C 1A 06 0C F0 C0 
     201.  00:626E                          ; mask 1    28h
     202.  00:626E                          DB $00,$07,$0F,$0F,$6F,$DF,$EF,$7F
     202.  00:626E  00 07 0F 0F 6F DF EF 7F 
     203.  00:6276                          DB $3F,$3F,$1F,$1F,$0F,$05,$01,$00
     203.  00:6276  3F 3F 1F 1F 0F 05 01 00 
     204.  00:627E                          DB $00,$20,$90,$D0,$D6,$DD,$D9,$FA
     204.  00:627E  00 20 90 D0 D6 DD D9 FA 
     205.  00:6286                          DB $F4,$E8,$CC,$EE,$FA,$F4,$30,$00
     205.  00:6286  F4 E8 CC EE FA F4 30 00 
     206.  00:628E                      
     207.  00:628E                          ; Ghost 1 Right - 2Ch
     208.  00:628E                          ; mask 0
     209.  00:628E                          DB $03,$07,$0E,$6C,$DD,$CC,$64,$60
     209.  00:628E  03 07 0E 6C DD CC 64 60 
     210.  00:6296                          DB $30,$18,$7C,$98,$E0,$30,$1F,$07
     210.  00:6296  30 18 7C 98 E0 30 1F 07 
     211.  00:629E                          DB $C0,$20,$10,$16,$AD,$09,$0A,$02
     211.  00:629E  C0 20 10 16 AD 09 0A 02 
     212.  00:62A6                          DB $44,$04,$08,$08,$10,$60,$C0,$00
     212.  00:62A6  44 04 08 08 10 60 C0 00 
     213.  00:62AE                          ; mask 1    - 30h
     214.  00:62AE                          DB $00,$04,$09,$6B,$BB,$BB,$5B,$5F
     214.  00:62AE  00 04 09 6B BB BB 5B 5F 
     215.  00:62B6                          DB $2F,$17,$73,$F7,$DF,$2F,$18,$00
     215.  00:62B6  2F 17 73 F7 DF 2F 18 00 
     216.  00:62BE                          DB $00,$E0,$F0,$F6,$FB,$FF,$F6,$FE
     216.  00:62BE  00 E0 F0 F6 FB FF F6 FE 
     217.  00:62C6                          DB $FC,$FC,$F8,$F8,$F0,$A0,$C0,$00
     217.  00:62C6  FC FC F8 F8 F0 A0 C0 00 
     218.  00:62CE                          
     219.  00:62CE                          ; Ghost 2 Right - 34h
     220.  00:62CE                          ; mask 0
     221.  00:62CE                          DB $03,$07,$0E,$0C,$6D,$DC,$E4,$60
     221.  00:62CE  03 07 0E 0C 6D DC E4 60 
     222.  00:62D6                          DB $30,$18,$3C,$58,$60,$30,$0F,$03
     222.  00:62D6  30 18 3C 58 60 30 0F 03 
     223.  00:62DE                          DB $C0,$20,$10,$10,$A6,$0D,$09,$02
     223.  00:62DE  C0 20 10 10 A6 0D 09 02 
     224.  00:62E6                          DB $44,$04,$08,$08,$10,$60,$80,$00
     224.  00:62E6  44 04 08 08 10 60 80 00 
     225.  00:62EE                          ; mask 1    38h
     226.  00:62EE                          DB $00,$04,$09,$0B,$6B,$BB,$9B,$5F
     226.  00:62EE  00 04 09 0B 6B BB 9B 5F 
     227.  00:62F6                          DB $2F,$17,$33,$77,$5F,$2F,$0C,$00
     227.  00:62F6  2F 17 33 77 5F 2F 0C 00 
     228.  00:62FE                          DB $00,$E0,$F0,$F0,$F6,$FB,$F7,$FE
     228.  00:62FE  00 E0 F0 F0 F6 FB F7 FE 
     229.  00:6306                          DB $FC,$FC,$F8,$F8,$F0,$A0,$80,$00
     229.  00:6306  FC FC F8 F8 F0 A0 80 00 
     230.  00:630E                          
     231.  00:630E                      
     232.  00:630E                          ; Esqueleto Left - 1
     233.  00:630E                          ; mask 0 - 3Ch
     234.  00:630E                          DB $1F,$1B,$2E,$24,$3F,$1F,$1F,$00
     234.  00:630E  1F 1B 2E 24 3F 1F 1F 00 
     235.  00:6316                          DB $03,$05,$09,$04,$01,$02,$02,$04
     235.  00:6316  03 05 09 04 01 02 02 04 
     236.  00:631E                          DB $80,$C0,$C0,$C0,$80,$00,$00,$80
     236.  00:631E  80 C0 C0 C0 80 00 00 80 
     237.  00:6326                          DB $E0,$D0,$C8,$C4,$C0,$20,$20,$40
     237.  00:6326  E0 D0 C8 C4 C0 20 20 40 
     238.  00:632E                          ; mask 1 - 40h
     239.  00:632E                          DB $1F,$1F,$3F,$3F,$3F,$1E,$0A,$00
     239.  00:632E  1F 1F 3F 3F 3F 1E 0A 00 
     240.  00:6336                          DB $03,$05,$09,$04,$01,$00,$00,$00
     240.  00:6336  03 05 09 04 01 00 00 00 
     241.  00:633E                          DB $00,$80,$80,$80,$00,$00,$00,$00
     241.  00:633E  00 80 80 80 00 00 00 00 
     242.  00:6346                          DB $80,$10,$88,$84,$80,$00,$00,$00
     242.  00:6346  80 10 88 84 80 00 00 00 
     243.  00:634E                      
     244.  00:634E                          ; Esqueleto Left - 2
     245.  00:634E                          ; mask 0 - 44h
     246.  00:634E                          ; mask 0
     247.  00:634E                          DB $0F,$0D,$17,$12,$1F,$0F,$0F,$00
     247.  00:634E  0F 0D 17 12 1F 0F 0F 00 
     248.  00:6356                          DB $03,$05,$09,$10,$01,$06,$08,$00
     248.  00:6356  03 05 09 10 01 06 08 00 
     249.  00:635E                          DB $C0,$E0,$60,$60,$C0,$80,$80,$80
     249.  00:635E  C0 E0 60 60 C0 80 80 80 
     250.  00:6366                          DB $E0,$D0,$C8,$D0,$C0,$20,$20,$50
     250.  00:6366  E0 D0 C8 D0 C0 20 20 50 
     251.  00:636E                          ; mask 1 - 48h
     252.  00:636E                          DB $0F,$0F,$1F,$1F,$1F,$0F,$05,$00
     252.  00:636E  0F 0F 1F 1F 1F 0F 05 00 
     253.  00:6376                          DB $03,$05,$09,$10,$01,$00,$00,$00
     253.  00:6376  03 05 09 10 01 00 00 00 
     254.  00:637E                          DB $80,$C0,$C0,$C0,$80,$00,$00,$00
     254.  00:637E  80 C0 C0 C0 80 00 00 00 
     255.  00:6386                          DB $80,$10,$88,$90,$80,$00,$20,$40
     255.  00:6386  80 10 88 90 80 00 20 40 
     256.  00:638E                          
     257.  00:638E                          ; Esqueleto Right - 1
     258.  00:638E                          ; mask 0 - 4Ch
     259.  00:638E                          DB $01,$03,$03,$03,$01,$00,$00,$01
     259.  00:638E  01 03 03 03 01 00 00 01 
     260.  00:6396                          DB $07,$0B,$13,$23,$03,$04,$04,$02
     260.  00:6396  07 0B 13 23 03 04 04 02 
     261.  00:639E                          DB $F8,$D8,$74,$24,$FC,$F8,$F8,$00
     261.  00:639E  F8 D8 74 24 FC F8 F8 00 
     262.  00:63A6                          DB $C0,$A0,$90,$20,$80,$40,$40,$20
     262.  00:63A6  C0 A0 90 20 80 40 40 20 
     263.  00:63AE                          ; mask 1 - 50h
     264.  00:63AE                          DB $00,$01,$01,$01,$00,$00,$00,$00
     264.  00:63AE  00 01 01 01 00 00 00 00 
     265.  00:63B6                          DB $01,$08,$11,$21,$01,$00,$00,$00
     265.  00:63B6  01 08 11 21 01 00 00 00 
     266.  00:63BE                          DB $F8,$F8,$FC,$FC,$FC,$78,$50,$00
     266.  00:63BE  F8 F8 FC FC FC 78 50 00 
     267.  00:63C6                          DB $C0,$A0,$90,$20,$80,$00,$00,$00
     267.  00:63C6  C0 A0 90 20 80 00 00 00 
     268.  00:63CE                          
     269.  00:63CE                          ; Esqueleto Right - 2
     270.  00:63CE                          ; mask 0 - 54h
     271.  00:63CE                          DB $03,$07,$06,$06,$03,$01,$01,$01
     271.  00:63CE  03 07 06 06 03 01 01 01 
     272.  00:63D6                          DB $07,$0B,$13,$0B,$03,$04,$04,$0A
     272.  00:63D6  07 0B 13 0B 03 04 04 0A 
     273.  00:63DE                          DB $F0,$B0,$E8,$48,$F8,$F0,$F0,$00
     273.  00:63DE  F0 B0 E8 48 F8 F0 F0 00 
     274.  00:63E6                          DB $C0,$A0,$90,$08,$80,$60,$10,$00
     274.  00:63E6  C0 A0 90 08 80 60 10 00 
     275.  00:63EE                          ; mask 1 - 58h
     276.  00:63EE                          DB $01,$03,$03,$03,$01,$00,$00,$00
     276.  00:63EE  01 03 03 03 01 00 00 00 
     277.  00:63F6                          DB $01,$08,$11,$09,$01,$00,$04,$02
     277.  00:63F6  01 08 11 09 01 00 04 02 
     278.  00:63FE                          DB $F0,$F0,$F8,$F8,$F8,$F0,$A0,$00
     278.  00:63FE  F0 F0 F8 F8 F8 F0 A0 00 
     279.  00:6406                          DB $C0,$A0,$90,$08,$80,$00,$00,$00
     279.  00:6406  C0 A0 90 08 80 00 00 00 
     280.  00:640E                      
     281.  00:640E                      SPRITE_COLOR_TABLE:       
     282.  00:640E                           ;P1 - DOWN 1
     283.  00:640E                          ;DOWN 1
     284.  00:640E                          ; attr 0
     285.  00:640E                          DB $05,$05,$0A,$0B,$0B,$0B,$0B,$0B
     285.  00:640E  05 05 0A 0B 0B 0B 0B 0B 
     286.  00:6416                          DB $04,$04,$04,$0A,$0A,$0A,$08,$08    
     286.  00:6416  04 04 04 0A 0A 0A 08 08 
     287.  00:641E                          ; attr 1
     288.  00:641E                          DB $00,$00,$44,$45,$45,$45,$45,$45
     288.  00:641E  00 00 44 45 45 45 45 45 
     289.  00:6426                          DB $4A,$4A,$4A,$44,$44,$44,$45,$45    
     289.  00:6426  4A 4A 4A 44 44 44 45 45 
     290.  00:642E                          ; attr 2
     291.  00:642E                          DB $00,$00,$41,$00,$40,$00,$00,$00
     291.  00:642E  00 00 41 00 40 00 00 00 
     292.  00:6436                          DB $41,$41,$41,$41,$41,$41,$42,$00
     292.  00:6436  41 41 41 41 41 41 42 00 
     293.  00:643E                               
     294.  00:643E                          ; Cada posición ha de corresponder con la tabla de atributos    
     295.  00:643E                          ; Disparo - antichrist    
     296.  00:643E                          DB $00,$00,$00,$0A,$0A,$0A,$0A,$0A
     296.  00:643E  00 00 00 0A 0A 0A 0A 0A 
     297.  00:6446                          DB $0A,$0A,$0A,$0A,$0A,$0A,$00,$00
     297.  00:6446  0A 0A 0A 0A 0A 0A 00 00 
     298.  00:644E                          ; Fantasma
     299.  00:644E                          ; attr 0
     300.  00:644E                          DB $0F,$08,$08,$08,$08,$08,$08,$08
     300.  00:644E  0F 08 08 08 08 08 08 08 
     301.  00:6456                          DB $08,$08,$08,$08,$08,$08,$08,$0F
     301.  00:6456  08 08 08 08 08 08 08 0F 
     302.  00:645E                          ; attr 1
     303.  00:645E                          DB $00,$47,$47,$47,$47,$47,$47,$47
     303.  00:645E  00 47 47 47 47 47 47 47 
     304.  00:6466                          DB $47,$47,$47,$47,$47,$47,$47,$00
     304.  00:6466  47 47 47 47 47 47 47 00 
     305.  00:646E                          
     306.  00:646E                          
     307.  00:646E                          ; Esqueleto Left 1
     308.  00:646E                          ; attr 0
     309.  00:646E                          DB $0E,$0E,$0E,$0E,$0E,$0E,$0E,$0E
     309.  00:646E  0E 0E 0E 0E 0E 0E 0E 0E 
     310.  00:6476                          DB $0E,$0E,$0E,$0E,$0E,$0F,$0F,$0F
     310.  00:6476  0E 0E 0E 0E 0E 0F 0F 0F 
     311.  00:647E                          ; attr 1
     312.  00:647E                          DB $41,$49,$49,$49,$41,$41,$41,$00
     312.  00:647E  41 49 49 49 41 41 41 00 
     313.  00:6486                          DB $41,$41,$41,$41,$41,$00,$00,$00
     313.  00:6486  41 41 41 41 41 00 00 00 
     314.  00:648E                      
     315.  00:648E                      SPRITE_COLOR_P1_UP:
     316.  00:648E                          ;UP 1
     317.  00:648E                          ; attr 0
     318.  00:648E                          DB $05,$05,$0A,$05,$05,$05,$05,$05
     318.  00:648E  05 05 0A 05 05 05 05 05 
     319.  00:6496                          DB $0A,$05,$0B,$0A,$0A,$0A,$08,$08
     319.  00:6496  0A 05 0B 0A 0A 0A 08 08 
     320.  00:649E                          ; attr 1
     321.  00:649E                          DB $00,$00,$44,$00,$40,$00,$00,$00
     321.  00:649E  00 00 44 00 40 00 00 00 
     322.  00:64A6                          DB $44,$4A,$45,$45,$45,$45,$45,$45    
     322.  00:64A6  44 4A 45 45 45 45 45 45 
     323.  00:64AE                          ; attr 2
     324.  00:64AE                          DB $00,$00,$41,$00,$00,$00,$00,$00
     324.  00:64AE  00 00 41 00 00 00 00 00 
     325.  00:64B6                          DB $41,$41,$00,$00,$00,$00,$42,$00
     325.  00:64B6  41 41 00 00 00 00 42 00 
     326.  00:64BE                          
     327.  00:64BE                          ;SPRITE_COLOR_P1_UP2:
     328.  00:64BE                          ;UP 1
     329.  00:64BE                          ; attr 0
     330.  00:64BE                          DB $05,$05,$0A,$05,$05,$05,$05,$05
     330.  00:64BE  05 05 0A 05 05 05 05 05 
     331.  00:64C6                          DB $0A,$05,$0B,$0A,$0A,$0A,$08,$08
     331.  00:64C6  0A 05 0B 0A 0A 0A 08 08 
     332.  00:64CE                          ; attr 1
     333.  00:64CE                          DB $00,$00,$44,$00,$40,$00,$00,$00
     333.  00:64CE  00 00 44 00 40 00 00 00 
     334.  00:64D6                          DB $44,$4A,$45,$45,$45,$45,$45,$45
     334.  00:64D6  44 4A 45 45 45 45 45 45 
     335.  00:64DE                          ; attr 2
     336.  00:64DE                          DB $00,$00,$41,$00,$00,$00,$00,$00
     336.  00:64DE  00 00 41 00 00 00 00 00 
     337.  00:64E6                          DB $41,$41,$00,$00,$00,$00,$42,$00
     337.  00:64E6  41 41 00 00 00 00 42 00 
     338.  00:64EE                      
     339.  00:64EE                      
     340.  00:64EE                      SPRITE_COLOR_P1_DOWN:
     341.  00:64EE                          ;DOWN 1
     342.  00:64EE                          ; attr 0
     343.  00:64EE                          DB $05,$05,$0A,$0B,$0B,$0B,$0B,$0B
     343.  00:64EE  05 05 0A 0B 0B 0B 0B 0B 
     344.  00:64F6                          DB $04,$04,$04,$0A,$0A,$0A,$08,$08    
     344.  00:64F6  04 04 04 0A 0A 0A 08 08 
     345.  00:64FE                          ; attr 1
     346.  00:64FE                          DB $00,$00,$44,$45,$45,$45,$45,$45
     346.  00:64FE  00 00 44 45 45 45 45 45 
     347.  00:6506                          DB $4A,$4A,$4A,$44,$44,$44,$45,$45    
     347.  00:6506  4A 4A 4A 44 44 44 45 45 
     348.  00:650E                          ; attr 2
     349.  00:650E                          DB $00,$00,$41,$00,$40,$00,$00,$00
     349.  00:650E  00 00 41 00 40 00 00 00 
     350.  00:6516                          DB $41,$41,$41,$41,$41,$41,$42,$00
     350.  00:6516  41 41 41 41 41 41 42 00 
     351.  00:651E                          ;SPRITE_COLOR_P1_DOWN2:
     352.  00:651E                          ;DOWN 1
     353.  00:651E                          ; attr 0
     354.  00:651E                          DB $05,$05,$0A,$0B,$0B,$0B,$0B,$0B
     354.  00:651E  05 05 0A 0B 0B 0B 0B 0B 
     355.  00:6526                          DB $04,$04,$04,$0A,$0A,$0A,$08,$08    
     355.  00:6526  04 04 04 0A 0A 0A 08 08 
     356.  00:652E                          ; attr 1
     357.  00:652E                          DB $00,$00,$44,$45,$45,$45,$45,$45
     357.  00:652E  00 00 44 45 45 45 45 45 
     358.  00:6536                          DB $4A,$4A,$4A,$44,$44,$44,$45,$45    
     358.  00:6536  4A 4A 4A 44 44 44 45 45 
     359.  00:653E                          ; attr 2
     360.  00:653E                          DB $00,$00,$41,$00,$40,$00,$00,$00
     360.  00:653E  00 00 41 00 40 00 00 00 
     361.  00:6546                          DB $41,$41,$41,$41,$41,$41,$42,$00
     361.  00:6546  41 41 41 41 41 41 42 00 
     362.  00:654E                      
     363.  00:654E                      SPRITE_COLOR_P1_RIGHT:
     364.  00:654E                          ; attr 0
     365.  00:654E                          DB $05,$05,$0A,$0B,$0B,$0B,$0B,$0B
     365.  00:654E  05 05 0A 0B 0B 0B 0B 0B 
     366.  00:6556                          DB $0B,$0A,$0A,$0B,$0A,$0A,$08,$08    
     366.  00:6556  0B 0A 0A 0B 0A 0A 08 08 
     367.  00:655E                          ; attr 1
     368.  00:655E                          DB $00,$00,$44,$45,$45,$45,$45,$45
     368.  00:655E  00 00 44 45 45 45 45 45 
     369.  00:6566                          DB $45,$44,$44,$44,$44,$44,$45,$45    
     369.  00:6566  45 44 44 44 44 44 45 45 
     370.  00:656E                          ; attr 2
     371.  00:656E                          DB $00,$00,$41,$00,$40,$00,$00,$00
     371.  00:656E  00 00 41 00 40 00 00 00 
     372.  00:6576                          DB $00,$41,$41,$41,$41,$41,$42,$00
     372.  00:6576  00 41 41 41 41 41 42 00 
     373.  00:657E                             
     374.  00:657E                          ; attr 0
     375.  00:657E                          DB $05,$05,$0A,$0B,$0B,$0B,$0B,$0B
     375.  00:657E  05 05 0A 0B 0B 0B 0B 0B 
     376.  00:6586                          DB $0B,$0A,$0A,$0A,$0B,$0A,$08,$08    
     376.  00:6586  0B 0A 0A 0A 0B 0A 08 08 
     377.  00:658E                          ; attr 1
     378.  00:658E                          DB $00,$00,$44,$45,$45,$45,$45,$45
     378.  00:658E  00 00 44 45 45 45 45 45 
     379.  00:6596                          DB $45,$44,$44,$44,$44,$44,$45,$45
     379.  00:6596  45 44 44 44 44 44 45 45 
     380.  00:659E                          ; attr 2
     381.  00:659E                          DB $00,$00,$41,$00,$40,$00,$00,$00
     381.  00:659E  00 00 41 00 40 00 00 00 
     382.  00:65A6                          DB $00,$41,$41,$41,$41,$41,$42,$00
     382.  00:65A6  00 41 41 41 41 41 42 00 
     383.  00:65AE                      
     384.  00:65AE                      mapa1:
     385.  00:65AE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     385.  00:65AE  01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 00 
     385.  00:65BE  00 00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 
     386.  00:65CE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     386.  00:65CE  01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 00 
     386.  00:65DE  00 00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 
     387.  00:65EE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     387.  00:65EE  01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 00 
     387.  00:65FE  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     388.  00:660E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     388.  00:660E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     388.  00:661E  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     389.  00:662E                            db #01,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     389.  00:662E  01 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 
     389.  00:663E  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     390.  00:664E                            db #01,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     390.  00:664E  01 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 
     390.  00:665E  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     391.  00:666E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     391.  00:666E  01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 00 
     391.  00:667E  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     392.  00:668E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     392.  00:668E  01 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
     392.  00:669E  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     393.  00:66AE                          
     394.  00:66AE                            db #01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     394.  00:66AE  01 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
     394.  00:66BE  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     395.  00:66CE                            db #01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     395.  00:66CE  01 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
     395.  00:66DE  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     396.  00:66EE                            db #01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01        
     396.  00:66EE  01 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
     396.  00:66FE  00 00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 
     397.  00:670E                            db #01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#01,#01        
     397.  00:670E  01 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
     397.  00:671E  00 00 00 00 00 00 00 00 00 00 00 01 00 00 01 01 
     398.  00:672E                            db #01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#01,#01        
     398.  00:672E  01 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
     398.  00:673E  00 00 00 00 00 00 00 00 00 00 00 01 00 00 01 01 
     399.  00:674E                            db #01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#01,#01        
     399.  00:674E  01 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
     399.  00:675E  00 00 00 00 00 00 00 00 00 00 00 01 00 00 01 01 
     400.  00:676E                            db #01,#01,#00,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01        
     400.  00:676E  01 01 00 00 00 00 00 01 01 01 01 01 01 00 00 00 
     400.  00:677E  00 00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 
     401.  00:678E                            db #01,#01,#00,#00,#00,#00,#00,#01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     401.  00:678E  01 01 00 00 00 00 00 01 01 00 00 00 00 00 00 00 
     401.  00:679E  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     402.  00:67AE                      
     403.  00:67AE                            db #01,#01,#00,#00,#00,#00,#01,#01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     403.  00:67AE  01 01 00 00 00 00 01 01 01 00 00 00 00 00 00 00 
     403.  00:67BE  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     404.  00:67CE                            db #01,#01,#00,#00,#00,#00,#01,#01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     404.  00:67CE  01 01 00 00 00 00 01 01 01 00 00 00 00 00 00 00 
     404.  00:67DE  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     405.  00:67EE                            db #01,#01,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     405.  00:67EE  01 01 00 00 01 01 01 01 01 01 01 01 01 00 00 00 
     405.  00:67FE  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     406.  00:680E                            db #01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01,#01        
     406.  00:680E  01 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
     406.  00:681E  00 00 00 01 00 00 00 00 00 00 00 00 00 00 01 01 
     407.  00:682E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     407.  00:682E  01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 00 
     407.  00:683E  00 00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 
     408.  00:684E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     408.  00:684E  01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 00 
     408.  00:685E  00 00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 
     409.  00:686E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     409.  00:686E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     409.  00:687E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     410.  00:688E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     410.  00:688E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     410.  00:689E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     411.  00:68AE                      
     412.  00:68AE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     412.  00:68AE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     412.  00:68BE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     413.  00:68CE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     413.  00:68CE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     413.  00:68DE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     414.  00:68EE                      
     415.  00:68EE                      mapa2:
     416.  00:68EE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     416.  00:68EE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     416.  00:68FE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     417.  00:690E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     417.  00:690E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     417.  00:691E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     418.  00:692E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     418.  00:692E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     418.  00:693E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     419.  00:694E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     419.  00:694E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     419.  00:695E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     420.  00:696E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     420.  00:696E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     420.  00:697E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     421.  00:698E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     421.  00:698E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     421.  00:699E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     422.  00:69AE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     422.  00:69AE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     422.  00:69BE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     423.  00:69CE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     423.  00:69CE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     423.  00:69DE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     424.  00:69EE                            
     425.  00:69EE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     425.  00:69EE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     425.  00:69FE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     426.  00:6A0E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     426.  00:6A0E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     426.  00:6A1E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     427.  00:6A2E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     427.  00:6A2E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     427.  00:6A3E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     428.  00:6A4E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     428.  00:6A4E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     428.  00:6A5E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     429.  00:6A6E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     429.  00:6A6E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     429.  00:6A7E  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     430.  00:6A8E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     430.  00:6A8E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     430.  00:6A9E  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     431.  00:6AAE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     431.  00:6AAE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     431.  00:6ABE  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     432.  00:6ACE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     432.  00:6ACE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     432.  00:6ADE  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     433.  00:6AEE                            
     434.  00:6AEE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     434.  00:6AEE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     434.  00:6AFE  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     435.  00:6B0E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     435.  00:6B0E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     435.  00:6B1E  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     436.  00:6B2E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     436.  00:6B2E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     436.  00:6B3E  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     437.  00:6B4E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     437.  00:6B4E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     437.  00:6B5E  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     438.  00:6B6E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     438.  00:6B6E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     438.  00:6B7E  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     439.  00:6B8E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     439.  00:6B8E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     439.  00:6B9E  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     440.  00:6BAE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#00,#00,#00,#00,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     440.  00:6BAE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 00 00 
     440.  00:6BBE  00 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     441.  00:6BCE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     441.  00:6BCE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     441.  00:6BDE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     442.  00:6BEE                            
     443.  00:6BEE                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     443.  00:6BEE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     443.  00:6BFE  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     444.  00:6C0E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     444.  00:6C0E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     444.  00:6C1E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     445.  00:6C2E                      
     446.  00:6C2E                      
     447.  00:6C2E                      mapa0:      
     448.  00:6C2E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     448.  00:6C2E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     448.  00:6C3E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     449.  00:6C4E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     449.  00:6C4E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     449.  00:6C5E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     450.  00:6C6E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     450.  00:6C6E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     450.  00:6C7E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     451.  00:6C8E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     451.  00:6C8E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     451.  00:6C9E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     452.  00:6CAE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     452.  00:6CAE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     452.  00:6CBE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     453.  00:6CCE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     453.  00:6CCE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     453.  00:6CDE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     454.  00:6CEE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01       
     454.  00:6CEE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     454.  00:6CFE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     455.  00:6D0E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     455.  00:6D0E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     455.  00:6D1E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     456.  00:6D2E                            
     457.  00:6D2E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     457.  00:6D2E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     457.  00:6D3E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     458.  00:6D4E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     458.  00:6D4E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     458.  00:6D5E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     459.  00:6D6E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     459.  00:6D6E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     459.  00:6D7E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     460.  00:6D8E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     460.  00:6D8E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     460.  00:6D9E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     461.  00:6DAE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     461.  00:6DAE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     461.  00:6DBE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     462.  00:6DCE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     462.  00:6DCE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     462.  00:6DDE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     463.  00:6DEE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     463.  00:6DEE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     463.  00:6DFE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     464.  00:6E0E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     464.  00:6E0E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     464.  00:6E1E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     465.  00:6E2E                      
     466.  00:6E2E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     466.  00:6E2E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     466.  00:6E3E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     467.  00:6E4E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     467.  00:6E4E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     467.  00:6E5E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     468.  00:6E6E                            db #01,#00,#00,#00,#01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     468.  00:6E6E  01 00 00 00 01 01 00 00 00 00 00 00 00 00 00 00 
     468.  00:6E7E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     469.  00:6E8E                            db #01,#00,#00,#00,#01,#01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     469.  00:6E8E  01 00 00 00 01 01 00 00 00 00 00 00 00 00 00 00 
     469.  00:6E9E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     470.  00:6EAE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     470.  00:6EAE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     470.  00:6EBE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     471.  00:6ECE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     471.  00:6ECE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     471.  00:6EDE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     472.  00:6EEE                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01        
     472.  00:6EEE  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     472.  00:6EFE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     473.  00:6F0E                            db #01,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#00,#01   
     473.  00:6F0E  01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     473.  00:6F1E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 
     474.  00:6F2E                            
     475.  00:6F2E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     475.  00:6F2E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     475.  00:6F3E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     476.  00:6F4E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     476.  00:6F4E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     476.  00:6F5E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     477.  00:6F6E                            db #01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01,#01   
     477.  00:6F6E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     477.  00:6F7E  01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 
     478.  00:6F8E                          
     479.  00:6F8E                      
     480.  00:6F8E                      SPRITE_COLOR_P1_LEFT:
     481.  00:6F8E                          ; attr 0
     482.  00:6F8E                          DB $05,$05,$0A,$0B,$0B,$0B,$0B,$0B
     482.  00:6F8E  05 05 0A 0B 0B 0B 0B 0B 
     483.  00:6F96                          DB $0B,$0A,$0A,$0B,$0A,$0A,$08,$08
     483.  00:6F96  0B 0A 0A 0B 0A 0A 08 08 
     484.  00:6F9E                          ; attr 1
     485.  00:6F9E                          DB $00,$00,$44,$45,$45,$45,$45,$45
     485.  00:6F9E  00 00 44 45 45 45 45 45 
     486.  00:6FA6                          DB $45,$44,$44,$44,$44,$44,$45,$45
     486.  00:6FA6  45 44 44 44 44 44 45 45 
     487.  00:6FAE                          ; attr 2
     488.  00:6FAE                          DB $00,$00,$41,$00,$40,$00,$00,$00
     488.  00:6FAE  00 00 41 00 40 00 00 00 
     489.  00:6FB6                          DB $00,$41,$41,$41,$41,$41,$42,$00
     489.  00:6FB6  00 41 41 41 41 41 42 00 
     490.  00:6FBE                          ;SPRITE_COLOR_P1_LEFT2:    
     491.  00:6FBE                          ; attr 0
     492.  00:6FBE                          DB $05,$05,$0A,$0B,$0B,$0B,$0B,$0B
     492.  00:6FBE  05 05 0A 0B 0B 0B 0B 0B 
     493.  00:6FC6                          DB $0B,$0A,$0A,$0A,$0B,$0A,$08,$08
     493.  00:6FC6  0B 0A 0A 0A 0B 0A 08 08 
     494.  00:6FCE                          ; attr 1
     495.  00:6FCE                          DB $00,$00,$44,$45,$45,$45,$45,$45
     495.  00:6FCE  00 00 44 45 45 45 45 45 
     496.  00:6FD6                          DB $45,$44,$44,$44,$44,$44,$45,$45
     496.  00:6FD6  45 44 44 44 44 44 45 45 
     497.  00:6FDE                          ; attr 2
     498.  00:6FDE                          DB $00,$00,$41,$00,$40,$00,$00,$00
     498.  00:6FDE  00 00 41 00 40 00 00 00 
     499.  00:6FE6                          DB $00,$41,$41,$41,$41,$41,$42,$00
     499.  00:6FE6  00 41 41 41 41 41 42 00 
     500.  00:6FEE                      
     501.  00:6FEE                      BLANK_DATA:
     502.  00:6FEE                          DB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
     502.  00:6FEE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     502.  00:6FFE  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     503.  00:700E                          DB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
     503.  00:700E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     503.  00:701E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     504.  00:702E                          DB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
     504.  00:702E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
     504.  00:703E  00 00 00 00 
     505.  00:7042                          
     506.  00:7042                      PaletteData:
     507.  00:7042                      			;  data 1 (red 0-7; blue 0-7); data 2 (0000; green 0-7)
     508.  00:7042  00 00                   db 0x00, 0x00 ; Color index 0
     509.  00:7044  30 00                   db 0x30, 0x00 ; Color index 1
     510.  00:7046  70 06                   db 0x70, 0x06 ; Color index 2
     511.  00:7048  50 00                   db 0x50, 0x00 ; Color index 3
     512.  00:704A  11 01                   db 0x11, 0x01 ; Color index 4
     513.  00:704C  22 02                   db 0x22, 0x02 ; Color index 5
     514.  00:704E  06 02                   db 0x06, 0x02 ; Color index 6
     515.  00:7050  77 07                   db 0x77, 0x07 ; Color index 7
     516.  00:7052  33 03                   db 0x33, 0x03 ; Color index 8
     517.  00:7054  66 06                   db 0x66, 0x06 ; Color index 9
     518.  00:7056  70 00                   db 0x70, 0x00 ; Color index 10
     519.  00:7058  64 05                   db 0x64, 0x05 ; Color index 11
     520.  00:705A  50 03                   db 0x50, 0x03 ; Color index 12
     521.  00:705C  02 04                   db 0x02, 0x04 ; Color index 13
     522.  00:705E  01 02                   db 0x01, 0x02 ; Color index 14
     523.  00:7060  00 00                   db 0x00, 0x00 ; Color index 15
     534   00:7062                      
     535   00:7062  (01)                 PAGE 1
     536   01:8000                      ; CODE O NO
     537   01:8000                      
     538   01:8000  (02)                 PAGE 2
     539   02:8000                      
     540   02:8000  (03)                 PAGE 3
     541   03:8000                      
     542   03:8000  (04)                 PAGE 4
     543   04:8000  (05)                 PAGE 5
     544   05:8000  (06)                 PAGE 6
     545   06:8000                      FONT:
     546   06:8000  (07F7)               INCBIN "gfx\FONT.SC5",#7
     547   06:87F7  (07)                 PAGE 7
     548   07:8000                      CEMENTER1
     549   07:8000  (4000)               INCBIN "gfx\CEMENTER1.SC5",#7,#4000			; Cada página tiene 16K = 4000h
     550   07:C000  (08)                 PAGE 8
     551   08:8000  (2A00)               INCBIN "gfx\CEMENTER1.SC5",#4007			; Cada página tiene 16K = 4000h 
     552   08:AA00  (09)                 PAGE 9
     553   09:8000                      GRAPHIC
     554   09:8000  (4000)               INCBIN "gfx\BTH.SR8",#7,#4000			; Cada página tiene 16K = 4000h
     555   09:C000  (0A)                 PAGE 10
     556   0A:8000  (4000)               INCBIN "gfx\BTH.SR8",#4007,#4000
     557   0A:C000                      
     558   0A:C000  (0B)                 PAGE 11
     559   0B:8000  (4000)               INCBIN "gfx\BTH.SR8",#8007,#4000
     560   0B:C000                      
     561   0B:C000  (0C)                 PAGE 12
     562   0C:8000  (1400)               INCBIN "gfx\BTH.SR8",#C007
     563   0C:9400                      
     564   0C:9400  (0D)                 PAGE 13
     565   0D:8000                      CEMENTER2
     566   0D:8000  (4000)               INCBIN "gfx\CEMENTER2.SC5",#7,#4000			; Cada página tiene 16K = 4000h
     567   0D:C000  (0E)                 PAGE 14
     568   0E:8000  (2A00)               INCBIN "gfx\CEMENTER2.SC5",#4007			; Cada página tiene 16K = 4000h 
     569   0E:AA00  (0F)                 PAGE 15
     570   0F:C000                      ;---------------------------------------------------------
     571   0F:C000                      ; Variables
     572   0F:C000                      ;---------------------------------------------------------
     573   0F:C000                      	
     574   0F:C000  (C000)              	MAP #C000  ;Ram page 3
     575   0F:C000                      ;	MAP #E5FF  ;Ram page 3
     576   0F:C000                      ;NAME #1  ;a byte is reserved for this variable
     577   0F:C000                      ;ETC
     578   0F:C000                      ;
     579   0F:C000                      	include "include\BTH_RAM.asm"
       1.  0F:C000  00 (1)              SHOWING_MIKE_DIALOG  DS 1
       2.  0F:C001  00 (1)              SHOWING_JOHN_DIALOG  DS 1
       3.  0F:C002  00 (1)              SHOWING_GUS_DIALOG  DS 1
       4.  0F:C003  (0F:0008)           FONT_HEIGHT EQU 8
       5.  0F:C003  (0F:0008)           FONT_WIDTH  EQU 8
       6.  0F:C003  00 (2)              CHR_ACR DS 2
       7.  0F:C005  00 (1)              PTR_STR_DX DS 1
       8.  0F:C006  00 (1)              PTR_STR_DY DS 1
       9.  0F:C007                      
      10.  0F:C007  00 (1)              LAST_KEY_PRESSED DS 1
      11.  0F:C008  00 (1)              OLD_KEY_PRESSED DS 1
      12.  0F:C009  00                  JIFFY_TEMP DB $00
      13.  0F:C00A  00                  CHAR_SPEED_X DB $00
      14.  0F:C00B  00                  CHAR_SPEED_Y DB $00
      15.  0F:C00C  00                  CHAR_SPEED_X_GHOST DB $00
      16.  0F:C00D  00                  CHAR_SPEED_X_GHOST_STG2 DB $00
      17.  0F:C00E  00 (1)              CHAR_GHOST_DEAD DS 1
      18.  0F:C00F  00 (1)              CHAR_GHOST_DEAD_STG2 DS 1
      19.  0F:C010  00 (1)              CHAR_MIN_STEP_STG2 DS 1
      20.  0F:C011  00                  CHAR_DIR_GHOST1 DB $00      ; $00 - LEFT, $FF - RIGHT
      21.  0F:C012  00                  CHAR_DIR_GHOST_STG2 DB $00      ; $00 - LEFT, $FF - RIGHT
      22.  0F:C013  00                  CHAR_DIR_MAIN DB $00        ; $00 - UP, $01 - DOWN, $02 - LEFT, $03 - RIGHT
      23.  0F:C014  00 (1)              CHAR_NEW_DIR_MAIN DS 1
      24.  0F:C015  00 (1)              CHAR_MAIN_SHOOT DS 1        ; $01 - SHOOT LEFT $02 - SHOOT RIGHT $03 - SHOOT UP $04 - SHOOT DOWN
      25.  0F:C016  00 (1)              CHAR_MIN_STEP DS 1          ; número de ciclos antes de cambiar de patrón
      26.  0F:C017  00 (1)              CHAR_DISTANCE_SHOOT DS 1
      27.  0F:C018  00 (1)              CHAR_SPEED_SHOOT DS 1
      28.  0F:C019                      SPRITE_ATTRS:
      29.  0F:C019  00 (128)                DS 128
      30.  0F:C099                      SLOTBIOS:
      31.  0F:C099  00 (1)                  DS 1
      32.  0F:C09A                      SLOTGAME:
      33.  0F:C09A  00 (1)                  DS 1
      34.  0F:C09B                      SLOTRAM:
      35.  0F:C09B  00 (1)                  DS 1
      36.  0F:C09C                      SPRITE_PTR_REPLACE:
      37.  0F:C09C  00 (2)                  DS 2
      38.  0F:C09E                      SPRITE_COLOR_REPLACE:
      39.  0F:C09E  00 (2)                  DS 2
      40.  0F:C0A0                      SPRITE_COLOR_REPLACE2:
      41.  0F:C0A0  00 (2)                  DS 2
      42.  0F:C0A2                      MAPA:
      43.  0F:C0A2  00 (2)                  DS 2
      44.  0F:C0A4                      BITMAP:
      45.  0F:C0A4  00 (2)                  DS 2
     580   0F:C0A6  (F240)              	ENDMAP

    LABELS
-------------------------------------------------
00:00004000 X PageSize
00:00006000 X _bank1
00:00007000   _bank2
00:0000009F X CHGET
00:000000A2 X CHPUT
00:0000005F   CHGMOD
00:0000005C   LDIRVM
00:0000013E X RDVDP
00:00000047   WRTVDP
00:0000F3DB   CLIKSW
00:00000141   SNSMAT
00:0000FC9E X JIFFY
00:00000041   DISSCR
00:00000044   ENASCR
00:00000072 X INIGRP
00:00000138   RSLREG
00:00000024   ENASLT
00:00005C28   FIRST_LINE_DLG_BOX
00:00006028   SEC_LINE_DLG_BOX
00:00006428   THIRD_LINE_DLG_BOX
00:00000001 X ROMMODE
00:00000007   KB_RIGHT
00:00000006   KB_DOWN
00:00000005   KB_UP
00:00000004   KB_LEFT
00:00000003   KB_DEL
00:00000000   KB_SPACE
00:00000001   MOV_SPEED
00:00000001   MOV_SPEED_GHOST
00:00000003   MOV_SPEED_SHOOT
00:00000030   MAX_DISTANCE_SHOOT
00:00000005   MAX_CHAR_STEPS
00:00000006   MAX_CHAR_STEPS_STG2
00:0000FFE8   REG9SAV
00:00000098   PORT_0
00:00000099   PORT_1
00:0000009A X PORT_2
00:0000009B X PORT_3
00:0000F3E0   RG15AV
00:0000F3E9   FORCLR
00:000000C8   MIKE_TOMB_STG1_X
00:00000029   JOHN_TOMB_STG1_X
00:00000049   GUS_TOMB_STG1_X
00:0000000C   SPR_SHOOT_P1
00:00000018   SPR_SHOOT_P1_PTRN
00:00000010   SPR_GHOST_STG1
00:0000001C   SPR_GHOST_STG1_PTRN_L1
00:00000024   SPR_GHOST_STG1_PTRN_L2
00:0000002C   SPR_GHOST_STG1_PTRN_R1
00:00000034   SPR_GHOST_STG1_PTRN_R2
00:00000018   SPR_GHOST_STG2
00:0000003C   SPR_GHOST_STG2_PTRN_L1
00:00000044   SPR_GHOST_STG2_PTRN_L2
00:0000004C   SPR_GHOST_STG2_PTRN_R1
00:00000054   SPR_GHOST_STG2_PTRN_R2
00:00004010   mike_tomb_strings
00:00004016   string01M
00:0000401C   string02M
00:00004030   string03M
00:00004039   john_tomb_strings
00:0000403F   string01J
00:00004045   string02J
00:00004059   string03J
00:00004062   gus_tomb_strings
00:00004068   string01G
00:0000406D   string02G
00:0000407F   string03G
00:00004088   check_spr_collision
00:00004095   check_spr_collision.no_collision
00:00004098   get_bloque_en_X_Y
00:000040B9   SetVdp_Write
00:000040D5   Set212Lines
00:000040E1   ClearVram_MSX2
00:000040EB   ClearVram_MSX2.loop_2
00:000040ED   ClearVram_MSX2.loop_1
00:000040EF   ClearVram_MSX2.loop
00:000040FC X opening_screen
00:0000411F   load_screen
00:00004141   _vdpsetvramwr
00:00004152 X _vdpsetvramwr14
00:0000415B   GETSLOT
00:00004172   EXIT
00:00004174   SETPAGES32K
00:00004179   NOPRET
00:00004187   SET_SCREEN5_MODE
00:000041A9   DUMP_SPR_ALL
00:000041CE   DUMP_SPR_ATTS
00:000041E8 X DUMP_SPR_ATTS.DUMP_SPR_ATTS_END
00:000041E9   DUMP_SPR_P1
00:00004206   SetPalette
00:00004215   move_up
00:0000424F   move_down
00:0000428A   move_right
00:0000429B   move_right.KB_UPDOWN_PRESSED
00:000042E9   move_left
00:000042FA   move_left.KB_UPDOWN_PRESSED
00:00004348   CHECK_DIRECTION_MAIN
00:0000436A   CHECK_DIRECTION_MAIN.SET_DIR_DOWN
00:0000437F   CHECK_DIRECTION_MAIN.SET_DIR_UP
00:00004394   CHECK_DIRECTION_MAIN.SET_DIR_LEFT
00:000043A9   CHECK_DIRECTION_MAIN.SET_DIR_RIGHT
00:000043BE   CHECK_DIRECTION_MAIN.FINISH
00:000043D5   UPDATE_MOVEMENT
00:000043FD   ANIMATE_P1
00:00004424   ANIMATE_P1.SET_SPR_1P_2
00:0000443B   ANIMATE_P1.NO_CHAR_PATTERN_CHANGE
00:00004441   NO_MOVEMENT
00:00004442   MOVE_SHOOT
00:0000445A   MOVE_SHOOT.MOVE_SHOOT_RIGHT
00:00004462   MOVE_SHOOT.MOVE_SHOOT_UP
00:0000446A   MOVE_SHOOT.MOVE_SHOOT_DOWN
00:00004472   MOVE_SHOOT.MOVE_SHOOT_LEFT
00:00004477   MOVE_SHOOT.CHECK_SHOOT_DISTANCE
00:0000448C   MOVE_SHOOT.ADD_SHOOT_Y
00:00004496   MOVE_SHOOT.ADD_DISTANCE
00:000044A1 X MOVE_SHOOT.HIDE_SHOOT
00:000044AD   print_strings_dialog_box
00:000044DA   print_string
00:000044DA   print_string.loop_str
00:000044F5   print_string.first_line_font
00:0000450E   print_char
00:00004545   CLEAR_DIALOG_BOX
00:00000000   CHNPRM_PsInOr
00:00000001   CHNPRM_PsInSm
00:00000002   CHNPRM_CrAmSl
00:00000003   CHNPRM_CrNsSl
00:00000004   CHNPRM_CrEnSl
00:00000005   CHNPRM_TSlCnt
00:00000006   CHNPRM_CrTnSl
00:00000008   CHNPRM_TnAcc
00:0000000A   CHNPRM_COnOff
00:0000000B   CHNPRM_OnOffD
00:0000000C   CHNPRM_OffOnD
00:0000000D   CHNPRM_OrnPtr
00:0000000F   CHNPRM_SamPtr
00:00000011   CHNPRM_NNtSkp
00:00000012   CHNPRM_Note
00:00000013   CHNPRM_SlToNt
00:00000014   CHNPRM_Env_En
00:00000015   CHNPRM_Flags
00:00000016   CHNPRM_TnSlDl
00:00000017   CHNPRM_TSlStp
00:00000019   CHNPRM_TnDelt
00:0000001B   CHNPRM_NtSkCn
00:0000001C   CHNPRM_Volume
00:0000001D X CHNPRM_Size
00:00000000   AR_TonA
00:00000002   AR_TonB
00:00000004   AR_TonC
00:00000006   AR_Noise
00:00000007   AR_Mixer
00:00000008   AR_AmplA
00:00000009   AR_AmplB
00:0000000A   AR_AmplC
00:0000000B   AR_Env
00:0000000D   AR_EnvTp
00:00004577   CHECKLP
00:00004588 X PT3_MUTE
00:00004594 X PT3_INIT
00:000045D3   PT3_INIT.TP_0
00:000045DF   PT3_INIT.TP_1
00:000045E6   PT3_INIT.TP_2
00:00004654   PT3_INIT.L1
00:00004661   PT3_INIT.L2
00:00004665 X PT3_INIT.L3
00:0000468C   PT3_INIT.CORR_1
00:0000469A   PT3_INIT.CORR_2
00:000046A1   PT3_INIT.TC_EXIT
00:000046AC   PT3_INIT.INITV1
00:000046B4   PT3_INIT.INITV2
00:000046C8   PT3_INIT.INITV3
00:000046CC   PD_OrSm
00:000046D6   PD_SAM
00:000046D7   PD_SAM_
00:000046ED   PD_VOL
00:000046F6   PD_EOff
00:000046FE   PD_SorE
00:00004708   PD_ENV
00:0000470D   PD_ORN
00:00004712   PD_ESAM
00:0000471F   PTDECOD
00:0000472E   PD_LOOP
00:00004731   PD_LP2
00:0000475E   PD_NOIS
00:00004763   PD_REL
00:00004769   PD_NOTE
00:00004771   PD_RES
00:00004783   PD_FIN
00:0000478A   C_PORTM
00:000047D5   C_PORTM.NOSIG
00:000047DF   SET_STP
00:000047EB   C_GLISS
00:000047FE   C_SMPOS
00:00004804   C_ORPOS
00:0000480A   C_VIBRT
00:00004822   C_ENGLS
00:00004834   C_DELAY
00:0000483A   SETENV
00:00004855   C_NOP
00:00004856   SETORN
00:0000486F   SPCCOMS
00:0000488F   CHREGS
00:000048B2   CHREGS.CH_ORPS
00:000048BD   CHREGS.CH_NTP
00:000048C3   CHREGS.CH_NOK
00:000048DE   CHREGS.CH_SMPS
00:000048F4   CHREGS.CH_NOAC
00:0000493B   CHREGS.CH_STPP
00:00004950   CHREGS.CH_AMP
00:00004962   CHREGS.CH_AMIN
00:00004967   CHREGS.CH_SVAM
00:0000496A   CHREGS.CH_NOAM
00:00004973   CHREGS.CH_APOS
00:00004979   CHREGS.CH_VOL
00:00004984 X CHREGS.CH_ENV
00:0000498B   CHREGS.CH_NOEN
00:000049A5   CHREGS.NO_ENAC
00:000049AC   CHREGS.NO_ENSL
00:000049BA   CHREGS.CH_MIX
00:000049BE   CHREGS.CH_EXIT
00:000049DD   CHREGS.CH_ONDL
00:000049E1 X PT3_PLAY
00:00004A15   PT3_PLAY.PLNLP
00:00004A3C   PT3_PLAY.PL1A
00:00004A47   PT3_PLAY.PL1B
00:00004A5C   PT3_PLAY.PL1C
00:00004A71   PT3_PLAY.PL1D
00:00004A77   PT3_PLAY.PL2
00:00004AD9 X PT3_ROUT
00:00004ADA   ROUT_A0
00:00004AE6   ROUT_A0.LOUT
00:00004AFA   NT_DATA
00:00004B0A   T_
00:00004B0A   TCOLD_0
00:00004B16   TCNEW_1
00:00004B16   TCOLD_1
00:00004B18   TCOLD_2
00:00004B2A   TCNEW_3
00:00004B2B   TCOLD_3
00:00004B34   TCNEW_0
00:00004B3F   TCNEW_2
00:00004B4A   EMPTYSAMORN
00:00004B4E   T_PACK
00:0000F000   PT3_SETUP
00:0000F001   PT3_MODADDR
00:0000F003   PT3_CrPsPtr
00:0000F005   PT3_SAMPTRS
00:0000F007   PT3_OrnPtrs
00:0000F009   PT3_PDSP
00:0000F00B   PT3_CSP
00:0000F00D   PT3_PSP
00:0000F00F   PT3_PrNote
00:0000F010   PT3_PrSlide
00:0000F012   PT3_AdInPtA
00:0000F014   PT3_AdInPtB
00:0000F016   PT3_AdInPtC
00:0000F018   PT3_LPosPtr
00:0000F01A   PT3_PatsPtr
00:0000F01C   PT3_Delay
00:0000F01D   PT3_AddToEn
00:0000F01E   PT3_Env_Del
00:0000F01F   PT3_ESldAdd
00:0000F021   PT3_NTL3
00:0000F023   VARS
00:0000F023   ChanA
00:0000F040   ChanB
00:0000F05D   ChanC
00:0000F07A   DelyCnt
00:0000F07B   CurESld
00:0000F07D   CurEDel
00:0000F07E   Ns_Base_AddToNs
00:0000F07E   Ns_Base
00:0000F07F   AddToNs
00:0000F080   NT_
00:0000F140   AYREGS
00:0000F140   VT_
00:0000F14E   EnvBase
00:0000F150   VAR0END
00:0000F150   T1_
00:0000F150   T_NEW_1
00:0000F150   T_OLD_1
00:0000F168   T_OLD_2
00:0000F180   T_NEW_3
00:0000F180   T_OLD_3
00:0000F182   T_OLD_0
00:0000F182   T_NEW_0
00:0000F19A   T_NEW_2
00:00004B83   START
00:00004BA6   INIT_CHARS_VARS
00:00004C2C   STAGE1
00:00004C49   MAIN_LOOP
00:00004C54 X MAIN_LOOP.check_tombs
00:00004C70   MAIN_LOOP.check_john_tomb
00:00004C89   MAIN_LOOP.check_gus_tomb
00:00004CA2   MAIN_LOOP.check_dialog_box
00:00004CB2   MAIN_LOOP.check_gus_dialog
00:00004CC2   MAIN_LOOP.check_john_dialog
00:00004CD0   MAIN_LOOP.animate_ghost
00:00004CF2   MAIN_LOOP.CHANGE_DIR_RIGHT
00:00004CFF   MAIN_LOOP.CHANGE_DIR_LEFT
00:00004D08   MAIN_LOOP.check_pattern
00:00004D23   MAIN_LOOP.change_pattern_L
00:00004D2E   MAIN_LOOP.check_pattern_RIGHT
00:00004D41   MAIN_LOOP.change_pattern_R
00:00004D49   MAIN_LOOP.continue
00:00004D4C X MAIN_LOOP.CHECK_GHOST
00:00004D68 X MAIN_LOOP.KILL_GHOST
00:00004D75   MAIN_LOOP.check_KB
00:00004D90 X no_arrows
00:00004D98   SHOOT_MAIN_CHAR
00:00004DD2   SHOOT_MAIN_CHAR.SHOOT_RIGHT
00:00004DE1   SHOOT_MAIN_CHAR.SHOOT_UP
00:00004DF4   SHOOT_MAIN_CHAR.SHOOT_DOWN
00:00004E04   SHOOT_MAIN_CHAR.CONTINUE
00:00004E08   STAGE2
00:00004E62   MAIN_LOOP2
00:00004E87   MAIN_LOOP2.GHOST_DEAD
00:00004E92   MAIN_LOOP2.no_screen_change
00:00004EC4   MAIN_LOOP2.CHANGE_DIR_RIGHT
00:00004ED1   MAIN_LOOP2.CHANGE_DIR_LEFT
00:00004EDA   MAIN_LOOP2.check_pattern
00:00004EF9   MAIN_LOOP2.change_pattern_L
00:00004F04   MAIN_LOOP2.check_pattern_RIGHT
00:00004F17   MAIN_LOOP2.change_pattern_R
00:00004F1F   MAIN_LOOP2.continue
00:00004F47 X SONG
00:00005E2E   SPRITE_P1_UP
00:00005EEE   SPRITE_P1_DOWN
00:00005FAE   SPRITE_P1_LEFT
00:0000606E   SPRITE_P1_RIGHT
00:0000612E   SPRITE_PATTERN
00:0000640E   SPRITE_COLOR_TABLE
00:0000648E   SPRITE_COLOR_P1_UP
00:000064EE   SPRITE_COLOR_P1_DOWN
00:0000654E   SPRITE_COLOR_P1_RIGHT
00:000065AE   mapa1
00:000068EE   mapa2
00:00006C2E X mapa0
00:00006F8E   SPRITE_COLOR_P1_LEFT
00:00006FEE   BLANK_DATA
00:00007042   PaletteData
06:00008000   FONT
07:00008000   CEMENTER1
09:00008000   GRAPHIC
0D:00008000   CEMENTER2
0F:0000C000   SHOWING_MIKE_DIALOG
0F:0000C001   SHOWING_JOHN_DIALOG
0F:0000C002   SHOWING_GUS_DIALOG
0F:00000008 X FONT_HEIGHT
0F:00000008 X FONT_WIDTH
0F:0000C003   CHR_ACR
0F:0000C005 X PTR_STR_DX
0F:0000C006 X PTR_STR_DY
0F:0000C007 X LAST_KEY_PRESSED
0F:0000C008   OLD_KEY_PRESSED
0F:0000C009   JIFFY_TEMP
0F:0000C00A   CHAR_SPEED_X
0F:0000C00B   CHAR_SPEED_Y
0F:0000C00C   CHAR_SPEED_X_GHOST
0F:0000C00D   CHAR_SPEED_X_GHOST_STG2
0F:0000C00E   CHAR_GHOST_DEAD
0F:0000C00F   CHAR_GHOST_DEAD_STG2
0F:0000C010   CHAR_MIN_STEP_STG2
0F:0000C011   CHAR_DIR_GHOST1
0F:0000C012   CHAR_DIR_GHOST_STG2
0F:0000C013   CHAR_DIR_MAIN
0F:0000C014   CHAR_NEW_DIR_MAIN
0F:0000C015   CHAR_MAIN_SHOOT
0F:0000C016   CHAR_MIN_STEP
0F:0000C017   CHAR_DISTANCE_SHOOT
0F:0000C018   CHAR_SPEED_SHOOT
0F:0000C019   SPRITE_ATTRS
0F:0000C099 X SLOTBIOS
0F:0000C09A X SLOTGAME
0F:0000C09B X SLOTRAM
0F:0000C09C   SPRITE_PTR_REPLACE
0F:0000C09E   SPRITE_COLOR_REPLACE
0F:0000C0A0   SPRITE_COLOR_REPLACE2
0F:0000C0A2   MAPA
0F:0000C0A4   BITMAP


 Output: .\BTH.out
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: *  Used: 00000000

    No output

 Output: BTH.rom
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: 00004000  Used: 00003068

   Address   Length Align   Label
   00004000   12386         mike_tomb_strings
   00007062       6         
   00007068    3992       <empty>

 Page: 01
  Org: 00008000  Size: 00004000  Used: 00000000

   00008000   16384       <empty>

 Page: 02
  Org: 00008000  Size: 00004000  Used: 00000000

   00008000   16384       <empty>

 Page: 03
  Org: 00008000  Size: 00004000  Used: 00000000

   00008000   16384       <empty>

 Page: 04
  Org: 00008000  Size: 00004000  Used: 00000000

   00008000   16384       <empty>

 Page: 05
  Org: 00008000  Size: 00004000  Used: 00000000

   00008000   16384       <empty>

 Page: 06
  Org: 00008000  Size: 00004000  Used: 000007F7

   Address   Length Align   Label
   00008000    2039         FONT
   000087F7   14345       <empty>

 Page: 07
  Org: 00008000  Size: 00004000  Used: 00004000

   Address   Length Align   Label
   00008000   16384         CEMENTER1

 Page: 08
  Org: 00008000  Size: 00004000  Used: 00002A00

   Address   Length Align   Label
   00008000   10752         
   0000AA00    5632       <empty>

 Page: 09
  Org: 00008000  Size: 00004000  Used: 00004000

   Address   Length Align   Label
   00008000   16384         GRAPHIC

 Page: 0A
  Org: 00008000  Size: 00004000  Used: 00004000

   Address   Length Align   Label
   00008000   16384         

 Page: 0B
  Org: 00008000  Size: 00004000  Used: 00004000

   Address   Length Align   Label
   00008000   16384         

 Page: 0C
  Org: 00008000  Size: 00004000  Used: 00001400

   Address   Length Align   Label
   00008000    5120         
   00009400   11264       <empty>

 Page: 0D
  Org: 00008000  Size: 00004000  Used: 00004000

   Address   Length Align   Label
   00008000   16384         CEMENTER2

 Page: 0E
  Org: 00008000  Size: 00004000  Used: 00002A00

   Address   Length Align   Label
   00008000   10752         
   0000AA00    5632       <empty>

 Page: 0F
  Org: 0000C000  Size: 00004000  Used: 000000A6

   Address   Length Align   Label
   0000C000     166         SHOWING_MIKE_DIALOG
   0000C0A6   16218       <empty>
